<article class="restaurant-card" [class.selected]="selected()" [class.top-result]="isTopResult()"
  [class.compact]="compact()" (click)="onCardClick()" role="button" tabindex="0"
  [attr.aria-label]="'View details for ' + restaurant().name">
  @if (showReasonLabel() && isTopResult()) {
  <app-reason-label [restaurant]="restaurant()" />
  }

  <!-- P0 Security: Secure photo loading via backend proxy -->
  <!-- Non-blocking: Show placeholder first, load photo after initial render -->
  @if (shouldLoadPhoto() && photoSrc() && !photoError()) {
  <img class="restaurant-photo" [src]="getCurrentPhotoSrc()" [alt]="restaurant().name + ' restaurant photo'"
    loading="lazy" (error)="onPhotoError()" [attr.aria-label]="'Photo of ' + restaurant().name" />
  } @else {
  <div class="restaurant-photo-placeholder" role="img" [attr.aria-label]="'Placeholder image for ' + restaurant().name">
    ğŸ½ï¸
  </div>
  }

  <div class="restaurant-info">
    <div class="restaurant-name-row">
      <h3 class="restaurant-name">{{ restaurant().name }}</h3>

      @if (glutenFreeBadge()) {
      <span class="dietary-badge gluten-free" [class.high]="glutenFreeBadge()!.level === 'high'"
        [class.low]="glutenFreeBadge()!.level === 'low'" [title]="getGlutenFreeTooltip()">
        {{ glutenFreeBadge()!.text }}
      </span>
      }
    </div>

    <div class="restaurant-meta">
      @if (restaurant().rating) {
      <span class="rating" 
        [attr.data-low-reviews]="isLowReviewCount() ? 'true' : 'false'"
        [attr.aria-label]="'Rating: ' + restaurant().rating">
        â­ {{ restaurant().rating }}
        @if (restaurant().userRatingsTotal) {
        <span class="rating-reviews"> Â· {{ formatReviewCount(restaurant().userRatingsTotal!) }} ×‘×™×§×•×¨×•×ª</span>
        }
      </span>
      }

      @if (restaurant().priceLevel) {
      <span class="price-level" [attr.aria-label]="'Price level: ' + restaurant().priceLevel">
        {{ getPriceLevel(restaurant().priceLevel) }}
      </span>
      }
    </div>

    <p class="restaurant-address">{{ getShortAddress(restaurant().address) }}</p>

    <!-- UX SIGNALS: Canonical card signal (priority-based) -->
    @if (cardSignal()) {
    <p class="card-signal-text" 
      [class.emphasized]="isCardSignalEmphasized()"
      [style.color]="getCardSignalColor()"
      [attr.aria-label]="'Signal: ' + getCardSignalLabel()">
      {{ getCardSignalLabel() }}
    </p>
    }

    @if (getDisplayTags().length > 0) {
    <div class="restaurant-tags">
      @for (tag of getDisplayTags(); track tag) {
      <span class="tag">{{ tag }}</span>
      }
    </div>
    }
  </div>

  <div class="quick-actions">
    <!-- Secondary actions (all equal weight) -->
    <button type="button" class="action-button icon-only maps" (click)="onAction($event, 'GET_DIRECTIONS')"
      [disabled]="!isActionAvailable('GET_DIRECTIONS')"
      [title]="isActionAvailable('GET_DIRECTIONS') ? '×”×¦×’ ×‘××¤×•×ª' : 'Location not available'"
      [attr.aria-label]="isActionAvailable('GET_DIRECTIONS') ? 'Show ' + restaurant().name + ' on maps' : 'Location not available'">
      ğŸ“
    </button>
    <button type="button" class="action-button icon-only" (click)="onAction($event, 'CALL_RESTAURANT')"
      [disabled]="!isActionAvailable('CALL_RESTAURANT')"
      [title]="isActionAvailable('CALL_RESTAURANT') ? 'Call restaurant' : 'Phone number not available'"
      [attr.aria-label]="isActionAvailable('CALL_RESTAURANT') ? 'Call ' + restaurant().name : 'Phone number not available'">
      ğŸ“
    </button>
    <button type="button" class="action-button icon-only favorite" (click)="onAction($event, 'SAVE_FAVORITE')"
      [disabled]="!isActionAvailable('SAVE_FAVORITE')" title="Save to favorites"
      [attr.aria-label]="'Save ' + restaurant().name + ' to favorites'">
      â¤ï¸
    </button>
  </div>
</article>