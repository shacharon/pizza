<section class="places-page" aria-labelledby="places-heading">
    <h1 id="places-heading">{{ title() }}</h1>

    <form class="controls" (submit)="onSubmit(); $event.preventDefault()">
        <label class="query-input">
            <span>Query</span>
            <input type="text" [value]="query()" (input)="onQueryInput($event)"
                placeholder="e.g., pizza gluten free in gedera" />
        </label>

        <div class="controls-row">
            <label class="checkbox-label">
                <input type="checkbox" [checked]="nearMe()" (change)="onNearMeChange($event)" />
                <span>Near me</span>
            </label>

            <label class="mode-select">
                <span>Mode</span>
                <select [value]="mode()" (change)="onModeChange($event)">
                    <option value="textsearch">Text search</option>
                    <option value="nearbysearch">Nearby</option>
                    <option value="findplace">Find place</option>
                </select>
            </label>
        </div>

        <div class="hints" *ngIf="detectedLanguage()">
            <small>üìù Language: {{ detectedLanguage() === 'he' ? 'Hebrew' : 'English' }}</small>
            <small>üåç Region: {{ detectedRegion() }}</small>
        </div>

        <button type="submit" [disabled]="!canSearch" class="search-btn">
            {{ loading() ? 'Searching‚Ä¶' : 'Search' }}
        </button>
    </form>

    <div class="results-section" aria-live="polite">
        <p *ngIf="userLocation() as loc" class="location-info">
            üìç {{ loc.lat | number:'1.4-4' }}, {{ loc.lng | number:'1.4-4' }}
        </p>

        <p *ngIf="error()" class="error">{{ error() }}</p>

        <div *ngIf="results() as r" class="results-container">
            <div class="results-meta">
                <p class="results-summary">
                    <strong>{{ r.places.length }}</strong> places found in <strong>{{ r.meta.tookMs }}ms</strong>
                    <span class="mode-badge">{{ r.query.mode }}</span>
                </p>
                <p *ngIf="r.meta.note" class="note">
                    ‚ÑπÔ∏è {{ r.meta.note }}
                </p>
            </div>

            <div class="results-grid">
                <article *ngFor="let place of r.places; trackBy: trackByPlaceId" class="place-card">
                    <h3 class="place-name">{{ place.name }}</h3>

                    <p *ngIf="place.rating" class="place-rating">
                        ‚≠ê {{ place.rating | number:'1.1-1' }}
                        <span *ngIf="place.userRatingsTotal" class="rating-count">
                            ({{ place.userRatingsTotal }})
                        </span>
                    </p>

                    <p *ngIf="place.address" class="place-address">
                        üìç {{ place.address }}
                    </p>

                    <a *ngIf="place.location"
                        [href]="'https://www.google.com/maps/search/?api=1&query=' + place.location.lat + ',' + place.location.lng"
                        target="_blank" rel="noopener noreferrer" class="map-link">
                        View on Map ‚Üí
                    </a>
                </article>
            </div>
        </div>
    </div>
</section>