<div class="wrap">
    <div class="header-row">
        <h1>Chat</h1>
        <div class="query-inline" *ngIf="query() as q">
            <span>City: <b>{{ display(q.city) }}</b></span>
            <span>Type: <b>{{ display(q.type) }}</b></span>
            <span>Max Price: <b>{{ display(q.maxPrice) }}</b></span>
            <span>Dietary: <b>{{ display(q.dietary) }}</b></span>
            <span>ETA: <b>{{ display(q.deliveryEtaMinutes) }}</b></span>
        </div>
    </div>
    <app-chat-log [log]="log()"></app-chat-log>
    <app-chat-composer [pending]="pending()" [language]="language" (send)="input=$event; send()"
        (languageChange)="language=$event"></app-chat-composer>
    <app-guard-note
        [message]="guard() ? (guard()==='off_domain' ? 'Food-only: please specify city, cuisine, and budget.' : 'Policy active: focused on food ordering.') : null"></app-guard-note>
    <app-summary-card [top]="top3()" [pending]="pending()"></app-summary-card>
    <app-refine-chips [chips]="(chips() as any)" [disabled]="pending()" (toggle)="toggleChip($event)"
        (clearAll)="chips.set(chips().map(c=>({...c,active:false})))"></app-refine-chips>
    <div *ngIf="error()" class="err">{{ error() }}</div>

    <div *ngIf="hints() as hs" class="hints">
        <button type="button" *ngFor="let h of hs" (click)="pick(h)">{{ h.label }}</button>
    </div>

    <div *ngIf="cards() as cs" class="cards">
        <h3>Recommended</h3>
        <div class="card-list">
            <div class="card" *ngFor="let c of cs | slice:0:7">
                <a [href]="c.url" target="_blank" rel="noopener noreferrer">{{ c.title }}</a>
                <div class="subtitle" *ngIf="c.subtitle">{{ c.subtitle }}</div>
                <img *ngIf="c.imageUrl" [src]="c.imageUrl" alt="preview"
                    style="max-width: 200px; display:block; margin-top:6px;" />
            </div>
        </div>
    </div>



    <div *ngIf="results() as r" class="results">
        <h2>Results</h2>
        <div class="tables">
            <app-results-table [vendors]="r.vendors" [pending]="pending()" [canLoadMore]="true"
                (loadMore)="loadMore()" />

            <div class="items" *ngIf="false">
                <h3>Items</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Vendor</th>
                            <th>Price</th>
                            <th>Tags</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let i of []">
                            <td>{{ i.name }}</td>
                            <td>{{ i.vendorId }}</td>
                            <td>â‚ª{{ i.price }}</td>
                            <td>{{ (i.tags || []).join(', ') }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>