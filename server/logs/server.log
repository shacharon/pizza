{"level":"warn","time":"2026-02-01T22:22:28.564Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-02-01T22:22:29.423Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-02-01T22:22:29.428Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-02-01T22:22:29.430Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-02-01T22:22:29.439Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"warn","time":"2026-02-01T22:22:28.571Z","pid":24844,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-02-01T22:22:29.506Z","pid":24844,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-02-01T22:22:29.510Z","pid":24844,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-02-01T22:22:29.513Z","pid":24844,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-02-01T22:22:29.523Z","pid":24844,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-02-01T22:22:29.640Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-02-01T22:22:29.646Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":204,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-02-01T22:22:29.657Z","pid":24844,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-02-01T22:22:29.662Z","pid":24844,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":137,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-02-01T22:22:29.650Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-02-01T22:22:29.673Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-02-01T22:22:29.688Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-02-01T22:22:29.690Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-02-01T22:22:29.697Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-02-01T22:22:29.704Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-02-01T22:22:29.707Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-02-01T22:22:29.712Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-02-01T22:22:29.668Z","pid":24844,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-02-01T22:22:29.691Z","pid":24844,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-02-01T22:22:29.707Z","pid":24844,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-02-01T22:22:29.712Z","pid":24844,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-02-01T22:22:29.724Z","pid":24844,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-02-01T22:22:29.726Z","pid":24844,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-02-01T22:22:29.728Z","pid":24844,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-02-01T22:22:29.731Z","pid":24844,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-02-01T22:22:29.743Z","pid":24844,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-02-01T22:22:31.932Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","traceId":"488a411a-086d-491b-85c8-17a648e03e34","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"1a2b05a70cb3","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-02-01T22:22:32.142Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984552142-cx8ed3","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-02-01T22:22:32.185Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984552142-cx8ed3","event":"ws_assistant_raw_received","rawMessage":{"v":1,"type":"subscribe","channel":"search","requestId":"req-1769984350106-sdmjpp7ml"},"rawMessage.type":"subscribe","msg":"[WS] Raw message received (pre-normalization)"}
{"level":"info","time":"2026-02-01T22:22:32.190Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-02-01T22:22:32.193Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-02-01T22:22:32.194Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-02-01T22:22:32.195Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized with shared client"}
{"level":"info","time":"2026-02-01T22:22:32.197Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984552142-cx8ed3","event":"ws_assistant_raw_received","rawMessage":{"v":1,"type":"subscribe","channel":"assistant","requestId":"req-1769984350106-sdmjpp7ml"},"rawMessage.type":"subscribe","msg":"[WS] Raw message received (pre-normalization)"}
{"level":"info","time":"2026-02-01T22:22:32.203Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984552142-cx8ed3","channel":"search","requestIdHash":"57258ced42d3","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-02-01T22:22:32.204Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984552142-cx8ed3","channel":"search","requestIdHash":"57258ced42d3","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-02-01T22:22:32.211Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984552142-cx8ed3","channel":"assistant","requestIdHash":"57258ced42d3","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-02-01T22:22:32.212Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984552142-cx8ed3","channel":"assistant","requestIdHash":"57258ced42d3","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-02-01T22:22:34.235Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","traceId":"6718d10c-c962-4529-a8ce-b524f7436f7b","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"307d65119888","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-02-01T22:22:34.265Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984554265-r2tnyf","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-02-01T22:22:34.281Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984554265-r2tnyf","event":"ws_assistant_raw_received","rawMessage":{"v":1,"type":"subscribe","channel":"search","requestId":"req-1769982488663-qp9dsnor7"},"rawMessage.type":"subscribe","msg":"[WS] Raw message received (pre-normalization)"}
{"level":"info","time":"2026-02-01T22:22:34.286Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984554265-r2tnyf","event":"ws_assistant_raw_received","rawMessage":{"v":1,"type":"subscribe","channel":"assistant","requestId":"req-1769982488663-qp9dsnor7"},"rawMessage.type":"subscribe","msg":"[WS] Raw message received (pre-normalization)"}
{"level":"info","time":"2026-02-01T22:22:34.294Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984554265-r2tnyf","channel":"search","requestIdHash":"8424d9b07538","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-02-01T22:22:34.295Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984554265-r2tnyf","channel":"search","requestIdHash":"8424d9b07538","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-02-01T22:22:34.298Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984554265-r2tnyf","channel":"assistant","requestIdHash":"8424d9b07538","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-02-01T22:22:34.299Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984554265-r2tnyf","channel":"assistant","requestIdHash":"8424d9b07538","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-02-01T22:22:50.288Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","query":"פיצה לידי","status":"PENDING","hasOwner":true,"hasIdempotencyKey":true,"msg":"[RedisJobStore] Job created"}
{"level":"info","time":"2026-02-01T22:22:50.290Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","sessionHash":"2c3b20d765e7","hasUserId":false,"operation":"createJob","decision":"ACCEPTED","hasIdempotencyKey":true,"event":"job_created","msg":"[Observability] Job created with JWT session binding and idempotency key"}
{"level":"info","time":"2026-02-01T22:22:50.300Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","status":"RUNNING","progress":10,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-02-01T22:22:50.303Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","status":"RUNNING","progress":10,"event":"status_running","msg":"[Observability] Job status set to RUNNING"}
{"level":"info","time":"2026-02-01T22:22:50.309Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769984570266-novnb98em","event":"backlog_created","msg":"WebSocket backlog created for late subscribers"}
{"level":"info","time":"2026-02-01T22:22:50.312Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","pipelineVersion":"route2","event":"pipeline_selected","queryLen":9,"queryHash":"8e6ac041c508","msg":"[ROUTE2] Pipeline selected"}
{"level":"info","time":"2026-02-01T22:22:50.314Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","pipelineVersion":"route2","event":"device_region_resolved","userRegionCode":"IL","userRegionSource":"config","msg":"[ROUTE2] Device region resolved"}
{"level":"info","time":"2026-02-01T22:22:50.317Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","traceId":"711d909c-cbc6-4dd8-830e-ec47d214ae3b","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_started","queryLen":9,"queryHash":"8e6ac041c508","msg":"[ROUTE2] gate2 started"}
{"level":"info","time":"2026-02-01T22:22:50.727Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984552142-cx8ed3","event":"ws_assistant_raw_received","rawMessage":{"v":1,"type":"subscribe","channel":"search","requestId":"req-1769984570266-novnb98em","sessionId":"session-1769984348543-h4ya8bssn"},"rawMessage.type":"subscribe","msg":"[WS] Raw message received (pre-normalization)"}
{"level":"info","time":"2026-02-01T22:22:50.729Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984552142-cx8ed3","event":"ws_assistant_raw_received","rawMessage":{"v":1,"type":"subscribe","channel":"assistant","requestId":"req-1769984570266-novnb98em","sessionId":"session-1769984348543-h4ya8bssn"},"rawMessage.type":"subscribe","msg":"[WS] Raw message received (pre-normalization)"}
{"level":"info","time":"2026-02-01T22:22:50.742Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984552142-cx8ed3","channel":"search","requestIdHash":"af0ccd4aea67","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-02-01T22:22:50.743Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984552142-cx8ed3","channel":"search","requestIdHash":"af0ccd4aea67","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-02-01T22:22:50.744Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984552142-cx8ed3","channel":"assistant","requestIdHash":"af0ccd4aea67","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-02-01T22:22:50.744Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984552142-cx8ed3","channel":"assistant","requestIdHash":"af0ccd4aea67","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-02-01T22:22:50.747Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769984570266-novnb98em","count":1,"event":"backlog_drained","msg":"WebSocket backlog drained to late subscriber"}
{"level":"info","time":"2026-02-01T22:22:51.771Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"711d909c-cbc6-4dd8-830e-ec47d214ae3b","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1443,"success":true,"retryCount":0,"timestamp":"2026-02-01T22:22:51.770Z","model":"gpt-4o-mini","tokensIn":813,"tokensOut":29,"totalTokens":842,"schemaName":"response","schemaStrict":true,"schemaHash":"3b804db9f217","schemaVersion":"v1","promptVersion":"gate2_v8","promptHash":"13ab6b6e77d29c736bd7136279cfa503e2c1e679d7b83e27977e81234b3c3b65","promptLength":2228,"estimatedCostUsd":0.00013935,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-02-01T22:22:51.814Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","traceId":"711d909c-cbc6-4dd8-830e-ec47d214ae3b","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_completed","durationMs":1497,"route":"CONTINUE","foodSignal":"YES","confidence":0.95,"tokenUsage":{"input":813,"output":29,"total":842,"model":"gpt-4o-mini"},"msg":"[ROUTE2] gate2 completed"}
{"level":"info","time":"2026-02-01T22:22:51.926Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","event":"assistant_language_resolved","assistantLanguage":"he","source":"llm_confident","detectedLanguage":"he","languageConfidence":0.95,"confidenceThreshold":0.7,"msg":"[ASSISTANT] Language resolved for assistant message"}
{"level":"info","time":"2026-02-01T22:22:51.927Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","event":"langCtx_initialized","source":"gate2","assistantLanguage":"he","confidence":0.95,"msg":"[ROUTE2] langCtx initialized from Gate2 - assistantLanguage set"}
{"level":"info","time":"2026-02-01T22:22:51.944Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","status":"RUNNING","progress":25,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-02-01T22:22:51.953Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","traceId":"711d909c-cbc6-4dd8-830e-ec47d214ae3b","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"intent","event":"stage_started","queryLen":9,"queryHash":"8e6ac041c508","msg":"[ROUTE2] intent started"}
{"level":"info","time":"2026-02-01T22:22:54.164Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"e3dc73c6-a1c6-46ab-ae1e-f1b5ba9abe8e","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-02-01T22:22:54.180Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":3898,"updatedAgeMs":2233,"progress":25,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 3898, updatedAgeMs: 2233"}
{"level":"info","time":"2026-02-01T22:22:55.120Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"711d909c-cbc6-4dd8-830e-ec47d214ae3b","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":3166,"success":true,"retryCount":0,"timestamp":"2026-02-01T22:22:55.120Z","model":"gpt-4o-mini","tokensIn":1115,"tokensOut":176,"totalTokens":1291,"schemaName":"response","schemaStrict":true,"schemaHash":"00a65cec2acb","schemaVersion":"v1","promptVersion":"intent_v8","promptHash":"949f11ce802a9c0e67da6e48e48bcaa9cd786465c707cbf864fd21aeb7761515","estimatedCostUsd":0.00027285,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-02-01T22:22:55.130Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"intent","promptVersion":"intent_v8","schemaHash":"ffa797219a2f","requestId":"req-1769984570266-novnb98em","traceId":"711d909c-cbc6-4dd8-830e-ec47d214ae3b","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":5500,"timeoutHit":false,"buildPromptMs":0.12,"networkMs":3168.29,"parseMs":7.73,"totalMs":3176.24,"promptChars":2937,"inputTokens":1115,"outputTokens":176,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-02-01T22:22:55.135Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","traceId":"711d909c-cbc6-4dd8-830e-ec47d214ae3b","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"intent","event":"stage_completed","durationMs":3182,"route":"NEARBY","confidence":0.9,"reason":"MISSING_LOCATION","msg":"[ROUTE2] intent completed"}
{"level":"info","time":"2026-02-01T22:22:55.156Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","status":"RUNNING","progress":40,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-02-01T22:22:55.161Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","event":"intent_clarify_llm","assistantLanguage":"he","reason":"MISSING_LOCATION","hasClarify":true,"source":"intent_llm","msg":"[ROUTE2] CLARIFY path - using Intent LLM-generated text"}
{"level":"info","time":"2026-02-01T22:22:55.163Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","channel":"assistant","requestId":"req-1769984570266-novnb98em","sessionHash":"2c3b20d765e7","payloadType":"assistant","assistantLanguage":"he","uiLanguage":"he","assistantType":"CLARIFY","event":"assistant_ws_publish","msg":"[ASSISTANT] Publishing to WebSocket with assistantLanguage"}
{"level":"info","time":"2026-02-01T22:22:55.164Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","event":"ws_assistant_out_raw","requestId":"req-1769984570266-novnb98em","clientId":"ws-1769984552142-cx8ed3","channel":"assistant","payloadType":"CLARIFY","assistantLanguage":"he","uiLanguage":"he","envelopeKeys":["type","requestId","assistantLanguage","uiLanguage","payload"],"payloadKeys":["type","message","question","blocksSearch"],"rawJsonLen":296,"rawJsonPreview":"{\"type\":\"assistant\",\"requestId\":\"req-1769984570266-novnb98em\",\"assistantLanguage\":\"he\",\"uiLanguage\":\"he\",\"payload\":{\"type\":\"CLARIFY\",\"message\":\"כדי לחפש 'לידי' אני צריך את המיקום שלך. אפשר לאשר מיקום או לכתוב עיר/אזור (למשל: 'פיצה בגדרה').\",\"question\":\"באיזה אזור אתה מחפש?\",\"blocksSearch\":true}}","msg":"[WS OUT] Raw assistant message before send"}
{"level":"info","time":"2026-02-01T22:22:55.172Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","channel":"assistant","event":"assistant_published","assistantLanguage":"he","assistantType":"CLARIFY","blocksSearch":true,"msg":"[ASSISTANT] Published to WebSocket"}
{"level":"info","time":"2026-02-01T22:22:55.173Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","event":"assistant_publish_source","source":"intent_llm","clarifyReason":"MISSING_LOCATION","assistantLanguage":"he","msg":"[ROUTE2] Published Intent CLARIFY text (source: intent_llm)"}
{"level":"info","time":"2026-02-01T22:22:55.179Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","hasResult":true,"msg":"[RedisJobStore] Result stored"}
{"level":"info","time":"2026-02-01T22:22:55.180Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","resultCount":0,"hasAssist":true,"event":"result_stored","msg":"[Observability] Search result stored successfully"}
{"level":"info","time":"2026-02-01T22:22:55.187Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","status":"DONE_STOPPED","progress":100,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-02-01T22:22:55.189Z","pid":21360,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769984570266-novnb98em","status":"DONE_STOPPED","progress":100,"event":"status_done","msg":"[Observability] Job reached terminal status"}
{"level":"info","time":"2026-02-01T22:23:46.015Z","pid":27104,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ru-1","stage":"assistant_llm","event":"assistant_llm_start","type":"SUMMARY","questionLanguage":"ru","queryLen":17,"schemaVersion":"v4_output_language","promptVersion":"v3_hard_language_rule","msg":"[ASSISTANT] Calling LLM"}
{"level":"info","time":"2026-02-01T22:23:46.072Z","pid":27104,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ru-1","stage":"assistant_llm","event":"assistant_llm_success","type":"SUMMARY","questionLanguage":"ru","suggestedAction":"NONE","blocksSearch":false,"durationMs":31,"usage":{"promptTokens":100,"completionTokens":50},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"info","time":"2026-02-01T22:23:46.082Z","pid":27104,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ru-2","stage":"assistant_llm","event":"assistant_llm_start","type":"SUMMARY","questionLanguage":"ru","queryLen":19,"schemaVersion":"v4_output_language","promptVersion":"v3_hard_language_rule","msg":"[ASSISTANT] Calling LLM"}
{"level":"warn","time":"2026-02-01T22:23:46.087Z","pid":27104,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ru-2","event":"assistant_output_language_mismatch","requestedLanguage":"ru","outputLanguage":"en","type":"SUMMARY","action":"using_language_fallback","msg":"[ASSISTANT] LLM outputLanguage does not match requestedLanguage - using deterministic fallback"}
{"level":"info","time":"2026-02-01T22:23:46.088Z","pid":27104,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ru-2","stage":"assistant_llm","event":"assistant_llm_success","type":"SUMMARY","questionLanguage":"ru","suggestedAction":"NONE","blocksSearch":false,"durationMs":4,"usage":{"promptTokens":100,"completionTokens":50},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"info","time":"2026-02-01T22:23:46.092Z","pid":27104,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ar-1","stage":"assistant_llm","event":"assistant_llm_start","type":"SUMMARY","questionLanguage":"ar","queryLen":13,"schemaVersion":"v4_output_language","promptVersion":"v3_hard_language_rule","msg":"[ASSISTANT] Calling LLM"}
{"level":"info","time":"2026-02-01T22:23:46.096Z","pid":27104,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ar-1","stage":"assistant_llm","event":"assistant_llm_success","type":"SUMMARY","questionLanguage":"ar","suggestedAction":"NONE","blocksSearch":false,"durationMs":3,"usage":{"promptTokens":120,"completionTokens":40},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"info","time":"2026-02-01T22:23:46.099Z","pid":27104,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ar-2","stage":"assistant_llm","event":"assistant_llm_start","type":"SUMMARY","questionLanguage":"ar","queryLen":18,"schemaVersion":"v4_output_language","promptVersion":"v3_hard_language_rule","msg":"[ASSISTANT] Calling LLM"}
{"level":"warn","time":"2026-02-01T22:23:46.101Z","pid":27104,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ar-2","event":"assistant_output_language_mismatch","requestedLanguage":"ar","outputLanguage":"en","type":"SUMMARY","action":"using_language_fallback","msg":"[ASSISTANT] LLM outputLanguage does not match requestedLanguage - using deterministic fallback"}
{"level":"info","time":"2026-02-01T22:23:46.101Z","pid":27104,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ar-2","stage":"assistant_llm","event":"assistant_llm_success","type":"SUMMARY","questionLanguage":"ar","suggestedAction":"NONE","blocksSearch":false,"durationMs":2,"usage":{"promptTokens":100,"completionTokens":45},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"info","time":"2026-02-01T22:23:46.105Z","pid":27104,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ru-prompt","stage":"assistant_llm","event":"assistant_llm_start","type":"SUMMARY","questionLanguage":"ru","queryLen":5,"schemaVersion":"v4_output_language","promptVersion":"v3_hard_language_rule","msg":"[ASSISTANT] Calling LLM"}
{"level":"info","time":"2026-02-01T22:23:46.107Z","pid":27104,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ru-prompt","stage":"assistant_llm","event":"assistant_llm_success","type":"SUMMARY","questionLanguage":"ru","suggestedAction":"NONE","blocksSearch":false,"durationMs":2,"usage":{"promptTokens":100,"completionTokens":30},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"info","time":"2026-02-01T22:23:46.116Z","pid":27104,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-integration","stage":"assistant_llm","event":"assistant_llm_start","type":"SUMMARY","questionLanguage":"ru","queryLen":25,"schemaVersion":"v4_output_language","promptVersion":"v3_hard_language_rule","msg":"[ASSISTANT] Calling LLM"}
{"level":"info","time":"2026-02-01T22:23:46.117Z","pid":27104,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-integration","stage":"assistant_llm","event":"assistant_llm_success","type":"SUMMARY","questionLanguage":"ru","suggestedAction":"NONE","blocksSearch":false,"durationMs":1,"usage":{"promptTokens":150,"completionTokens":60},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"warn","time":"2026-02-01T22:24:14.116Z","pid":508,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-02-01T22:24:15.991Z","pid":508,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-02-01T22:24:15.994Z","pid":508,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-02-01T22:24:15.997Z","pid":508,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-02-01T22:24:16.002Z","pid":508,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"warn","time":"2026-02-01T22:24:14.039Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-02-01T22:24:15.958Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-02-01T22:24:15.967Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-02-01T22:24:15.970Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-02-01T22:24:15.974Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-02-01T22:24:16.404Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-02-01T22:24:16.533Z","pid":508,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-02-01T22:24:16.538Z","pid":508,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":535,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-02-01T22:24:16.420Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":444,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-02-01T22:24:16.542Z","pid":508,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-02-01T22:24:16.559Z","pid":508,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-02-01T22:24:16.571Z","pid":508,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-02-01T22:24:16.572Z","pid":508,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-02-01T22:24:16.676Z","pid":508,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-02-01T22:24:16.679Z","pid":508,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-02-01T22:24:16.684Z","pid":508,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-02-01T22:24:16.687Z","pid":508,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-02-01T22:24:16.709Z","pid":508,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-02-01T22:24:16.424Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-02-01T22:24:16.535Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-02-01T22:24:16.552Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-02-01T22:24:16.561Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-02-01T22:24:16.573Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-02-01T22:24:16.575Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-02-01T22:24:16.582Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-02-01T22:24:16.696Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-02-01T22:24:17.233Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","traceId":"a874ac12-b906-4469-8943-90bbebe04f70","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"70ead11ffd4e","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-02-01T22:24:17.390Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984657389-epkrk1","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-02-01T22:24:17.440Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984657389-epkrk1","event":"ws_assistant_raw_received","rawMessage":{"v":1,"type":"subscribe","channel":"search","requestId":"req-1769984570266-novnb98em"},"rawMessage.type":"subscribe","msg":"[WS] Raw message received (pre-normalization)"}
{"level":"info","time":"2026-02-01T22:24:17.444Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-02-01T22:24:17.447Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-02-01T22:24:17.449Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-02-01T22:24:17.450Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized with shared client"}
{"level":"info","time":"2026-02-01T22:24:17.451Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984657389-epkrk1","event":"ws_assistant_raw_received","rawMessage":{"v":1,"type":"subscribe","channel":"assistant","requestId":"req-1769984570266-novnb98em"},"rawMessage.type":"subscribe","msg":"[WS] Raw message received (pre-normalization)"}
{"level":"info","time":"2026-02-01T22:24:17.500Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984657389-epkrk1","channel":"search","requestIdHash":"af0ccd4aea67","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-02-01T22:24:17.502Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984657389-epkrk1","channel":"search","requestIdHash":"af0ccd4aea67","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-02-01T22:24:17.508Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984657389-epkrk1","channel":"assistant","requestIdHash":"af0ccd4aea67","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-02-01T22:24:17.509Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984657389-epkrk1","channel":"assistant","requestIdHash":"af0ccd4aea67","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-02-01T22:24:18.134Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","traceId":"dc0c2f4a-1600-4cfe-bfc4-a54b59ce69fa","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"3d4f5f029a59","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-02-01T22:24:18.158Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984658158-wiyhr7","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-02-01T22:24:18.162Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984658158-wiyhr7","event":"ws_assistant_raw_received","rawMessage":{"v":1,"type":"subscribe","channel":"search","requestId":"req-1769982488663-qp9dsnor7"},"rawMessage.type":"subscribe","msg":"[WS] Raw message received (pre-normalization)"}
{"level":"info","time":"2026-02-01T22:24:18.165Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984658158-wiyhr7","event":"ws_assistant_raw_received","rawMessage":{"v":1,"type":"subscribe","channel":"assistant","requestId":"req-1769982488663-qp9dsnor7"},"rawMessage.type":"subscribe","msg":"[WS] Raw message received (pre-normalization)"}
{"level":"info","time":"2026-02-01T22:24:18.170Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984658158-wiyhr7","channel":"search","requestIdHash":"8424d9b07538","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-02-01T22:24:18.171Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984658158-wiyhr7","channel":"search","requestIdHash":"8424d9b07538","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-02-01T22:24:18.178Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984658158-wiyhr7","channel":"assistant","requestIdHash":"8424d9b07538","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-02-01T22:24:18.178Z","pid":23192,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769984658158-wiyhr7","channel":"assistant","requestIdHash":"8424d9b07538","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-02-01T22:24:29.331Z","pid":22748,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ru-1","stage":"assistant_llm","event":"assistant_llm_start","type":"SUMMARY","questionLanguage":"ru","queryLen":17,"schemaVersion":"v4_output_language","promptVersion":"v3_hard_language_rule","msg":"[ASSISTANT] Calling LLM"}
{"level":"info","time":"2026-02-01T22:24:29.354Z","pid":22748,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ru-1","stage":"assistant_llm","event":"assistant_llm_success","type":"SUMMARY","questionLanguage":"ru","suggestedAction":"NONE","blocksSearch":false,"durationMs":23,"usage":{"promptTokens":100,"completionTokens":50},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"info","time":"2026-02-01T22:24:29.367Z","pid":22748,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ru-2","stage":"assistant_llm","event":"assistant_llm_start","type":"SUMMARY","questionLanguage":"ru","queryLen":19,"schemaVersion":"v4_output_language","promptVersion":"v3_hard_language_rule","msg":"[ASSISTANT] Calling LLM"}
{"level":"warn","time":"2026-02-01T22:24:29.369Z","pid":22748,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ru-2","event":"assistant_output_language_mismatch","requestedLanguage":"ru","outputLanguage":"en","type":"SUMMARY","action":"using_language_fallback","msg":"[ASSISTANT] LLM outputLanguage does not match requestedLanguage - using deterministic fallback"}
{"level":"info","time":"2026-02-01T22:24:29.371Z","pid":22748,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ru-2","stage":"assistant_llm","event":"assistant_llm_success","type":"SUMMARY","questionLanguage":"ru","suggestedAction":"NONE","blocksSearch":false,"durationMs":2,"usage":{"promptTokens":100,"completionTokens":50},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"info","time":"2026-02-01T22:24:29.376Z","pid":22748,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ar-1","stage":"assistant_llm","event":"assistant_llm_start","type":"SUMMARY","questionLanguage":"ar","queryLen":13,"schemaVersion":"v4_output_language","promptVersion":"v3_hard_language_rule","msg":"[ASSISTANT] Calling LLM"}
{"level":"info","time":"2026-02-01T22:24:29.383Z","pid":22748,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ar-1","stage":"assistant_llm","event":"assistant_llm_success","type":"SUMMARY","questionLanguage":"ar","suggestedAction":"NONE","blocksSearch":false,"durationMs":5,"usage":{"promptTokens":120,"completionTokens":40},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"info","time":"2026-02-01T22:24:29.386Z","pid":22748,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ar-2","stage":"assistant_llm","event":"assistant_llm_start","type":"SUMMARY","questionLanguage":"ar","queryLen":18,"schemaVersion":"v4_output_language","promptVersion":"v3_hard_language_rule","msg":"[ASSISTANT] Calling LLM"}
{"level":"warn","time":"2026-02-01T22:24:29.391Z","pid":22748,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ar-2","event":"assistant_output_language_mismatch","requestedLanguage":"ar","outputLanguage":"en","type":"SUMMARY","action":"using_language_fallback","msg":"[ASSISTANT] LLM outputLanguage does not match requestedLanguage - using deterministic fallback"}
{"level":"info","time":"2026-02-01T22:24:29.392Z","pid":22748,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ar-2","stage":"assistant_llm","event":"assistant_llm_success","type":"SUMMARY","questionLanguage":"ar","suggestedAction":"NONE","blocksSearch":false,"durationMs":5,"usage":{"promptTokens":100,"completionTokens":45},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"info","time":"2026-02-01T22:24:29.404Z","pid":22748,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ru-prompt","stage":"assistant_llm","event":"assistant_llm_start","type":"SUMMARY","questionLanguage":"ru","queryLen":5,"schemaVersion":"v4_output_language","promptVersion":"v3_hard_language_rule","msg":"[ASSISTANT] Calling LLM"}
{"level":"info","time":"2026-02-01T22:24:29.407Z","pid":22748,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-ru-prompt","stage":"assistant_llm","event":"assistant_llm_success","type":"SUMMARY","questionLanguage":"ru","suggestedAction":"NONE","blocksSearch":false,"durationMs":3,"usage":{"promptTokens":100,"completionTokens":30},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"info","time":"2026-02-01T22:24:29.411Z","pid":22748,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-integration","stage":"assistant_llm","event":"assistant_llm_start","type":"SUMMARY","questionLanguage":"ru","queryLen":25,"schemaVersion":"v4_output_language","promptVersion":"v3_hard_language_rule","msg":"[ASSISTANT] Calling LLM"}
{"level":"info","time":"2026-02-01T22:24:29.414Z","pid":22748,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-integration","stage":"assistant_llm","event":"assistant_llm_success","type":"SUMMARY","questionLanguage":"ru","suggestedAction":"NONE","blocksSearch":false,"durationMs":4,"usage":{"promptTokens":150,"completionTokens":60},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
