{"level":"info","time":"2026-01-30T14:01:25.531Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-01-30T14:01:25.536Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-01-30T14:01:25.537Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-01-30T14:01:25.538Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized successfully"}
{"level":"info","time":"2026-01-30T14:01:25.549Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","query":"מה יש לאכול היום","status":"PENDING","hasOwner":true,"hasIdempotencyKey":true,"msg":"[RedisJobStore] Job created"}
{"level":"info","time":"2026-01-30T14:01:25.550Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","sessionHash":"2c3b20d765e7","hasUserId":false,"operation":"createJob","decision":"ACCEPTED","hasIdempotencyKey":true,"msg":"[P0 Security] Job created with JWT session binding and idempotency key"}
{"level":"info","time":"2026-01-30T14:01:25.560Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","status":"RUNNING","progress":10,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-30T14:01:25.562Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769781685524-lcn675en8","event":"backlog_created","msg":"WebSocket backlog created for late subscribers"}
{"level":"info","time":"2026-01-30T14:01:25.573Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769781672429-ese7j0","channel":"search","requestIdHash":"10a7d01e8ec7","sessionHash":"2c3b20d7","pending":false,"event":"ws_subscribe_ack","msg":"Subscribe accepted - owner match"}
{"level":"info","time":"2026-01-30T14:01:25.574Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769781672429-ese7j0","channel":"search","requestIdHash":"10a7d01e8ec7","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-30T14:01:25.577Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769781685524-lcn675en8","count":1,"event":"backlog_drained","msg":"WebSocket backlog drained to late subscriber"}
{"level":"info","time":"2026-01-30T14:01:25.580Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","status":"RUNNING","progress":50,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-30T14:01:25.583Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","pipelineVersion":"route2","event":"pipeline_selected","queryLen":16,"queryHash":"d00101b29341","msg":"[ROUTE2] Pipeline selected"}
{"level":"info","time":"2026-01-30T14:01:25.583Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","pipelineVersion":"route2","event":"query_language_detected","queryLanguage":"he","queryLen":16,"msg":"[ROUTE2] Query language detected (deterministic)"}
{"level":"info","time":"2026-01-30T14:01:25.584Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769781672429-ese7j0","channel":"assistant","requestIdHash":"10a7d01e8ec7","sessionHash":"2c3b20d7","pending":false,"event":"ws_subscribe_ack","msg":"Subscribe accepted - owner match"}
{"level":"info","time":"2026-01-30T14:01:25.585Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","pipelineVersion":"route2","event":"device_region_resolved","userRegionCode":"IL","userRegionSource":"config","msg":"[ROUTE2] Device region resolved"}
{"level":"info","time":"2026-01-30T14:01:25.586Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","traceId":"a41bce45-a29d-4ccb-add8-7e0f16d121c3","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_started","queryLen":16,"queryHash":"d00101b29341","msg":"[ROUTE2] gate2 started"}
{"level":"info","time":"2026-01-30T14:01:25.594Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769781672429-ese7j0","channel":"assistant","requestIdHash":"10a7d01e8ec7","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-30T14:01:26.736Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"a41bce45-a29d-4ccb-add8-7e0f16d121c3","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1146,"success":true,"retryCount":0,"timestamp":"2026-01-30T14:01:26.735Z","model":"gpt-4o-mini","tokensIn":382,"tokensOut":12,"totalTokens":394,"schemaName":"response","schemaStrict":true,"schemaHash":"ecbf2c0a0457","schemaVersion":"v1","promptVersion":"gate2_v4","promptHash":"781640b134b1bdffb237ee48622de2f20ebc911203fc18971f33f55e3547824f","promptLength":1012,"estimatedCostUsd":0.0000645,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-30T14:01:26.742Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","traceId":"a41bce45-a29d-4ccb-add8-7e0f16d121c3","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_completed","durationMs":1156,"route":"CONTINUE","foodSignal":"YES","confidence":0.85,"tokenUsage":{"input":382,"output":12,"total":394,"model":"gpt-4o-mini"},"msg":"[ROUTE2] gate2 completed"}
{"level":"info","time":"2026-01-30T14:01:26.744Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","pipelineVersion":"route2","event":"parallel_started","msg":"[ROUTE2] Starting parallel tasks (base_filters + post_constraints + intent chain)"}
{"level":"info","time":"2026-01-30T14:01:26.744Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","pipelineVersion":"route2","event":"base_filters_llm_started","query":"מה יש לאכול היום","route":"TEXTSEARCH","msg":"[ROUTE2] Base filters LLM started"}
{"level":"info","time":"2026-01-30T14:01:26.746Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","traceId":"a41bce45-a29d-4ccb-add8-7e0f16d121c3","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"intent","event":"stage_started","queryLen":16,"queryHash":"d00101b29341","msg":"[ROUTE2] intent started"}
{"level":"info","time":"2026-01-30T14:01:28.739Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"a41bce45-a29d-4ccb-add8-7e0f16d121c3","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1994,"success":true,"retryCount":0,"timestamp":"2026-01-30T14:01:28.739Z","model":"gpt-4o-mini","tokensIn":1693,"tokensOut":61,"totalTokens":1754,"schemaName":"response","schemaStrict":true,"schemaHash":"9cb7c40fd303","schemaVersion":"v1","promptVersion":"post_constraints_v1","promptHash":"7a9eb00cc4c93e1a79c0b2b54a37ae3f0f136351e35eca7a675dba627252da53","estimatedCostUsd":0.00029055,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-30T14:01:28.741Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"post_constraints","promptVersion":"post_constraints_v1","schemaHash":"666abe1760c4","requestId":"req-1769781685524-lcn675en8","traceId":"a41bce45-a29d-4ccb-add8-7e0f16d121c3","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3500,"timeoutHit":false,"buildPromptMs":0.07,"networkMs":1994.35,"parseMs":1.05,"totalMs":1995.51,"promptChars":4339,"inputTokens":1693,"outputTokens":61,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"warn","time":"2026-01-30T14:01:28.752Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"a41bce45-a29d-4ccb-add8-7e0f16d121c3","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":2006,"success":false,"retryCount":0,"errorCode":"Error","errorReason":"Request was aborted.","timestamp":"2026-01-30T14:01:28.751Z","msg":"Provider call failed: openai.completeJSON"}
{"level":"warn","time":"2026-01-30T14:01:28.753Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"base_filters_llm","promptVersion":"base_filters_v1","requestId":"req-1769781685524-lcn675en8","traceId":"a41bce45-a29d-4ccb-add8-7e0f16d121c3","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":2000,"timeoutHit":true,"buildPromptMs":0.11,"networkMs":2007.78,"parseMs":0,"totalMs":2007.99,"promptChars":5603,"inputTokens":null,"outputTokens":null,"retriesCount":0,"success":false,"errorType":"abort_timeout","errorReason":"Request aborted or timeout","statusCode":null,"msg":"llm_gate_timing"}
{"level":"error","time":"2026-01-30T14:01:28.754Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","traceId":"a41bce45-a29d-4ccb-add8-7e0f16d121c3","errorType":"abort_timeout","msg":"[LLM] Non-retriable error, failing fast"}
{"level":"warn","time":"2026-01-30T14:01:28.754Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","pipelineVersion":"route2","event":"base_filters_fallback","durationMs":2010,"reason":"timeout","error":"Request was aborted.","msg":"[ROUTE2] Base filters LLM fallback"}
{"level":"info","time":"2026-01-30T14:01:29.205Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"a41bce45-a29d-4ccb-add8-7e0f16d121c3","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":2458,"success":true,"retryCount":0,"timestamp":"2026-01-30T14:01:29.205Z","model":"gpt-4o-mini","tokensIn":613,"tokensOut":49,"totalTokens":662,"schemaName":"response","schemaStrict":true,"schemaHash":"eb2d1262aa1b","schemaVersion":"v1","promptVersion":"intent_v4","promptHash":"155644defca6223b4476ccb8091a83e56ca4685e138fd0c2b5105aef72b200aa","estimatedCostUsd":0.00012135,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-30T14:01:29.206Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"intent","promptVersion":"intent_v4","schemaHash":"da796502f3aa","requestId":"req-1769781685524-lcn675en8","traceId":"a41bce45-a29d-4ccb-add8-7e0f16d121c3","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":2500,"timeoutHit":false,"buildPromptMs":0.08,"networkMs":2458.45,"parseMs":0.8,"totalMs":2459.4,"promptChars":1742,"inputTokens":613,"outputTokens":49,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-30T14:01:29.207Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","traceId":"a41bce45-a29d-4ccb-add8-7e0f16d121c3","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"intent","event":"stage_completed","durationMs":2461,"route":"TEXTSEARCH","confidence":0.8,"reason":"default_textsearch","msg":"[ROUTE2] intent completed"}
{"level":"info","time":"2026-01-30T14:01:29.207Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","pipelineVersion":"route2","event":"intent_decided","route":"TEXTSEARCH","regionCandidate":"IL","language":"he","confidence":0.8,"reason":"default_textsearch","msg":"[ROUTE2] Intent routing decided (regionCandidate will be validated by filters_resolved)"}
{"level":"info","time":"2026-01-30T14:01:29.208Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","pipelineVersion":"route2","event":"generic_query_blocked","reason":"no_location_anchor","query":"מה יש לאכול היום","hasUserLocation":false,"hasCityText":false,"msg":"[ROUTE2] Blocking generic food query without location anchor"}
{"level":"info","time":"2026-01-30T14:01:29.208Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","event":"assistant_language_resolved","assistantLanguage":"he","source":"queryLanguage","queryLanguage":"he","detectedLanguage":"other","msg":"[ASSISTANT] Language resolved for assistant message"}
{"level":"info","time":"2026-01-30T14:01:29.208Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","assistantType":"CLARIFY","sessionIdPresent":true,"event":"assistant_called","msg":"[ASSISTANT] Hook invoked"}
{"level":"info","time":"2026-01-30T14:01:29.209Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","stage":"assistant_llm","event":"assistant_llm_start","type":"CLARIFY","reason":"GENERIC_QUERY_NO_LOCATION","questionLanguage":"he","queryLen":16,"schemaVersion":"v3_strict_validation","promptVersion":"v2_language_enforcement","msg":"[ASSISTANT] Calling LLM"}
{"level":"info","time":"2026-01-30T14:01:29.644Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"1b6d9204-8775-4038-99d5-b925fc688f26","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-30T14:01:31.099Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"7b958782-f83a-4b7a-a32e-5e1266d33930","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-30T14:01:31.647Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"a41bce45-a29d-4ccb-add8-7e0f16d121c3","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":2438,"success":true,"retryCount":0,"timestamp":"2026-01-30T14:01:31.647Z","model":"gpt-4o-mini","tokensIn":456,"tokensOut":45,"totalTokens":501,"schemaName":"response","schemaStrict":true,"schemaHash":"10d586752ea5","schemaVersion":"v1","promptVersion":"v2_language_enforcement","promptLength":1369,"estimatedCostUsd":0.0000954,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-30T14:01:31.648Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"assistant_llm","promptVersion":"v2_language_enforcement","schemaHash":"963fca52df4b","requestId":"req-1769781685524-lcn675en8","traceId":"a41bce45-a29d-4ccb-add8-7e0f16d121c3","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3000,"timeoutHit":false,"buildPromptMs":0.06,"networkMs":2437.8,"parseMs":0.82,"totalMs":2438.74,"promptChars":1369,"inputTokens":456,"outputTokens":45,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-30T14:01:31.649Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","stage":"assistant_llm","event":"assistant_llm_success","type":"CLARIFY","questionLanguage":"he","suggestedAction":"ASK_FOOD","blocksSearch":true,"durationMs":2439,"usage":{"prompt_tokens":456,"completion_tokens":45,"total_tokens":501},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"info","time":"2026-01-30T14:01:31.650Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","channel":"assistant","requestId":"req-1769781685524-lcn675en8","sessionHash":"2c3b20d765e7","payloadType":"assistant","event":"assistant_ws_publish","msg":"[ASSISTANT] Publishing to WebSocket"}
{"level":"info","time":"2026-01-30T14:01:31.651Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","channel":"assistant","payloadType":"assistant","event":"assistant_published","assistantType":"CLARIFY","blocksSearch":true,"suggestedAction":"ASK_FOOD","msg":"[ASSISTANT] Published to WebSocket"}
{"level":"info","time":"2026-01-30T14:01:31.660Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","hasResult":true,"msg":"[RedisJobStore] Result stored"}
{"level":"info","time":"2026-01-30T14:01:31.663Z","pid":14800,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769781685524-lcn675en8","status":"DONE_STOPPED","progress":100,"msg":"[RedisJobStore] Status updated"}
{"level":"warn","time":"2026-01-30T14:06:17.097Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-30T14:06:17.186Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_INIT_ATTEMPT","redisUrl":"redis://localhost:6379","msg":"[GoogleMapsCache] Attempting Redis connection"}
{"level":"info","time":"2026-01-30T14:06:17.189Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","event":"REDIS_INIT_ATTEMPT","redisUrl":"redis://localhost:6379","msg":"[Redis] Attempting connection to shared client"}
{"level":"warn","time":"2026-01-30T14:06:17.224Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","event":"ranking_cache_redis_unavailable","msg":"[RANKING_CACHE] Redis not available, ranking suggestions will be disabled"}
{"level":"info","time":"2026-01-30T14:06:17.505Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-30T14:06:17.506Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-30T14:06:17.508Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-30T14:06:17.522Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-30T14:06:17.531Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-30T14:06:17.535Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Redis enabled"}
{"level":"info","time":"2026-01-30T14:06:17.537Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-30T14:06:17.538Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-30T14:06:17.538Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-30T14:06:17.547Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-30T14:06:17.580Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Redis] Client ready"}
{"level":"info","time":"2026-01-30T14:06:17.583Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","event":"REDIS_CONNECTED","redisUrl":"redis://localhost:6379","msg":"[Redis] ✓ Shared client connected successfully"}
{"level":"info","time":"2026-01-30T14:06:17.585Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_SERVICE_READY","hasRedis":true,"commandTimeout":500,"msg":"[GoogleMapsCache] ✓ Cache service active with shared Redis client"}
{"level":"info","time":"2026-01-30T14:06:17.724Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","traceId":"83a4d1fd-d747-4338-86ff-594ec1eb390a","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"d1532221b2d0","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-30T14:06:17.751Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769781977750-fsipcg","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-30T14:06:17.757Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-01-30T14:06:17.760Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-01-30T14:06:17.761Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-01-30T14:06:17.762Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized successfully"}
{"level":"info","time":"2026-01-30T14:06:17.764Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769781977750-fsipcg","channel":"search","requestIdHash":"10a7d01e8ec7","sessionHash":"2c3b20d7","pending":false,"event":"ws_subscribe_ack","msg":"Subscribe accepted - owner match"}
{"level":"info","time":"2026-01-30T14:06:17.766Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769781977750-fsipcg","channel":"search","requestIdHash":"10a7d01e8ec7","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-30T14:06:17.771Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769781977750-fsipcg","channel":"assistant","requestIdHash":"10a7d01e8ec7","sessionHash":"2c3b20d7","pending":false,"event":"ws_subscribe_ack","msg":"Subscribe accepted - owner match"}
{"level":"info","time":"2026-01-30T14:06:17.772Z","pid":16580,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769781977750-fsipcg","channel":"assistant","requestIdHash":"10a7d01e8ec7","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"warn","time":"2026-01-30T14:06:32.230Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-30T14:06:32.269Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_INIT_ATTEMPT","redisUrl":"redis://localhost:6379","msg":"[GoogleMapsCache] Attempting Redis connection"}
{"level":"info","time":"2026-01-30T14:06:32.270Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","event":"REDIS_INIT_ATTEMPT","redisUrl":"redis://localhost:6379","msg":"[Redis] Attempting connection to shared client"}
{"level":"warn","time":"2026-01-30T14:06:32.283Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","event":"ranking_cache_redis_unavailable","msg":"[RANKING_CACHE] Redis not available, ranking suggestions will be disabled"}
{"level":"info","time":"2026-01-30T14:06:32.426Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-30T14:06:32.427Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-30T14:06:32.428Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-30T14:06:32.438Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-30T14:06:32.444Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-30T14:06:32.445Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Redis enabled"}
{"level":"info","time":"2026-01-30T14:06:32.453Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-30T14:06:32.454Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-30T14:06:32.454Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-30T14:06:32.458Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-30T14:06:32.478Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Redis] Client ready"}
{"level":"info","time":"2026-01-30T14:06:32.480Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","event":"REDIS_CONNECTED","redisUrl":"redis://localhost:6379","msg":"[Redis] ✓ Shared client connected successfully"}
{"level":"info","time":"2026-01-30T14:06:32.482Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_SERVICE_READY","hasRedis":true,"commandTimeout":500,"msg":"[GoogleMapsCache] ✓ Cache service active with shared Redis client"}
{"level":"info","time":"2026-01-30T14:06:33.154Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","traceId":"a454524f-3583-4792-bbd4-12c129db9407","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"9f58181d3a28","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-30T14:06:33.168Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769781993167-xkaa37","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-30T14:06:33.171Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-01-30T14:06:33.174Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-01-30T14:06:33.175Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-01-30T14:06:33.175Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized successfully"}
{"level":"info","time":"2026-01-30T14:06:33.177Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769781993167-xkaa37","channel":"search","requestIdHash":"10a7d01e8ec7","sessionHash":"2c3b20d7","pending":false,"event":"ws_subscribe_ack","msg":"Subscribe accepted - owner match"}
{"level":"info","time":"2026-01-30T14:06:33.178Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769781993167-xkaa37","channel":"assistant","requestIdHash":"10a7d01e8ec7","sessionHash":"2c3b20d7","pending":false,"event":"ws_subscribe_ack","msg":"Subscribe accepted - owner match"}
{"level":"info","time":"2026-01-30T14:06:33.178Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769781993167-xkaa37","channel":"search","requestIdHash":"10a7d01e8ec7","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-30T14:06:33.178Z","pid":19708,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769781993167-xkaa37","channel":"assistant","requestIdHash":"10a7d01e8ec7","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"warn","time":"2026-01-30T14:07:05.045Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","event":"ranking_cache_redis_unavailable","msg":"[RANKING_CACHE] Redis not available, ranking suggestions will be disabled"}
{"level":"info","time":"2026-01-30T14:07:05.121Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-1","pipelineVersion":"route2","event":"generic_query_blocked","reason":"no_location_anchor","query":"מה יש לאכול","hasUserLocation":false,"hasCityText":false,"msg":"[ROUTE2] Blocking generic food query without location anchor"}
{"level":"info","time":"2026-01-30T14:07:05.125Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-1","event":"assistant_language_resolved","assistantLanguage":"he","source":"detectedLanguage","detectedLanguage":"he","msg":"[ASSISTANT] Language resolved for assistant message"}
{"level":"info","time":"2026-01-30T14:07:05.128Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-1","assistantType":"CLARIFY","sessionIdPresent":true,"event":"assistant_called","msg":"[ASSISTANT] Hook invoked"}
{"level":"info","time":"2026-01-30T14:07:05.129Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-1","stage":"assistant_llm","event":"assistant_llm_start","type":"CLARIFY","reason":"MISSING_LOCATION","questionLanguage":"he","queryLen":11,"schemaVersion":"v3_strict_validation","promptVersion":"v2_language_enforcement","msg":"[ASSISTANT] Calling LLM"}
{"level":"error","time":"2026-01-30T14:07:05.133Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-1","stage":"assistant_llm","event":"assistant_llm_failed","type":"CLARIFY","questionLanguage":"he","error":"llmProvider.completeJSON is not a function","isTimeout":false,"durationMs":3,"msg":"[ASSISTANT] LLM call failed - using deterministic fallback"}
{"level":"info","time":"2026-01-30T14:07:05.138Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","channel":"assistant","requestId":"test-1","sessionHash":"166f608da96b","payloadType":"assistant","event":"assistant_ws_publish","msg":"[ASSISTANT] Publishing to WebSocket"}
{"level":"error","time":"2026-01-30T14:07:05.140Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-1","channel":"assistant","event":"assistant_publish_failed","error":"wsManager.publishToChannel is not a function","msg":"[ASSISTANT] Failed to publish"}
{"level":"info","time":"2026-01-30T14:07:05.151Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-2","pipelineVersion":"route2","event":"generic_query_blocked","reason":"no_location_anchor","query":"מה לאכול היום","hasUserLocation":false,"hasCityText":false,"msg":"[ROUTE2] Blocking generic food query without location anchor"}
{"level":"info","time":"2026-01-30T14:07:05.152Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-2","event":"assistant_language_resolved","assistantLanguage":"he","source":"detectedLanguage","detectedLanguage":"he","msg":"[ASSISTANT] Language resolved for assistant message"}
{"level":"info","time":"2026-01-30T14:07:05.154Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-2","assistantType":"CLARIFY","sessionIdPresent":true,"event":"assistant_called","msg":"[ASSISTANT] Hook invoked"}
{"level":"info","time":"2026-01-30T14:07:05.155Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-2","stage":"assistant_llm","event":"assistant_llm_start","type":"CLARIFY","reason":"MISSING_LOCATION","questionLanguage":"he","queryLen":13,"schemaVersion":"v3_strict_validation","promptVersion":"v2_language_enforcement","msg":"[ASSISTANT] Calling LLM"}
{"level":"error","time":"2026-01-30T14:07:05.156Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-2","stage":"assistant_llm","event":"assistant_llm_failed","type":"CLARIFY","questionLanguage":"he","error":"llmProvider.completeJSON is not a function","isTimeout":false,"durationMs":2,"msg":"[ASSISTANT] LLM call failed - using deterministic fallback"}
{"level":"info","time":"2026-01-30T14:07:05.157Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","channel":"assistant","requestId":"test-2","sessionHash":"166f608da96b","payloadType":"assistant","event":"assistant_ws_publish","msg":"[ASSISTANT] Publishing to WebSocket"}
{"level":"error","time":"2026-01-30T14:07:05.158Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-2","channel":"assistant","event":"assistant_publish_failed","error":"wsManager.publishToChannel is not a function","msg":"[ASSISTANT] Failed to publish"}
{"level":"info","time":"2026-01-30T14:07:05.160Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-3","pipelineVersion":"route2","event":"generic_query_blocked","reason":"no_location_anchor","query":"אוכל","hasUserLocation":false,"hasCityText":false,"msg":"[ROUTE2] Blocking generic food query without location anchor"}
{"level":"info","time":"2026-01-30T14:07:05.161Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-3","event":"assistant_language_resolved","assistantLanguage":"he","source":"detectedLanguage","detectedLanguage":"he","msg":"[ASSISTANT] Language resolved for assistant message"}
{"level":"info","time":"2026-01-30T14:07:05.161Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-3","assistantType":"CLARIFY","sessionIdPresent":true,"event":"assistant_called","msg":"[ASSISTANT] Hook invoked"}
{"level":"info","time":"2026-01-30T14:07:05.162Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-3","stage":"assistant_llm","event":"assistant_llm_start","type":"CLARIFY","reason":"MISSING_LOCATION","questionLanguage":"he","queryLen":4,"schemaVersion":"v3_strict_validation","promptVersion":"v2_language_enforcement","msg":"[ASSISTANT] Calling LLM"}
{"level":"error","time":"2026-01-30T14:07:05.163Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-3","stage":"assistant_llm","event":"assistant_llm_failed","type":"CLARIFY","questionLanguage":"he","error":"llmProvider.completeJSON is not a function","isTimeout":false,"durationMs":1,"msg":"[ASSISTANT] LLM call failed - using deterministic fallback"}
{"level":"info","time":"2026-01-30T14:07:05.164Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","channel":"assistant","requestId":"test-3","sessionHash":"166f608da96b","payloadType":"assistant","event":"assistant_ws_publish","msg":"[ASSISTANT] Publishing to WebSocket"}
{"level":"error","time":"2026-01-30T14:07:05.164Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-3","channel":"assistant","event":"assistant_publish_failed","error":"wsManager.publishToChannel is not a function","msg":"[ASSISTANT] Failed to publish"}
{"level":"info","time":"2026-01-30T14:07:05.166Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-4","pipelineVersion":"route2","event":"generic_query_blocked","reason":"no_location_anchor","query":"רעב","hasUserLocation":false,"hasCityText":false,"msg":"[ROUTE2] Blocking generic food query without location anchor"}
{"level":"info","time":"2026-01-30T14:07:05.166Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-4","event":"assistant_language_resolved","assistantLanguage":"he","source":"detectedLanguage","detectedLanguage":"he","msg":"[ASSISTANT] Language resolved for assistant message"}
{"level":"info","time":"2026-01-30T14:07:05.167Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-4","assistantType":"CLARIFY","sessionIdPresent":true,"event":"assistant_called","msg":"[ASSISTANT] Hook invoked"}
{"level":"info","time":"2026-01-30T14:07:05.167Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-4","stage":"assistant_llm","event":"assistant_llm_start","type":"CLARIFY","reason":"MISSING_LOCATION","questionLanguage":"he","queryLen":3,"schemaVersion":"v3_strict_validation","promptVersion":"v2_language_enforcement","msg":"[ASSISTANT] Calling LLM"}
{"level":"error","time":"2026-01-30T14:07:05.168Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-4","stage":"assistant_llm","event":"assistant_llm_failed","type":"CLARIFY","questionLanguage":"he","error":"llmProvider.completeJSON is not a function","isTimeout":false,"durationMs":1,"msg":"[ASSISTANT] LLM call failed - using deterministic fallback"}
{"level":"info","time":"2026-01-30T14:07:05.168Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","channel":"assistant","requestId":"test-4","sessionHash":"166f608da96b","payloadType":"assistant","event":"assistant_ws_publish","msg":"[ASSISTANT] Publishing to WebSocket"}
{"level":"error","time":"2026-01-30T14:07:05.169Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-4","channel":"assistant","event":"assistant_publish_failed","error":"wsManager.publishToChannel is not a function","msg":"[ASSISTANT] Failed to publish"}
{"level":"info","time":"2026-01-30T14:07:05.171Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-5","pipelineVersion":"route2","event":"generic_query_blocked","reason":"no_location_anchor","query":"what to eat","hasUserLocation":false,"hasCityText":false,"msg":"[ROUTE2] Blocking generic food query without location anchor"}
{"level":"info","time":"2026-01-30T14:07:05.172Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-5","event":"assistant_language_resolved","assistantLanguage":"en","source":"detectedLanguage","detectedLanguage":"en","msg":"[ASSISTANT] Language resolved for assistant message"}
{"level":"info","time":"2026-01-30T14:07:05.172Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-5","assistantType":"CLARIFY","sessionIdPresent":true,"event":"assistant_called","msg":"[ASSISTANT] Hook invoked"}
{"level":"info","time":"2026-01-30T14:07:05.172Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-5","stage":"assistant_llm","event":"assistant_llm_start","type":"CLARIFY","reason":"MISSING_LOCATION","questionLanguage":"en","queryLen":11,"schemaVersion":"v3_strict_validation","promptVersion":"v2_language_enforcement","msg":"[ASSISTANT] Calling LLM"}
{"level":"error","time":"2026-01-30T14:07:05.173Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-5","stage":"assistant_llm","event":"assistant_llm_failed","type":"CLARIFY","questionLanguage":"en","error":"llmProvider.completeJSON is not a function","isTimeout":false,"durationMs":1,"msg":"[ASSISTANT] LLM call failed - using deterministic fallback"}
{"level":"info","time":"2026-01-30T14:07:05.175Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","channel":"assistant","requestId":"test-5","sessionHash":"166f608da96b","payloadType":"assistant","event":"assistant_ws_publish","msg":"[ASSISTANT] Publishing to WebSocket"}
{"level":"error","time":"2026-01-30T14:07:05.175Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-5","channel":"assistant","event":"assistant_publish_failed","error":"wsManager.publishToChannel is not a function","msg":"[ASSISTANT] Failed to publish"}
{"level":"info","time":"2026-01-30T14:07:05.177Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-6","pipelineVersion":"route2","event":"generic_query_blocked","reason":"no_location_anchor","query":"food","hasUserLocation":false,"hasCityText":false,"msg":"[ROUTE2] Blocking generic food query without location anchor"}
{"level":"info","time":"2026-01-30T14:07:05.177Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-6","event":"assistant_language_resolved","assistantLanguage":"en","source":"detectedLanguage","detectedLanguage":"en","msg":"[ASSISTANT] Language resolved for assistant message"}
{"level":"info","time":"2026-01-30T14:07:05.178Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-6","assistantType":"CLARIFY","sessionIdPresent":true,"event":"assistant_called","msg":"[ASSISTANT] Hook invoked"}
{"level":"info","time":"2026-01-30T14:07:05.178Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-6","stage":"assistant_llm","event":"assistant_llm_start","type":"CLARIFY","reason":"MISSING_LOCATION","questionLanguage":"en","queryLen":4,"schemaVersion":"v3_strict_validation","promptVersion":"v2_language_enforcement","msg":"[ASSISTANT] Calling LLM"}
{"level":"error","time":"2026-01-30T14:07:05.179Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-6","stage":"assistant_llm","event":"assistant_llm_failed","type":"CLARIFY","questionLanguage":"en","error":"llmProvider.completeJSON is not a function","isTimeout":false,"durationMs":1,"msg":"[ASSISTANT] LLM call failed - using deterministic fallback"}
{"level":"info","time":"2026-01-30T14:07:05.180Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","channel":"assistant","requestId":"test-6","sessionHash":"166f608da96b","payloadType":"assistant","event":"assistant_ws_publish","msg":"[ASSISTANT] Publishing to WebSocket"}
{"level":"error","time":"2026-01-30T14:07:05.180Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-6","channel":"assistant","event":"assistant_publish_failed","error":"wsManager.publishToChannel is not a function","msg":"[ASSISTANT] Failed to publish"}
{"level":"info","time":"2026-01-30T14:07:05.182Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-7","pipelineVersion":"route2","event":"generic_query_blocked","reason":"no_location_anchor","query":"hungry","hasUserLocation":false,"hasCityText":false,"msg":"[ROUTE2] Blocking generic food query without location anchor"}
{"level":"info","time":"2026-01-30T14:07:05.182Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-7","event":"assistant_language_resolved","assistantLanguage":"en","source":"detectedLanguage","detectedLanguage":"en","msg":"[ASSISTANT] Language resolved for assistant message"}
{"level":"info","time":"2026-01-30T14:07:05.183Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-7","assistantType":"CLARIFY","sessionIdPresent":true,"event":"assistant_called","msg":"[ASSISTANT] Hook invoked"}
{"level":"info","time":"2026-01-30T14:07:05.183Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-7","stage":"assistant_llm","event":"assistant_llm_start","type":"CLARIFY","reason":"MISSING_LOCATION","questionLanguage":"en","queryLen":6,"schemaVersion":"v3_strict_validation","promptVersion":"v2_language_enforcement","msg":"[ASSISTANT] Calling LLM"}
{"level":"error","time":"2026-01-30T14:07:05.184Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-7","stage":"assistant_llm","event":"assistant_llm_failed","type":"CLARIFY","questionLanguage":"en","error":"llmProvider.completeJSON is not a function","isTimeout":false,"durationMs":1,"msg":"[ASSISTANT] LLM call failed - using deterministic fallback"}
{"level":"info","time":"2026-01-30T14:07:05.185Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","channel":"assistant","requestId":"test-7","sessionHash":"166f608da96b","payloadType":"assistant","event":"assistant_ws_publish","msg":"[ASSISTANT] Publishing to WebSocket"}
{"level":"error","time":"2026-01-30T14:07:05.186Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-7","channel":"assistant","event":"assistant_publish_failed","error":"wsManager.publishToChannel is not a function","msg":"[ASSISTANT] Failed to publish"}
{"level":"info","time":"2026-01-30T14:07:05.197Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"regression-test-1","pipelineVersion":"route2","event":"generic_query_blocked","reason":"no_location_anchor","query":"מה יש לאכול היום","hasUserLocation":false,"hasCityText":false,"msg":"[ROUTE2] Blocking generic food query without location anchor"}
{"level":"info","time":"2026-01-30T14:07:05.198Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"regression-test-1","event":"assistant_language_resolved","assistantLanguage":"he","source":"detectedLanguage","detectedLanguage":"he","msg":"[ASSISTANT] Language resolved for assistant message"}
{"level":"info","time":"2026-01-30T14:07:05.198Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"regression-test-1","assistantType":"CLARIFY","sessionIdPresent":true,"event":"assistant_called","msg":"[ASSISTANT] Hook invoked"}
{"level":"info","time":"2026-01-30T14:07:05.199Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"regression-test-1","stage":"assistant_llm","event":"assistant_llm_start","type":"CLARIFY","reason":"MISSING_LOCATION","questionLanguage":"he","queryLen":16,"schemaVersion":"v3_strict_validation","promptVersion":"v2_language_enforcement","msg":"[ASSISTANT] Calling LLM"}
{"level":"error","time":"2026-01-30T14:07:05.200Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"regression-test-1","stage":"assistant_llm","event":"assistant_llm_failed","type":"CLARIFY","questionLanguage":"he","error":"llmProvider.completeJSON is not a function","isTimeout":false,"durationMs":1,"msg":"[ASSISTANT] LLM call failed - using deterministic fallback"}
{"level":"info","time":"2026-01-30T14:07:05.201Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","channel":"assistant","requestId":"regression-test-1","sessionHash":"166f608da96b","payloadType":"assistant","event":"assistant_ws_publish","msg":"[ASSISTANT] Publishing to WebSocket"}
{"level":"error","time":"2026-01-30T14:07:05.201Z","pid":17736,"hostname":"il-dev-win-lt-shahar-pot","requestId":"regression-test-1","channel":"assistant","event":"assistant_publish_failed","error":"wsManager.publishToChannel is not a function","msg":"[ASSISTANT] Failed to publish"}
