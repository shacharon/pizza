{"level":"info","time":"2026-01-31T14:30:43.671Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"81133db9-c84e-4579-83c5-88e0df2f0a9e","ip":"::1","photoRefHash":"86ae5bb1576f","contentType":"image/jpeg","sizeBytes":46043,"durationMs":968,"slow":true,"msg":"[PhotoProxy] Photo served"}
{"level":"info","time":"2026-01-31T14:30:43.756Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"afd9f5b0-81f2-44b9-a5f8-c9a7ffb98fdf","ip":"::1","photoRefHash":"530f89847a9a","contentType":"image/jpeg","sizeBytes":48080,"durationMs":1034,"slow":true,"msg":"[PhotoProxy] Photo served"}
{"level":"info","time":"2026-01-31T14:30:43.761Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"6e208b06-55ce-44a6-adbb-15d562282b5a","ip":"::1","photoRefHash":"867b39c200ec","contentType":"image/jpeg","sizeBytes":45520,"durationMs":1017,"slow":true,"msg":"[PhotoProxy] Photo served"}
{"level":"info","time":"2026-01-31T14:30:43.874Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"52dfbd2d-47b5-4b52-9ca1-83a4e471f697","ip":"::1","photoRefHash":"7005628a35e9","contentType":"image/jpeg","sizeBytes":50505,"durationMs":1144,"slow":true,"msg":"[PhotoProxy] Photo served"}
{"level":"info","time":"2026-01-31T14:30:48.781Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","query":"מסעדות  אסיאתיות בגדרה","status":"PENDING","hasOwner":true,"hasIdempotencyKey":true,"msg":"[RedisJobStore] Job created"}
{"level":"info","time":"2026-01-31T14:30:48.782Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","sessionHash":"2c3b20d765e7","hasUserId":false,"operation":"createJob","decision":"ACCEPTED","hasIdempotencyKey":true,"event":"job_created","msg":"[Observability] Job created with JWT session binding and idempotency key"}
{"level":"info","time":"2026-01-31T14:30:48.787Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","status":"RUNNING","progress":10,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:30:48.788Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","status":"RUNNING","progress":10,"event":"status_running","msg":"[Observability] Job status set to RUNNING"}
{"level":"info","time":"2026-01-31T14:30:48.789Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769869848763-goml96fgo","event":"backlog_created","msg":"WebSocket backlog created for late subscribers"}
{"level":"info","time":"2026-01-31T14:30:48.790Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","pipelineVersion":"route2","event":"pipeline_selected","queryLen":22,"queryHash":"424f035aa371","msg":"[ROUTE2] Pipeline selected"}
{"level":"info","time":"2026-01-31T14:30:48.791Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","pipelineVersion":"route2","event":"device_region_resolved","userRegionCode":"IL","userRegionSource":"config","msg":"[ROUTE2] Device region resolved"}
{"level":"info","time":"2026-01-31T14:30:48.791Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","traceId":"3386288e-ff6b-4cc9-b9ad-ea6a9ab0a86e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_started","queryLen":22,"queryHash":"424f035aa371","msg":"[ROUTE2] gate2 started"}
{"level":"info","time":"2026-01-31T14:30:48.808Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769869582087-8b8xkv","channel":"search","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:30:48.809Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769869582087-8b8xkv","channel":"search","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:30:48.810Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769869848763-goml96fgo","count":1,"event":"backlog_drained","msg":"WebSocket backlog drained to late subscriber"}
{"level":"info","time":"2026-01-31T14:30:48.813Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769869582087-8b8xkv","channel":"assistant","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:30:48.814Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769869582087-8b8xkv","channel":"assistant","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:30:49.509Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"3386288e-ff6b-4cc9-b9ad-ea6a9ab0a86e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":717,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:30:49.509Z","model":"gpt-4o-mini","tokensIn":386,"tokensOut":12,"totalTokens":398,"schemaName":"response","schemaStrict":true,"schemaHash":"ecbf2c0a0457","schemaVersion":"v1","promptVersion":"gate2_v4","promptHash":"781640b134b1bdffb237ee48622de2f20ebc911203fc18971f33f55e3547824f","promptLength":1012,"estimatedCostUsd":0.0000651,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:30:49.510Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","traceId":"3386288e-ff6b-4cc9-b9ad-ea6a9ab0a86e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_completed","durationMs":719,"route":"CONTINUE","foodSignal":"YES","confidence":0.95,"tokenUsage":{"input":386,"output":12,"total":398,"model":"gpt-4o-mini"},"msg":"[ROUTE2] gate2 completed"}
{"level":"info","time":"2026-01-31T14:30:49.513Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","status":"RUNNING","progress":25,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:30:49.514Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","traceId":"3386288e-ff6b-4cc9-b9ad-ea6a9ab0a86e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"intent","event":"stage_started","queryLen":22,"queryHash":"424f035aa371","msg":"[ROUTE2] intent started"}
{"level":"info","time":"2026-01-31T14:30:51.311Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"3386288e-ff6b-4cc9-b9ad-ea6a9ab0a86e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1797,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:30:51.311Z","model":"gpt-4o-mini","tokensIn":1600,"tokensOut":80,"totalTokens":1680,"schemaName":"response","schemaStrict":true,"schemaHash":"f731e75551db","schemaVersion":"v1","promptVersion":"intent_v4","promptHash":"7d0cb4f0f10cec33408d81bef29a9ab039df93163813d0fb2660eb8dda9adb95","estimatedCostUsd":0.000288,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:30:51.313Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"intent","promptVersion":"intent_v4","schemaHash":"f58b8106b963","requestId":"req-1769869848763-goml96fgo","traceId":"3386288e-ff6b-4cc9-b9ad-ea6a9ab0a86e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3500,"timeoutHit":false,"buildPromptMs":0.06,"networkMs":1798.03,"parseMs":0.45,"totalMs":1798.59,"promptChars":4879,"inputTokens":1600,"outputTokens":80,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:30:51.313Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","traceId":"3386288e-ff6b-4cc9-b9ad-ea6a9ab0a86e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"intent","event":"stage_completed","durationMs":1800,"route":"TEXTSEARCH","confidence":1,"reason":"explicit_city_mentioned","msg":"[ROUTE2] intent completed"}
{"level":"info","time":"2026-01-31T14:30:51.317Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","status":"RUNNING","progress":40,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:30:51.318Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","pipelineVersion":"route2","event":"intent_decided","route":"TEXTSEARCH","regionCandidate":"IL","language":"he","confidence":1,"reason":"explicit_city_mentioned","msg":"[ROUTE2] Intent routing decided (regionCandidate will be validated by filters_resolved)"}
{"level":"info","time":"2026-01-31T14:30:51.318Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","pipelineVersion":"route2","event":"parallel_started","route":"TEXTSEARCH","isGenericWithLocation":false,"skipBaseFilters":false,"hasUserLocation":false,"hasCityText":true,"msg":"[ROUTE2] Starting parallel tasks (base_filters + post_constraints)"}
{"level":"info","time":"2026-01-31T14:30:51.319Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","pipelineVersion":"route2","event":"base_filters_llm_started","query":"מסעדות  אסיאתיות בגדרה","route":"TEXTSEARCH","msg":"[ROUTE2] Base filters LLM started"}
{"level":"info","time":"2026-01-31T14:30:51.320Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","pipelineVersion":"route2","event":"google_parallel_started","regionCode":"IL","providerLanguage":"he","uiLanguage":"he","msg":"[ROUTE2] Starting Google fetch in parallel (early context derived)"}
{"level":"info","time":"2026-01-31T14:30:51.320Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","stage":"textsearch_mapper","event":"schema_check_before_llm","schemaId":"TEXTSEARCH_JSON_SCHEMA","schemaProperties":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"schemaPropertiesCount":12,"schemaRequired":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"schemaRequiredCount":12,"hasModeField":true,"schemaValid":true,"schemaHash":"textsearch_v5_keyed_freetext_mode"}
{"level":"info","time":"2026-01-31T14:30:51.321Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","stage":"textsearch_mapper","event":"schema_final_check","schemaType":"object","propertyKeys":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"requiredKeys":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"hasModeField":true,"additionalProperties":false,"isValid":true,"msg":"[TEXTSEARCH] Final schema check before OpenAI call"}
{"level":"info","time":"2026-01-31T14:30:52.523Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"3386288e-ff6b-4cc9-b9ad-ea6a9ab0a86e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1203,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:30:52.523Z","model":"gpt-4o-mini","tokensIn":2235,"tokensOut":43,"totalTokens":2278,"schemaName":"response","schemaStrict":true,"schemaHash":"d2d4176c14f8","schemaVersion":"v1","promptVersion":"base_filters_v1","promptHash":"64746426a1544301b1adce867016af0bd7a4c23cd83d1134c7a6e6c47a8c2d77","promptLength":5587,"estimatedCostUsd":0.00036104999999999997,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:30:52.523Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","pipelineVersion":"route2","event":"base_filters_llm_completed","durationMs":1204,"language":"he","openState":null,"openAt":null,"openBetween":null,"priceIntent":null,"minRatingBucket":null,"minReviewCountBucket":null,"regionHint":null,"tokenUsage":{"input":2235,"output":43,"total":2278,"model":"gpt-4o-mini"},"msg":"[ROUTE2] Base filters LLM completed"}
{"level":"info","time":"2026-01-31T14:30:52.759Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"3386288e-ff6b-4cc9-b9ad-ea6a9ab0a86e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1440,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:30:52.759Z","model":"gpt-4o-mini","tokensIn":1697,"tokensOut":61,"totalTokens":1758,"schemaName":"response","schemaStrict":true,"schemaHash":"9cb7c40fd303","schemaVersion":"v1","promptVersion":"post_constraints_v1","promptHash":"7a9eb00cc4c93e1a79c0b2b54a37ae3f0f136351e35eca7a675dba627252da53","estimatedCostUsd":0.00029115,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:30:52.766Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"e064b37d-83f4-46a7-acef-f6c0c54e6d6c","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:30:52.767Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":4001,"updatedAgeMs":1451,"progress":40,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 4001, updatedAgeMs: 1451"}
{"level":"info","time":"2026-01-31T14:30:53.366Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"3386288e-ff6b-4cc9-b9ad-ea6a9ab0a86e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":2044,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:30:53.366Z","model":"gpt-4o-mini","tokensIn":965,"tokensOut":99,"totalTokens":1064,"schemaName":"response","schemaStrict":true,"schemaHash":"924556626f01","schemaVersion":"v1","promptVersion":"textsearch_mapper_v4_keyed_freetext","promptHash":"6ec296a5225613c761b0a90ee0f4c21f97678e5167324a48f11ec42152ee1caa","estimatedCostUsd":0.00020415,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:30:53.368Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"textsearch_mapper","promptVersion":"textsearch_mapper_v4_keyed_freetext","schemaHash":"textsearch_v5_keyed_freetext_mode","requestId":"req-1769869848763-goml96fgo","traceId":"3386288e-ff6b-4cc9-b9ad-ea6a9ab0a86e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3500,"timeoutHit":false,"buildPromptMs":0.08,"networkMs":2046.22,"parseMs":0.21,"totalMs":2046.59,"promptChars":2277,"inputTokens":965,"outputTokens":99,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:30:53.369Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","stage":"textsearch_mapper","event":"deterministic_builder_keyed","mode":"KEYED","cuisineKey":"asian","cityText":"גדרה","cityEnglish":"Gedera","providerTextQuery":"Asian restaurant in Gedera","providerLanguage":"en","source":"deterministic_builder","msg":"[TEXTSEARCH] Built KEYED mode query (cuisine + city) - fully in English"}
{"level":"info","time":"2026-01-31T14:30:53.370Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","stage":"textsearch_mapper","event":"cuisine_terms_generated","cuisineKey":"asian","searchLanguage":"he","requiredTerms":["אסייתית","אסיה"],"preferredTerms":["סיני","תאילנדי","יפני"],"msg":"[TEXTSEARCH] Generated cuisine terms from cuisineKey"}
{"level":"info","time":"2026-01-31T14:30:53.370Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","stage":"textsearch_mapper","event":"bias_planned","source":"cityCenter_pending_geocode","cityText":"גדרה","intentReason":"explicit_city_mentioned","note":"explicit_city_preferred_over_userLocation","msg":"[TEXTSEARCH] City-center bias planned (explicit city takes priority over userLocation)"}
{"level":"info","time":"2026-01-31T14:30:53.371Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","stage":"textsearch_mapper","event":"mapper_success","mode":"KEYED","cuisineKey":"asian","cityText":"גדרה","providerTextQuery":"Asian restaurant in Gedera","providerLanguage":"en","source":"deterministic_builder_keyed","strictness":"STRICT","msg":"[TEXTSEARCH] Mapper completed successfully"}
{"level":"info","time":"2026-01-31T14:30:53.371Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","pipelineVersion":"route2","event":"route_llm_mapped","providerMethod":"textSearch","region":"IL","language":"he","msg":"[ROUTE2] Route-LLM mapping completed (using early context)"}
{"level":"info","time":"2026-01-31T14:30:53.372Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","pipelineVersion":"route2","stage":"google_maps","event":"stage_started","providerMethod":"textSearch","region":"IL","language":"he","msg":"[ROUTE2] google_maps started"}
{"level":"info","time":"2026-01-31T14:30:53.372Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","provider":"google_places_new","method":"searchText","providerTextQuery":"Asian restaurant in Gedera","providerLanguage":"en","region":"IL","hasBiasPlanned":true,"biasSource":"cityText_pending_geocode","mode":"KEYED","cityText":"גדרה","msg":"[GOOGLE] Calling Text Search API (New) - using providerTextQuery/providerLanguage"}
{"level":"info","time":"2026-01-31T14:30:53.373Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"CACHE_WRAP_ENTER","providerMethod":"textSearch","cacheKey":"g:textsearch:b24ed3d5a99243c50e0736bd98ce21c0","ttlSeconds":900}
{"level":"info","time":"2026-01-31T14:30:53.374Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","pipelineVersion":"route2","event":"google_parallel_awaited","parallelDurationMs":2054,"msg":"[ROUTE2] Awaiting Google results + base_filters/post_constraints (barrier)"}
{"level":"info","time":"2026-01-31T14:30:53.375Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","pipelineVersion":"route2","event":"await_base_filters","msg":"[ROUTE2] Awaiting base filters"}
{"level":"info","time":"2026-01-31T14:30:53.375Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"language_context_resolved","uiLanguage":"he","queryLanguage":"he","intentLanguage":"he","intentLanguageConfidence":1,"assistantLanguage":"he","searchLanguage":"he","providerLanguage":"he","regionCode":"IL","sources":{"assistantLanguage":"query_language_deterministic","searchLanguage":"query_language_policy"},"providerLanguagePolicy":"queryLanguage","msg":"[LANGUAGE] Language context resolved with strict separation"}
{"level":"info","time":"2026-01-31T14:30:53.376Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","pipelineVersion":"route2","event":"filters_resolved","base":{"language":"he","openState":null,"openAt":null,"openBetween":null,"priceIntent":null,"minRatingBucket":null,"regionHint":null},"final":{"uiLanguage":"he","providerLanguage":"he","openState":null,"openAt":null,"openBetween":null,"priceIntent":null,"minRatingBucket":null,"regionCode":"IL"},"sanitized":false,"msg":"[ROUTE2] Filters resolved"}
{"level":"info","time":"2026-01-31T14:30:53.377Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"google_textsearch_using_provider_fields","providerTextQuery":"Asian restaurant in Gedera","providerLanguage":"en","mode":"KEYED","source":"mapper_deterministic_builder","msg":"[GOOGLE] Using providerTextQuery/providerLanguage from mapper"}
{"level":"info","time":"2026-01-31T14:30:53.378Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"city_center_resolved","cityText":"גדרה","lat":31.8120082,"lng":34.7774347,"servedFromCache":true,"radiusMeters":10000,"hadOriginalBias":false,"biasSource":"cityCenter","msg":"[GOOGLE] City center resolved, applying city-center bias"}
{"level":"info","time":"2026-01-31T14:30:53.379Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"google_call_language","providerMethod":"textSearch","languageCode":"en","providerLanguage":"en","regionCode":"IL","providerTextQuery":"Asian restaurant in Gedera","mode":"KEYED","languageSource":"mapper_deterministic_builder","msg":"[GOOGLE] Text Search API call language (from mapper providerLanguage)"}
{"level":"info","time":"2026-01-31T14:30:53.380Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"textsearch_request_payload","providerTextQuery":"Asian restaurant in Gedera","textQueryLen":26,"textQueryHash":"18286ebb02ff","mode":"KEYED","hasExplicitCity":true,"languageCode":"en","regionCode":"IL","regionCodeSent":true,"hasBiasApplied":true,"biasSource":"cityCenter","biasLat":31.8120082,"biasLng":34.7774347,"biasRadiusMeters":10000,"maxResultCount":20,"msg":"[GOOGLE] Text Search request payload (providerTextQuery)"}
{"level":"info","time":"2026-01-31T14:30:53.381Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"google_textsearch_bias_applied","biasType":"cityCenter","lat":31.8120082,"lng":34.7774347,"radiusMeters":10000,"msg":"[GOOGLE] Location bias ACTUALLY applied to Google request"}
{"level":"info","time":"2026-01-31T14:30:53.381Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"google_textsearch_page","page":1,"maxResults":20,"maxPages":3,"textQuery":"Asian restaurant in Gedera","msg":"[GOOGLE] Fetching page 1"}
{"level":"info","time":"2026-01-31T14:30:53.988Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"3b1369a4-f26a-48dc-93d6-bea977a2e9f6","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:30:53.990Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":5224,"updatedAgeMs":2674,"progress":40,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 5224, updatedAgeMs: 2674"}
{"level":"info","time":"2026-01-31T14:30:54.324Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"google_textsearch_page","page":1,"fetchedCount":9,"cumulativeCount":9,"hasNextPageToken":false,"msg":"[GOOGLE] Page 1 completed"}
{"level":"info","time":"2026-01-31T14:30:54.325Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"google_textsearch_aggregated","requested":20,"returned":9,"pagesUsed":1,"maxPagesAllowed":3,"totalFetched":9,"duplicatesRemoved":0,"stopReason":"no_more_pages","hadMorePages":false,"msg":"[GOOGLE] Text Search aggregated results"}
{"level":"info","time":"2026-01-31T14:30:54.371Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"CACHE_WRAP_EXIT","providerMethod":"textSearch","servedFrom":"google_api","cacheTier":"MISS","durationMs":999}
{"level":"info","time":"2026-01-31T14:30:54.372Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","provider":"google_places_new","method":"searchText","durationMs":1000,"resultCount":9,"fieldMaskUsed":"places.id,places.displayName,places.formattedAddress,places.location,places.rating,places.userRatingCount,places.priceLevel,places.currentOpeningHours,places.regularOpeningHours,places.utcOffsetMinutes,places.photos,places.types,places.googleMapsUri","servedFrom":"google_api","msg":"[GOOGLE] Text Search completed"}
{"level":"info","time":"2026-01-31T14:30:54.372Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","pipelineVersion":"route2","stage":"google_maps","event":"stage_completed","durationMs":1000,"providerMethod":"textSearch","resultCount":9,"region":"IL","language":"he","msg":"[ROUTE2] google_maps completed"}
{"level":"info","time":"2026-01-31T14:30:54.372Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","pipelineVersion":"route2","event":"google_parallel_completed","totalDurationMs":3052,"googleDurationMs":1000,"criticalPathSavedMs":2052,"msg":"[ROUTE2] Google fetch completed (parallel optimization saved time)"}
{"level":"info","time":"2026-01-31T14:30:54.375Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","status":"RUNNING","progress":60,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:30:54.376Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","pipelineVersion":"route2","event":"cuisine_enforcement_started","strictness":"STRICT","requiredTerms":["אסייתית","אסיה"],"preferredTerms":["סיני","תאילנדי","יפני"],"countIn":9,"hardConstraintsExist":false,"hardConstraintsActive":[],"msg":"[ROUTE2] Starting cuisine enforcement"}
{"level":"info","time":"2026-01-31T14:30:54.376Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode_enforced","countIn":9,"msg":"[CUISINE_ENFORCER] Policy: SOFT_BOOST (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:30:54.376Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v2","policy":"SOFT_BOOST","strictness":"STRICT","requiredTermsCount":2,"preferredTermsCount":3,"placesCount":9,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for enforcement"}
{"level":"info","time":"2026-01-31T14:30:55.583Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"79b75957-825a-4121-8a64-7e70eafdc871","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:30:55.584Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":6818,"updatedAgeMs":1210,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 6818, updatedAgeMs: 1210"}
{"level":"info","time":"2026-01-31T14:30:56.915Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"0c5cce42-ded8-463c-bbe3-1186f936d544","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:30:56.916Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":8150,"updatedAgeMs":2542,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 8150, updatedAgeMs: 2542"}
{"level":"info","time":"2026-01-31T14:30:58.200Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"162c2825-6744-48e7-9695-7edd4122c3b3","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:30:58.201Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":9435,"updatedAgeMs":3827,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 9435, updatedAgeMs: 3827"}
{"level":"warn","time":"2026-01-31T14:30:58.380Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","provider":"openai","operation":"completeJSON","latencyMs":4002,"success":false,"retryCount":0,"errorCode":"Error","errorReason":"Request was aborted.","timestamp":"2026-01-31T14:30:58.379Z","msg":"Provider call failed: openai.completeJSON"}
{"level":"warn","time":"2026-01-31T14:30:58.380Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"cuisine_enforcer","promptVersion":"unknown","requestId":"req-1769869848763-goml96fgo","attempt":1,"model":"gpt-4o-mini","timeoutMs":4000,"timeoutHit":true,"buildPromptMs":0.07,"networkMs":4003.2,"parseMs":0,"totalMs":4003.32,"promptChars":2629,"inputTokens":null,"outputTokens":null,"retriesCount":0,"success":false,"errorType":"abort_timeout","errorReason":"Request aborted or timeout","statusCode":null,"msg":"llm_gate_timing"}
{"level":"warn","time":"2026-01-31T14:30:58.380Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","attempt":1,"maxAttempts":3,"errorType":"abort_timeout","msg":"[LLM] Timeout, will retry with backoff"}
{"level":"warn","time":"2026-01-31T14:30:58.380Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","attempt":1,"maxAttempts":3,"msg":"[LLM] Retriable transport error"}
{"level":"info","time":"2026-01-31T14:30:59.534Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"cd9a7b84-8b3c-49a9-95d6-b8654995dc8a","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:30:59.536Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":10770,"updatedAgeMs":5162,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 10770, updatedAgeMs: 5162"}
{"level":"info","time":"2026-01-31T14:31:00.969Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"a27e7b73-e2b7-4ac1-9dbd-531823294c78","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:31:00.971Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":12205,"updatedAgeMs":6597,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 12205, updatedAgeMs: 6597"}
{"level":"info","time":"2026-01-31T14:31:02.283Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"116847dc-52f0-42d1-b3d2-fb9fad661a02","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:31:02.284Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":13518,"updatedAgeMs":7910,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 13518, updatedAgeMs: 7910"}
{"level":"warn","time":"2026-01-31T14:31:02.645Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","provider":"openai","operation":"completeJSON","latencyMs":4002,"success":false,"retryCount":1,"errorCode":"Error","errorReason":"Request was aborted.","timestamp":"2026-01-31T14:31:02.645Z","msg":"Provider call failed: openai.completeJSON"}
{"level":"warn","time":"2026-01-31T14:31:02.646Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"cuisine_enforcer","promptVersion":"unknown","requestId":"req-1769869848763-goml96fgo","attempt":2,"model":"gpt-4o-mini","timeoutMs":4000,"timeoutHit":true,"buildPromptMs":0.07,"networkMs":4002.41,"parseMs":0,"totalMs":8269.25,"promptChars":2629,"inputTokens":null,"outputTokens":null,"retriesCount":1,"success":false,"errorType":"abort_timeout","errorReason":"Request aborted or timeout","statusCode":null,"msg":"llm_gate_timing"}
{"level":"warn","time":"2026-01-31T14:31:02.646Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","attempt":2,"maxAttempts":3,"errorType":"abort_timeout","msg":"[LLM] Timeout, will retry with backoff"}
{"level":"warn","time":"2026-01-31T14:31:02.646Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","attempt":2,"maxAttempts":3,"msg":"[LLM] Retriable transport error"}
{"level":"info","time":"2026-01-31T14:31:04.103Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"3e56f10d-de04-48a9-ad83-bf4e0f9fd504","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:31:04.105Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":15339,"updatedAgeMs":299,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 15339, updatedAgeMs: 299"}
{"level":"warn","time":"2026-01-31T14:31:07.426Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","provider":"openai","operation":"completeJSON","latencyMs":4025,"success":false,"retryCount":2,"errorCode":"Error","errorReason":"Request was aborted.","timestamp":"2026-01-31T14:31:07.426Z","msg":"Provider call failed: openai.completeJSON"}
{"level":"warn","time":"2026-01-31T14:31:07.428Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"cuisine_enforcer","promptVersion":"unknown","requestId":"req-1769869848763-goml96fgo","attempt":3,"model":"gpt-4o-mini","timeoutMs":4000,"timeoutHit":true,"buildPromptMs":0.07,"networkMs":4026.85,"parseMs":0,"totalMs":13050.81,"promptChars":2629,"inputTokens":null,"outputTokens":null,"retriesCount":2,"success":false,"errorType":"abort_timeout","errorReason":"Request aborted or timeout","statusCode":null,"msg":"llm_gate_timing"}
{"level":"warn","time":"2026-01-31T14:31:07.429Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","attempt":3,"maxAttempts":3,"errorType":"abort_timeout","msg":"[LLM] Timeout, will retry with backoff"}
{"level":"warn","time":"2026-01-31T14:31:07.429Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","attempt":3,"maxAttempts":3,"msg":"[LLM] Retriable transport error"}
{"level":"error","time":"2026-01-31T14:31:07.429Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","attempts":3,"msg":"[LLM] All retry attempts exhausted"}
{"level":"error","time":"2026-01-31T14:31:07.430Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"cuisine_enforcement_llm_failed","policy":"SOFT_BOOST","error":"Request was aborted.","msg":"[CUISINE_ENFORCER] LLM call failed, returning all places"}
{"level":"info","time":"2026-01-31T14:31:07.431Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","pipelineVersion":"route2","event":"cuisine_enforcement_completed","countIn":9,"countOut":9,"relaxApplied":false,"relaxStrategy":"none","hasScores":false,"msg":"[ROUTE2] Cuisine enforcement completed"}
{"level":"info","time":"2026-01-31T14:31:07.431Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"cuisine_score_only_applied","countIn":9,"countOut":9,"mode":"SCORE_ONLY","msg":"[ROUTE2] Cuisine score-only mode: all results kept for ranking"}
{"level":"info","time":"2026-01-31T14:31:07.432Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","pipelineVersion":"route2","event":"await_post_constraints","msg":"[ROUTE2] Awaiting post constraints (late)"}
{"level":"info","time":"2026-01-31T14:31:07.488Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","status":"RUNNING","progress":75,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:31:07.489Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"ranking_input_order","count":9,"first10":[{"idx":0,"placeId":"ChIJ_S7mBQC7AhURwexf1P3Wrp8","rating":4.8,"userRatingCount":1021},{"idx":1,"placeId":"ChIJE3ynH5G5AhUR2Y_ifHJwHpI","rating":4.2,"userRatingCount":51},{"idx":2,"placeId":"ChIJtfMizea7AhURHix3ZiSHtXc","rating":4.3,"userRatingCount":2155},{"idx":3,"placeId":"ChIJ59KxWOS7AhUR8GRmz82gAPY","rating":4.1,"userRatingCount":801},{"idx":4,"placeId":"ChIJif-ayk27AhURHAx4Cif3RbY","rating":4.9,"userRatingCount":621},{"idx":5,"placeId":"ChIJja5NDWC5AhURJtQIcOHI2hM","rating":4.3,"userRatingCount":2427},{"idx":6,"placeId":"ChIJ01avgGW5AhURK77L-yJpgrA","rating":4.5,"userRatingCount":748},{"idx":7,"placeId":"ChIJWSq2RdS_AhURdiCI341I8GM","rating":4.7,"userRatingCount":664},{"idx":8,"placeId":"ChIJ9cu5nKK3AhURZbfGfRLIxdI","rating":4.8,"userRatingCount":910}],"orderSource":"google","reordered":false,"msg":"[RANKING] Input order (Google)"}
{"level":"info","time":"2026-01-31T14:31:07.490Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"ranking_profile_selected","profile":"NO_LOCATION","weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"reason":"no_user_location","cuisineKey":"asian","route":"TEXTSEARCH","source":"deterministic","msg":"[RANKING] No user location - using NO_LOCATION profile (distance weight = 0)"}
{"level":"info","time":"2026-01-31T14:31:07.491Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"ranking_distance_origin_selected","origin":"CITY_CENTER","cityText":"גדרה","hadUserLocation":false,"refLatLng":{"lat":31.8120082,"lng":34.7774347},"intentReason":"explicit_city_mentioned","msg":"[RANKING] Distance origin: CITY_CENTER"}
{"level":"info","time":"2026-01-31T14:31:07.492Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"ranking_output_order","count":9,"first10":[{"idx":0,"placeId":"ChIJja5NDWC5AhURJtQIcOHI2hM","rating":4.3,"userRatingCount":2427},{"idx":1,"placeId":"ChIJtfMizea7AhURHix3ZiSHtXc","rating":4.3,"userRatingCount":2155},{"idx":2,"placeId":"ChIJ_S7mBQC7AhURwexf1P3Wrp8","rating":4.8,"userRatingCount":1021},{"idx":3,"placeId":"ChIJ9cu5nKK3AhURZbfGfRLIxdI","rating":4.8,"userRatingCount":910},{"idx":4,"placeId":"ChIJif-ayk27AhURHAx4Cif3RbY","rating":4.9,"userRatingCount":621},{"idx":5,"placeId":"ChIJWSq2RdS_AhURdiCI341I8GM","rating":4.7,"userRatingCount":664},{"idx":6,"placeId":"ChIJ01avgGW5AhURK77L-yJpgrA","rating":4.5,"userRatingCount":748},{"idx":7,"placeId":"ChIJ59KxWOS7AhUR8GRmz82gAPY","rating":4.1,"userRatingCount":801},{"idx":8,"placeId":"ChIJE3ynH5G5AhUR2Y_ifHJwHpI","rating":4.2,"userRatingCount":51}],"orderSource":"ranking","reordered":true,"msg":"[RANKING] Output order (ranked)"}
{"level":"info","time":"2026-01-31T14:31:07.493Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"ranking_score_breakdown","profile":"BALANCED","top10":[{"placeId":"ChIJja5NDWC5AhURJtQIcOHI2hM","rating":4.3,"userRatingCount":2427,"distanceMeters":344,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.344,"reviewsScore":0.237,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.756},{"placeId":"ChIJtfMizea7AhURHix3ZiSHtXc","rating":4.3,"userRatingCount":2155,"distanceMeters":689,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.344,"reviewsScore":0.233,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.752},{"placeId":"ChIJ_S7mBQC7AhURwexf1P3Wrp8","rating":4.8,"userRatingCount":1021,"distanceMeters":1904,"openNow":false,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.384,"reviewsScore":0.211,"distanceScore":0,"openBoostScore":0,"cuisineMatchScore":0.075},"totalScore":0.67},{"placeId":"ChIJ9cu5nKK3AhURZbfGfRLIxdI","rating":4.8,"userRatingCount":910,"distanceMeters":6319,"openNow":false,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.384,"reviewsScore":0.207,"distanceScore":0,"openBoostScore":0,"cuisineMatchScore":0.075},"totalScore":0.666},{"placeId":"ChIJif-ayk27AhURHAx4Cif3RbY","rating":4.9,"userRatingCount":621,"distanceMeters":720,"openNow":false,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.392,"reviewsScore":0.196,"distanceScore":0,"openBoostScore":0,"cuisineMatchScore":0.075},"totalScore":0.663},{"placeId":"ChIJWSq2RdS_AhURdiCI341I8GM","rating":4.7,"userRatingCount":664,"distanceMeters":4868,"openNow":false,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.376,"reviewsScore":0.198,"distanceScore":0,"openBoostScore":0,"cuisineMatchScore":0.075},"totalScore":0.649},{"placeId":"ChIJ01avgGW5AhURK77L-yJpgrA","rating":4.5,"userRatingCount":748,"distanceMeters":553,"openNow":false,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.36,"reviewsScore":0.201,"distanceScore":0,"openBoostScore":0,"cuisineMatchScore":0.075},"totalScore":0.636},{"placeId":"ChIJ59KxWOS7AhUR8GRmz82gAPY","rating":4.1,"userRatingCount":801,"distanceMeters":768,"openNow":false,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.328,"reviewsScore":0.203,"distanceScore":0,"openBoostScore":0,"cuisineMatchScore":0.075},"totalScore":0.606},{"placeId":"ChIJE3ynH5G5AhUR2Y_ifHJwHpI","rating":4.2,"userRatingCount":51,"distanceMeters":1044,"openNow":false,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.336,"reviewsScore":0.12,"distanceScore":0,"openBoostScore":0,"cuisineMatchScore":0.075},"totalScore":0.531}],"msg":"[RANKING] Score breakdown for top 10 results"}
{"level":"info","time":"2026-01-31T14:31:07.497Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"post_rank_applied","profile":"BALANCED","weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"resultCount":9,"hadUserLocation":false,"mode":"LLM_SCORE","orderSource":"ranking","reordered":true,"msg":"[RANKING] Results ranked deterministically"}
{"level":"info","time":"2026-01-31T14:31:07.513Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","status":"RUNNING","progress":90,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:31:07.526Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"assistant_language_resolved","assistantLanguage":"he","source":"uiLanguage","detectedLanguage":"other","languageConfidence":1,"confidenceThreshold":0.7,"uiLanguage":"he","msg":"[ASSISTANT] Language resolved for assistant message"}
{"level":"info","time":"2026-01-31T14:31:07.529Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","assistantType":"SUMMARY","sessionIdPresent":true,"event":"assistant_deferred_start","msg":"[ASSISTANT] Deferred generation started (non-blocking)"}
{"level":"info","time":"2026-01-31T14:31:07.534Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","stage":"assistant_llm","event":"assistant_llm_start","type":"SUMMARY","questionLanguage":"he","queryLen":22,"schemaVersion":"v3_strict_validation","promptVersion":"v2_language_enforcement","msg":"[ASSISTANT] Calling LLM"}
{"level":"info","time":"2026-01-31T14:31:07.537Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"pagination_meta","fetchedCount":9,"returnedCount":9,"clientVisibleCount":12,"clientNextIncrement":5,"serverPagination":false,"msg":"[ROUTE2] Pagination metadata (client-side)"}
{"level":"info","time":"2026-01-31T14:31:07.538Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"final_response_order","count":9,"first10":[{"idx":0,"placeId":"ChIJja5NDWC5AhURJtQIcOHI2hM","name":"Aberto"},{"idx":1,"placeId":"ChIJtfMizea7AhURHix3ZiSHtXc","name":"Otman Brothers Restaurant"},{"idx":2,"placeId":"ChIJ_S7mBQC7AhURwexf1P3Wrp8","name":"אוטוטו מסעדת סושי סניף גדרה"},{"idx":3,"placeId":"ChIJ9cu5nKK3AhURZbfGfRLIxdI","name":"רד סאן סושי & ווק - בילו סנטר red sun sushi"},{"idx":4,"placeId":"ChIJif-ayk27AhURHAx4Cif3RbY","name":"טרנקילו בעיר אסאי מדרום אמריקה Tranquilo"},{"idx":5,"placeId":"ChIJWSq2RdS_AhURdiCI341I8GM","name":"התאילנדית"},{"idx":6,"placeId":"ChIJ01avgGW5AhURK77L-yJpgrA","name":"Beit tamar Gedera"},{"idx":7,"placeId":"ChIJ59KxWOS7AhUR8GRmz82gAPY","name":"מיו סושי"},{"idx":8,"placeId":"ChIJE3ynH5G5AhUR2Y_ifHJwHpI","name":"אושי אושי גדרה"}],"orderSource":"ranking","reordered":true,"msg":"[ROUTE2] Final response order (ranked deterministically)"}
{"level":"info","time":"2026-01-31T14:31:07.539Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"order_weights_resolved","base":"balanced","weights":{"rating":25,"reviews":20,"price":15,"openNow":15,"distance":25},"reasonCodes":["BASE_BALANCED"],"ctx":{"method":"textsearch","hasUserLocation":false,"distanceIntent":false,"openNowRequested":false,"priceIntent":"any","qualityIntent":false,"occasion":null,"cuisineKey":"asian"},"normalizedSum":100,"msg":"[ORDER] Hybrid order weights resolved"}
{"level":"info","time":"2026-01-31T14:31:07.541Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"response_order_check","hasOrder":true,"orderProfile":"balanced","resultCount":9,"msg":"[ORDER] Response order metadata check before send"}
{"level":"info","time":"2026-01-31T14:31:07.658Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","hasResult":true,"msg":"[RedisJobStore] Result stored"}
{"level":"info","time":"2026-01-31T14:31:07.659Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","resultCount":9,"hasAssist":true,"event":"result_stored","msg":"[Observability] Search result stored successfully"}
{"level":"info","time":"2026-01-31T14:31:07.721Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","status":"DONE_SUCCESS","progress":100,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:31:07.722Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","status":"DONE_SUCCESS","progress":100,"event":"status_done","msg":"[Observability] Job reached terminal status"}
{"level":"info","time":"2026-01-31T14:31:07.741Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"09e76a90-8bcb-4272-984b-589173e0ba82","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:31:07.745Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","event":"getResult_status","status":"DONE_SUCCESS","hasResult":true,"ageMs":18979,"updatedAgeMs":81,"progress":100,"isStale":false,"msg":"[HTTP] GET /result - status: DONE_SUCCESS, ageMs: 18979, updatedAgeMs: 81"}
{"level":"info","time":"2026-01-31T14:31:07.746Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","photoUrlsSanitized":true,"resultCount":9,"hasResult":true,"status":"DONE_SUCCESS","event":"getResult_returned","msg":"[Observability] GET /result returned successfully with results"}
{"level":"info","time":"2026-01-31T14:31:08.764Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"985e66f4-911f-439b-92be-3c25bd5d26ac","ip":"::1","photoRefHash":"9be35f1e11be","contentType":"image/jpeg","sizeBytes":42706,"durationMs":837,"slow":true,"msg":"[PhotoProxy] Photo served"}
{"level":"info","time":"2026-01-31T14:31:08.939Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"c32ff115-52a5-412a-9679-6b4dad6a303d","ip":"::1","photoRefHash":"046961c9ff2f","contentType":"image/jpeg","sizeBytes":38717,"durationMs":901,"slow":true,"msg":"[PhotoProxy] Photo served"}
{"level":"info","time":"2026-01-31T14:31:08.965Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"a0770fa9-3d46-4e8d-afd1-94351588c648","ip":"::1","photoRefHash":"e5b5943e459b","contentType":"image/jpeg","sizeBytes":30622,"durationMs":1048,"slow":true,"msg":"[PhotoProxy] Photo served"}
{"level":"info","time":"2026-01-31T14:31:09.033Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"2bdf2039-08ac-492c-85e9-bc9a7e9a8c63","ip":"::1","photoRefHash":"db1db3df12b0","contentType":"image/jpeg","sizeBytes":40063,"durationMs":1095,"slow":true,"msg":"[PhotoProxy] Photo served"}
{"level":"info","time":"2026-01-31T14:31:09.073Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"716fa136-0b6b-4a86-8a5d-ea08ca988f6c","ip":"::1","photoRefHash":"071939aade87","contentType":"image/jpeg","sizeBytes":54450,"durationMs":1058,"slow":true,"msg":"[PhotoProxy] Photo served"}
{"level":"info","time":"2026-01-31T14:31:09.087Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"3386288e-ff6b-4cc9-b9ad-ea6a9ab0a86e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1550,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:31:09.087Z","model":"gpt-4o-mini","tokensIn":921,"tokensOut":65,"totalTokens":986,"schemaName":"response","schemaStrict":true,"schemaHash":"4330761d782c","schemaVersion":"v1","promptVersion":"v2_language_enforcement","promptLength":2981,"estimatedCostUsd":0.00017715,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:31:09.089Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"assistant_llm","promptVersion":"v2_language_enforcement","schemaHash":"553fdda035a7","requestId":"req-1769869848763-goml96fgo","traceId":"3386288e-ff6b-4cc9-b9ad-ea6a9ab0a86e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3000,"timeoutHit":false,"buildPromptMs":0.2,"networkMs":1552.48,"parseMs":0.38,"totalMs":1553.17,"promptChars":2981,"inputTokens":921,"outputTokens":65,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:31:09.092Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","stage":"assistant_llm","event":"assistant_llm_success","type":"SUMMARY","questionLanguage":"he","suggestedAction":"NONE","blocksSearch":false,"durationMs":1556,"usage":{"prompt_tokens":921,"completion_tokens":65,"total_tokens":986},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"info","time":"2026-01-31T14:31:09.093Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","assistantType":"SUMMARY","durationMs":1564,"event":"assistant_deferred_done","msg":"[ASSISTANT] Deferred generation completed"}
{"level":"info","time":"2026-01-31T14:31:09.093Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","channel":"assistant","requestId":"req-1769869848763-goml96fgo","sessionHash":"2c3b20d765e7","payloadType":"assistant","event":"assistant_ws_publish","msg":"[ASSISTANT] Publishing to WebSocket"}
{"level":"info","time":"2026-01-31T14:31:09.095Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769869848763-goml96fgo","channel":"assistant","payloadType":"assistant","event":"assistant_published","assistantType":"SUMMARY","blocksSearch":false,"suggestedAction":"NONE","msg":"[ASSISTANT] Published to WebSocket"}
{"level":"info","time":"2026-01-31T14:31:09.157Z","pid":18572,"hostname":"il-dev-win-lt-shahar-pot","requestId":"6fd095a7-d0be-4179-a81b-3a6dfba4fa2c","ip":"::1","photoRefHash":"d8790f950e96","contentType":"image/jpeg","sizeBytes":43157,"durationMs":1151,"slow":true,"msg":"[PhotoProxy] Photo served"}
{"level":"warn","time":"2026-01-31T14:36:26.967Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:36:27.270Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:36:27.272Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:36:27.273Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:36:27.275Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:36:27.323Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:36:27.326Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":50,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:36:27.328Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:36:27.336Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:36:27.346Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:36:27.347Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:36:27.349Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:36:27.350Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:36:27.351Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:36:27.352Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"warn","time":"2026-01-31T14:36:27.180Z","pid":1408,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:36:27.440Z","pid":1408,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:36:27.442Z","pid":1408,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:36:27.443Z","pid":1408,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:36:27.446Z","pid":1408,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:36:27.482Z","pid":1408,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:36:27.485Z","pid":1408,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":38,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:36:27.487Z","pid":1408,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:36:27.495Z","pid":1408,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:36:27.500Z","pid":1408,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:36:27.501Z","pid":1408,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:36:27.503Z","pid":1408,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:36:27.503Z","pid":1408,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:36:27.504Z","pid":1408,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:36:27.505Z","pid":1408,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:36:27.508Z","pid":1408,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:36:28.181Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","traceId":"e52846cd-d10c-4e61-91ff-5a4e1149077e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"4d9898e6efc4","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:36:28.193Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870188193-bqdoir","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:36:28.196Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-01-31T14:36:28.197Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-01-31T14:36:28.197Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-01-31T14:36:28.197Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized with shared client"}
{"level":"info","time":"2026-01-31T14:36:28.199Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870188193-bqdoir","channel":"search","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:36:28.199Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870188193-bqdoir","channel":"search","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:36:28.201Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870188193-bqdoir","channel":"assistant","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:36:28.201Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870188193-bqdoir","channel":"assistant","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:36:28.768Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","traceId":"1fd7fee3-9fc4-4c09-9f21-de3af7fe4ab6","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"a9595de11905","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:36:28.774Z","pid":20788,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870188774-81ufq7","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:36:42.408Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:36:42.869Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:36:42.870Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:36:42.872Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:36:42.877Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:36:42.919Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:36:42.923Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":45,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:36:42.926Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:36:42.938Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:36:42.946Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:36:42.948Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:36:42.950Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:36:42.951Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:36:42.952Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:36:42.953Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"warn","time":"2026-01-31T14:36:42.582Z","pid":8720,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:36:42.972Z","pid":8720,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:36:42.975Z","pid":8720,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:36:42.977Z","pid":8720,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:36:42.980Z","pid":8720,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:36:43.031Z","pid":8720,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:36:43.035Z","pid":8720,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":54,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:36:43.037Z","pid":8720,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:36:43.069Z","pid":8720,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:36:43.085Z","pid":8720,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:36:43.086Z","pid":8720,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:36:43.090Z","pid":8720,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:36:43.093Z","pid":8720,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:36:43.095Z","pid":8720,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:36:43.244Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","traceId":"2861c23e-992f-4472-be74-c7a54f515abe","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"376397754d8f","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:36:43.252Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","traceId":"52f614de-0fef-41b3-9c0d-f3ad9fa0bcf2","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"c31fdca1b727","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:36:43.097Z","pid":8720,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:36:43.280Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870203279-if35gy","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"fatal","time":"2026-01-31T14:36:43.123Z","pid":8720,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:36:43.288Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-01-31T14:36:43.308Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-01-31T14:36:43.308Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-01-31T14:36:43.309Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized with shared client"}
{"level":"info","time":"2026-01-31T14:36:43.317Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870203279-if35gy","channel":"search","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:36:43.318Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870203279-if35gy","channel":"search","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:36:43.319Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870203279-if35gy","channel":"assistant","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:36:43.319Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870203279-if35gy","channel":"assistant","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:36:43.325Z","pid":18304,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870203325-xrpnjn","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:36:56.302Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:36:56.845Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:36:56.858Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:36:56.863Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:36:56.886Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:36:57.006Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:36:57.010Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":109,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:36:57.014Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:36:57.039Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:36:57.053Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:36:57.054Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:36:57.057Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:36:57.059Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:36:57.060Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:36:57.062Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"warn","time":"2026-01-31T14:36:56.375Z","pid":19028,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:36:57.049Z","pid":19028,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:36:57.054Z","pid":19028,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:36:57.057Z","pid":19028,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:36:57.062Z","pid":19028,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:36:57.115Z","pid":19028,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:36:57.119Z","pid":19028,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":56,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:36:57.122Z","pid":19028,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:36:57.136Z","pid":19028,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:36:57.146Z","pid":19028,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:36:57.148Z","pid":19028,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:36:57.151Z","pid":19028,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:36:57.152Z","pid":19028,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:36:57.154Z","pid":19028,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:36:57.155Z","pid":19028,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:36:57.165Z","pid":19028,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:36:57.192Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","traceId":"dec40f0c-7d9b-4105-a44b-c196e2427c71","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"37f88e383d5e","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:36:57.218Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870217217-nb6law","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:36:57.228Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-01-31T14:36:57.232Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-01-31T14:36:57.233Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-01-31T14:36:57.233Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized with shared client"}
{"level":"info","time":"2026-01-31T14:36:57.241Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870217217-nb6law","channel":"search","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:36:57.242Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870217217-nb6law","channel":"search","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:36:57.244Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870217217-nb6law","channel":"assistant","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:36:57.245Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870217217-nb6law","channel":"assistant","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:36:57.558Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","traceId":"3986293b-a794-4fb1-b487-90593d56282d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"de9f1d035197","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:36:57.571Z","pid":17888,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870217570-5iq4rz","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:37:13.523Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:37:14.207Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:37:14.234Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:37:14.236Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:37:14.239Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:37:14.417Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:37:14.422Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":180,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:37:14.427Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:37:14.446Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:37:14.457Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:37:14.460Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:37:14.465Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:37:14.466Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:37:14.468Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:37:14.469Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:37:15.313Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","traceId":"888a5e60-95e2-459a-8b50-e6117dd7b4e1","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"d967b2eb6a4a","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:37:15.343Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870235342-b0bfqv","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:37:15.353Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-01-31T14:37:15.355Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-01-31T14:37:15.356Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-01-31T14:37:15.363Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized with shared client"}
{"level":"info","time":"2026-01-31T14:37:15.371Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870235342-b0bfqv","channel":"search","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:37:15.372Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870235342-b0bfqv","channel":"search","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:37:15.373Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870235342-b0bfqv","channel":"assistant","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:37:15.375Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870235342-b0bfqv","channel":"assistant","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"warn","time":"2026-01-31T14:37:14.133Z","pid":18792,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:37:15.485Z","pid":18792,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:37:15.487Z","pid":18792,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:37:15.491Z","pid":18792,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:37:15.537Z","pid":18792,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:37:15.693Z","pid":18792,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:37:15.700Z","pid":18792,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":160,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:37:15.703Z","pid":18792,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:37:15.768Z","pid":18792,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:37:15.781Z","pid":18792,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:37:15.783Z","pid":18792,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:37:15.787Z","pid":18792,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:37:15.789Z","pid":18792,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:37:15.812Z","pid":18792,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:37:15.814Z","pid":18792,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:37:15.836Z","pid":18792,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:37:16.079Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","traceId":"32d35b37-20d4-45e7-9286-05925ed82923","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"6185bfbc68d1","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:37:16.098Z","pid":19704,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870236098-92w205","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:37:41.046Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:37:42.240Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:37:42.242Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:37:42.244Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:37:42.257Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:37:42.475Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:37:42.480Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":221,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:37:42.484Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:37:42.504Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:37:42.528Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:37:42.530Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:37:42.537Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:37:42.538Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:37:42.541Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:37:42.544Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:37:43.055Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","traceId":"4e178d99-f638-498a-8da4-60ce9469b745","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"d2786eef642d","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:37:43.150Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870263150-s6w2ay","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:37:44.113Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","traceId":"8523c048-78c0-4c4b-bd51-a3d0596f1666","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"825783f97f49","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:37:44.149Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870264149-v17usw","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:37:44.166Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-01-31T14:37:44.172Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-01-31T14:37:44.173Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-01-31T14:37:44.174Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized with shared client"}
{"level":"info","time":"2026-01-31T14:37:44.180Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870264149-v17usw","channel":"search","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:37:44.183Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870264149-v17usw","channel":"search","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:37:44.193Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870264149-v17usw","channel":"assistant","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:37:44.193Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870264149-v17usw","channel":"assistant","requestIdHash":"1228ae0a68f3","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"warn","time":"2026-01-31T14:37:43.634Z","pid":16764,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:37:44.829Z","pid":16764,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:37:44.832Z","pid":16764,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:37:44.835Z","pid":16764,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:37:44.910Z","pid":16764,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:37:45.005Z","pid":16764,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:37:45.009Z","pid":16764,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":97,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:37:45.012Z","pid":16764,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:37:45.062Z","pid":16764,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:37:45.074Z","pid":16764,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:37:45.075Z","pid":16764,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:37:45.079Z","pid":16764,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:37:45.080Z","pid":16764,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:37:45.081Z","pid":16764,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:37:45.083Z","pid":16764,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:37:45.092Z","pid":16764,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:37:45.961Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870264149-v17usw","code":1001,"reason":"none","wasClean":true,"msg":"websocket_disconnected"}
{"level":"info","time":"2026-01-31T14:37:46.512Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","traceId":"9b5f3ce7-4a9e-4bec-a16f-be5f93a53a43","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"3bfcb6e76ef5","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:37:46.529Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870266529-64htcp","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:38:08.139Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","query":"מסעדות  אסיאתיות בגדרה","status":"PENDING","hasOwner":true,"hasIdempotencyKey":true,"msg":"[RedisJobStore] Job created"}
{"level":"info","time":"2026-01-31T14:38:08.141Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","sessionHash":"2c3b20d765e7","hasUserId":false,"operation":"createJob","decision":"ACCEPTED","hasIdempotencyKey":true,"event":"job_created","msg":"[Observability] Job created with JWT session binding and idempotency key"}
{"level":"info","time":"2026-01-31T14:38:08.152Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","status":"RUNNING","progress":10,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:38:08.152Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","status":"RUNNING","progress":10,"event":"status_running","msg":"[Observability] Job status set to RUNNING"}
{"level":"info","time":"2026-01-31T14:38:08.154Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769870288126-1zv5nhiv6","event":"backlog_created","msg":"WebSocket backlog created for late subscribers"}
{"level":"info","time":"2026-01-31T14:38:08.157Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","pipelineVersion":"route2","event":"pipeline_selected","queryLen":22,"queryHash":"424f035aa371","msg":"[ROUTE2] Pipeline selected"}
{"level":"info","time":"2026-01-31T14:38:08.160Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","pipelineVersion":"route2","event":"device_region_resolved","userRegionCode":"IL","userRegionSource":"config","msg":"[ROUTE2] Device region resolved"}
{"level":"info","time":"2026-01-31T14:38:08.162Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","traceId":"06af385f-3e8a-4e9a-b0dc-0ee665db7925","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_started","queryLen":22,"queryHash":"424f035aa371","msg":"[ROUTE2] gate2 started"}
{"level":"info","time":"2026-01-31T14:38:08.306Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870266529-64htcp","channel":"search","requestIdHash":"a8999deca186","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:38:08.307Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870266529-64htcp","channel":"search","requestIdHash":"a8999deca186","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:38:08.308Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870266529-64htcp","channel":"assistant","requestIdHash":"a8999deca186","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:38:08.309Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870266529-64htcp","channel":"assistant","requestIdHash":"a8999deca186","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:38:08.311Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769870288126-1zv5nhiv6","count":1,"event":"backlog_drained","msg":"WebSocket backlog drained to late subscriber"}
{"level":"info","time":"2026-01-31T14:38:09.051Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"06af385f-3e8a-4e9a-b0dc-0ee665db7925","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":887,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:38:09.051Z","model":"gpt-4o-mini","tokensIn":386,"tokensOut":12,"totalTokens":398,"schemaName":"response","schemaStrict":true,"schemaHash":"ecbf2c0a0457","schemaVersion":"v1","promptVersion":"gate2_v4","promptHash":"781640b134b1bdffb237ee48622de2f20ebc911203fc18971f33f55e3547824f","promptLength":1012,"estimatedCostUsd":0.0000651,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:38:09.054Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","traceId":"06af385f-3e8a-4e9a-b0dc-0ee665db7925","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_completed","durationMs":892,"route":"CONTINUE","foodSignal":"YES","confidence":0.95,"tokenUsage":{"input":386,"output":12,"total":398,"model":"gpt-4o-mini"},"msg":"[ROUTE2] gate2 completed"}
{"level":"info","time":"2026-01-31T14:38:09.061Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","status":"RUNNING","progress":25,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:38:09.062Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","traceId":"06af385f-3e8a-4e9a-b0dc-0ee665db7925","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"intent","event":"stage_started","queryLen":22,"queryHash":"424f035aa371","msg":"[ROUTE2] intent started"}
{"level":"info","time":"2026-01-31T14:38:10.796Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"06af385f-3e8a-4e9a-b0dc-0ee665db7925","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1733,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:38:10.796Z","model":"gpt-4o-mini","tokensIn":1600,"tokensOut":80,"totalTokens":1680,"schemaName":"response","schemaStrict":true,"schemaHash":"f731e75551db","schemaVersion":"v1","promptVersion":"intent_v4","promptHash":"7d0cb4f0f10cec33408d81bef29a9ab039df93163813d0fb2660eb8dda9adb95","estimatedCostUsd":0.000288,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:38:10.799Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"intent","promptVersion":"intent_v4","schemaHash":"f58b8106b963","requestId":"req-1769870288126-1zv5nhiv6","traceId":"06af385f-3e8a-4e9a-b0dc-0ee665db7925","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3500,"timeoutHit":false,"buildPromptMs":0.08,"networkMs":1734.43,"parseMs":1.87,"totalMs":1736.46,"promptChars":4879,"inputTokens":1600,"outputTokens":80,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:38:10.800Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","traceId":"06af385f-3e8a-4e9a-b0dc-0ee665db7925","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"intent","event":"stage_completed","durationMs":1738,"route":"TEXTSEARCH","confidence":1,"reason":"explicit_city_mentioned","msg":"[ROUTE2] intent completed"}
{"level":"info","time":"2026-01-31T14:38:10.816Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","status":"RUNNING","progress":40,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:38:10.817Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","pipelineVersion":"route2","event":"intent_decided","route":"TEXTSEARCH","regionCandidate":"IL","language":"he","confidence":1,"reason":"explicit_city_mentioned","msg":"[ROUTE2] Intent routing decided (regionCandidate will be validated by filters_resolved)"}
{"level":"info","time":"2026-01-31T14:38:10.819Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","pipelineVersion":"route2","event":"parallel_started","route":"TEXTSEARCH","isGenericWithLocation":false,"skipBaseFilters":false,"hasUserLocation":false,"hasCityText":true,"msg":"[ROUTE2] Starting parallel tasks (base_filters + post_constraints)"}
{"level":"info","time":"2026-01-31T14:38:10.821Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","pipelineVersion":"route2","event":"base_filters_llm_started","query":"מסעדות  אסיאתיות בגדרה","route":"TEXTSEARCH","msg":"[ROUTE2] Base filters LLM started"}
{"level":"info","time":"2026-01-31T14:38:10.824Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","pipelineVersion":"route2","event":"google_parallel_started","regionCode":"IL","providerLanguage":"he","uiLanguage":"he","msg":"[ROUTE2] Starting Google fetch in parallel (early context derived)"}
{"level":"info","time":"2026-01-31T14:38:10.828Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","stage":"textsearch_mapper","event":"schema_check_before_llm","schemaId":"TEXTSEARCH_JSON_SCHEMA","schemaProperties":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"schemaPropertiesCount":12,"schemaRequired":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"schemaRequiredCount":12,"hasModeField":true,"schemaValid":true,"schemaHash":"textsearch_v5_keyed_freetext_mode"}
{"level":"info","time":"2026-01-31T14:38:10.829Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","stage":"textsearch_mapper","event":"schema_final_check","schemaType":"object","propertyKeys":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"requiredKeys":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"hasModeField":true,"additionalProperties":false,"isValid":true,"msg":"[TEXTSEARCH] Final schema check before OpenAI call"}
{"level":"info","time":"2026-01-31T14:38:11.899Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"08c9061e-4f1a-452e-9a61-911fe8ba2fce","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:38:11.901Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":3766,"updatedAgeMs":1099,"progress":40,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 3766, updatedAgeMs: 1099"}
{"level":"info","time":"2026-01-31T14:38:12.211Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"06af385f-3e8a-4e9a-b0dc-0ee665db7925","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1388,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:38:12.211Z","model":"gpt-4o-mini","tokensIn":2235,"tokensOut":43,"totalTokens":2278,"schemaName":"response","schemaStrict":true,"schemaHash":"d2d4176c14f8","schemaVersion":"v1","promptVersion":"base_filters_v1","promptHash":"64746426a1544301b1adce867016af0bd7a4c23cd83d1134c7a6e6c47a8c2d77","promptLength":5587,"estimatedCostUsd":0.00036104999999999997,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:38:12.213Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","pipelineVersion":"route2","event":"base_filters_llm_completed","durationMs":1392,"language":"he","openState":null,"openAt":null,"openBetween":null,"priceIntent":null,"minRatingBucket":null,"minReviewCountBucket":null,"regionHint":null,"tokenUsage":{"input":2235,"output":43,"total":2278,"model":"gpt-4o-mini"},"msg":"[ROUTE2] Base filters LLM completed"}
{"level":"info","time":"2026-01-31T14:38:12.659Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"06af385f-3e8a-4e9a-b0dc-0ee665db7925","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1839,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:38:12.659Z","model":"gpt-4o-mini","tokensIn":1697,"tokensOut":61,"totalTokens":1758,"schemaName":"response","schemaStrict":true,"schemaHash":"9cb7c40fd303","schemaVersion":"v1","promptVersion":"post_constraints_v1","promptHash":"7a9eb00cc4c93e1a79c0b2b54a37ae3f0f136351e35eca7a675dba627252da53","estimatedCostUsd":0.00029115,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:38:12.662Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"post_constraints","promptVersion":"post_constraints_v1","schemaHash":"666abe1760c4","requestId":"req-1769870288126-1zv5nhiv6","traceId":"06af385f-3e8a-4e9a-b0dc-0ee665db7925","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3500,"timeoutHit":false,"buildPromptMs":0.15,"networkMs":1839.98,"parseMs":1.12,"totalMs":1841.38,"promptChars":4345,"inputTokens":1697,"outputTokens":61,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:38:13.076Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"06af385f-3e8a-4e9a-b0dc-0ee665db7925","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":2246,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:38:13.076Z","model":"gpt-4o-mini","tokensIn":965,"tokensOut":99,"totalTokens":1064,"schemaName":"response","schemaStrict":true,"schemaHash":"924556626f01","schemaVersion":"v1","promptVersion":"textsearch_mapper_v4_keyed_freetext","promptHash":"6ec296a5225613c761b0a90ee0f4c21f97678e5167324a48f11ec42152ee1caa","estimatedCostUsd":0.00020415,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:38:13.078Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"textsearch_mapper","promptVersion":"textsearch_mapper_v4_keyed_freetext","schemaHash":"textsearch_v5_keyed_freetext_mode","requestId":"req-1769870288126-1zv5nhiv6","traceId":"06af385f-3e8a-4e9a-b0dc-0ee665db7925","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3500,"timeoutHit":false,"buildPromptMs":0.13,"networkMs":2246.35,"parseMs":1.65,"totalMs":2248.22,"promptChars":2277,"inputTokens":965,"outputTokens":99,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:38:13.079Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","stage":"textsearch_mapper","event":"deterministic_builder_keyed","mode":"KEYED","cuisineKey":"asian","cityText":"גדרה","cityEnglish":"Gedera","providerTextQuery":"Asian restaurant in Gedera","providerLanguage":"en","source":"deterministic_builder","msg":"[TEXTSEARCH] Built KEYED mode query (cuisine + city) - fully in English"}
{"level":"info","time":"2026-01-31T14:38:13.079Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","stage":"textsearch_mapper","event":"cuisine_terms_generated","cuisineKey":"asian","searchLanguage":"he","requiredTerms":["אסייתית","אסיה"],"preferredTerms":["סיני","תאילנדי","יפני"],"msg":"[TEXTSEARCH] Generated cuisine terms from cuisineKey"}
{"level":"info","time":"2026-01-31T14:38:13.080Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","stage":"textsearch_mapper","event":"bias_planned","source":"cityCenter_pending_geocode","cityText":"גדרה","intentReason":"explicit_city_mentioned","note":"explicit_city_preferred_over_userLocation","msg":"[TEXTSEARCH] City-center bias planned (explicit city takes priority over userLocation)"}
{"level":"info","time":"2026-01-31T14:38:13.080Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","stage":"textsearch_mapper","event":"mapper_success","mode":"KEYED","cuisineKey":"asian","cityText":"גדרה","providerTextQuery":"Asian restaurant in Gedera","providerLanguage":"en","source":"deterministic_builder_keyed","strictness":"STRICT","msg":"[TEXTSEARCH] Mapper completed successfully"}
{"level":"info","time":"2026-01-31T14:38:13.080Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","pipelineVersion":"route2","event":"route_llm_mapped","providerMethod":"textSearch","region":"IL","language":"he","msg":"[ROUTE2] Route-LLM mapping completed (using early context)"}
{"level":"info","time":"2026-01-31T14:38:13.081Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","pipelineVersion":"route2","stage":"google_maps","event":"stage_started","providerMethod":"textSearch","region":"IL","language":"he","msg":"[ROUTE2] google_maps started"}
{"level":"info","time":"2026-01-31T14:38:13.082Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","provider":"google_places_new","method":"searchText","providerTextQuery":"Asian restaurant in Gedera","providerLanguage":"en","region":"IL","hasBiasPlanned":true,"biasSource":"cityText_pending_geocode","mode":"KEYED","cityText":"גדרה","msg":"[GOOGLE] Calling Text Search API (New) - using providerTextQuery/providerLanguage"}
{"level":"info","time":"2026-01-31T14:38:13.082Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"CACHE_WRAP_ENTER","providerMethod":"textSearch","cacheKey":"g:textsearch:b24ed3d5a99243c50e0736bd98ce21c0","ttlSeconds":900}
{"level":"info","time":"2026-01-31T14:38:13.084Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","pipelineVersion":"route2","event":"google_parallel_awaited","parallelDurationMs":2260,"msg":"[ROUTE2] Awaiting Google results + base_filters/post_constraints (barrier)"}
{"level":"info","time":"2026-01-31T14:38:13.084Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","pipelineVersion":"route2","event":"await_base_filters","msg":"[ROUTE2] Awaiting base filters"}
{"level":"info","time":"2026-01-31T14:38:13.085Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"language_context_resolved","uiLanguage":"he","queryLanguage":"he","intentLanguage":"he","intentLanguageConfidence":1,"assistantLanguage":"he","searchLanguage":"he","providerLanguage":"he","regionCode":"IL","sources":{"assistantLanguage":"query_language_deterministic","searchLanguage":"query_language_policy"},"providerLanguagePolicy":"queryLanguage","msg":"[LANGUAGE] Language context resolved with strict separation"}
{"level":"info","time":"2026-01-31T14:38:13.085Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","pipelineVersion":"route2","event":"filters_resolved","base":{"language":"he","openState":null,"openAt":null,"openBetween":null,"priceIntent":null,"minRatingBucket":null,"regionHint":null},"final":{"uiLanguage":"he","providerLanguage":"he","openState":null,"openAt":null,"openBetween":null,"priceIntent":null,"minRatingBucket":null,"regionCode":"IL"},"sanitized":false,"msg":"[ROUTE2] Filters resolved"}
{"level":"info","time":"2026-01-31T14:38:13.088Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"CACHE_WRAP_EXIT","providerMethod":"textSearch","servedFrom":"cache","cacheTier":"L2","durationMs":7}
{"level":"info","time":"2026-01-31T14:38:13.089Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","provider":"google_places_new","method":"searchText","durationMs":8,"resultCount":9,"fieldMaskUsed":"places.id,places.displayName,places.formattedAddress,places.location,places.rating,places.userRatingCount,places.priceLevel,places.currentOpeningHours,places.regularOpeningHours,places.utcOffsetMinutes,places.photos,places.types,places.googleMapsUri","servedFrom":"cache","msg":"[GOOGLE] Text Search completed"}
{"level":"info","time":"2026-01-31T14:38:13.090Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","pipelineVersion":"route2","stage":"google_maps","event":"stage_completed","durationMs":9,"providerMethod":"textSearch","resultCount":9,"region":"IL","language":"he","msg":"[ROUTE2] google_maps completed"}
{"level":"info","time":"2026-01-31T14:38:13.090Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","pipelineVersion":"route2","event":"google_parallel_completed","totalDurationMs":2266,"googleDurationMs":9,"criticalPathSavedMs":2257,"msg":"[ROUTE2] Google fetch completed (parallel optimization saved time)"}
{"level":"info","time":"2026-01-31T14:38:13.109Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","status":"RUNNING","progress":60,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:38:13.110Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","pipelineVersion":"route2","event":"cuisine_enforcement_started","strictness":"STRICT","requiredTerms":["אסייתית","אסיה"],"preferredTerms":["סיני","תאילנדי","יפני"],"countIn":9,"hardConstraintsExist":false,"hardConstraintsActive":[],"msg":"[ROUTE2] Starting cuisine enforcement"}
{"level":"info","time":"2026-01-31T14:38:13.111Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode_enforced","countIn":9,"msg":"[CUISINE_ENFORCER] Policy: SOFT_BOOST (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:38:13.112Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v2","policy":"SOFT_BOOST","strictness":"STRICT","requiredTermsCount":2,"preferredTermsCount":3,"placesCount":9,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for enforcement"}
{"level":"info","time":"2026-01-31T14:38:13.329Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"8fff1403-7752-4975-982c-cb84454e9420","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:38:13.330Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":5195,"updatedAgeMs":236,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 5195, updatedAgeMs: 236"}
{"level":"info","time":"2026-01-31T14:38:14.827Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"30b7dd37-c6a6-4843-badd-ce047f540404","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:38:14.829Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":6694,"updatedAgeMs":1735,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 6694, updatedAgeMs: 1735"}
{"level":"info","time":"2026-01-31T14:38:16.176Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"b6861cf0-a6c5-499e-bc6e-2b6400eab791","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:38:16.178Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":8043,"updatedAgeMs":3084,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 8043, updatedAgeMs: 3084"}
{"level":"warn","time":"2026-01-31T14:38:17.130Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","provider":"openai","operation":"completeJSON","latencyMs":4018,"success":false,"retryCount":0,"errorCode":"Error","errorReason":"Request was aborted.","timestamp":"2026-01-31T14:38:17.130Z","msg":"Provider call failed: openai.completeJSON"}
{"level":"warn","time":"2026-01-31T14:38:17.131Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"cuisine_enforcer","promptVersion":"unknown","requestId":"req-1769870288126-1zv5nhiv6","attempt":1,"model":"gpt-4o-mini","timeoutMs":4000,"timeoutHit":true,"buildPromptMs":0.07,"networkMs":4018.73,"parseMs":0,"totalMs":4018.84,"promptChars":2629,"inputTokens":null,"outputTokens":null,"retriesCount":0,"success":false,"errorType":"abort_timeout","errorReason":"Request aborted or timeout","statusCode":null,"msg":"llm_gate_timing"}
{"level":"warn","time":"2026-01-31T14:38:17.132Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","attempt":1,"maxAttempts":3,"errorType":"abort_timeout","msg":"[LLM] Timeout, will retry with backoff"}
{"level":"warn","time":"2026-01-31T14:38:17.132Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","attempt":1,"maxAttempts":3,"msg":"[LLM] Retriable transport error"}
{"level":"info","time":"2026-01-31T14:38:17.414Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"c6135985-efdb-428e-9ddf-fc67d730b4c8","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:38:17.419Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":9284,"updatedAgeMs":4325,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 9284, updatedAgeMs: 4325"}
{"level":"info","time":"2026-01-31T14:38:18.867Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"6211ddae-8c3d-4f73-b344-47e237c5367c","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:38:18.869Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":10734,"updatedAgeMs":5775,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 10734, updatedAgeMs: 5775"}
{"level":"info","time":"2026-01-31T14:38:21.092Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"4b5796c0-e7c5-4450-bb3e-cdf1b6c5d8b0","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:38:21.094Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":12959,"updatedAgeMs":8000,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 12959, updatedAgeMs: 8000"}
{"level":"warn","time":"2026-01-31T14:38:21.397Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","provider":"openai","operation":"completeJSON","latencyMs":4004,"success":false,"retryCount":1,"errorCode":"Error","errorReason":"Request was aborted.","timestamp":"2026-01-31T14:38:21.397Z","msg":"Provider call failed: openai.completeJSON"}
{"level":"warn","time":"2026-01-31T14:38:21.398Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"cuisine_enforcer","promptVersion":"unknown","requestId":"req-1769870288126-1zv5nhiv6","attempt":2,"model":"gpt-4o-mini","timeoutMs":4000,"timeoutHit":true,"buildPromptMs":0.07,"networkMs":4004.92,"parseMs":0,"totalMs":8286.17,"promptChars":2629,"inputTokens":null,"outputTokens":null,"retriesCount":1,"success":false,"errorType":"abort_timeout","errorReason":"Request aborted or timeout","statusCode":null,"msg":"llm_gate_timing"}
{"level":"warn","time":"2026-01-31T14:38:21.398Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","attempt":2,"maxAttempts":3,"errorType":"abort_timeout","msg":"[LLM] Timeout, will retry with backoff"}
{"level":"warn","time":"2026-01-31T14:38:21.399Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","attempt":2,"maxAttempts":3,"msg":"[LLM] Retriable transport error"}
{"level":"info","time":"2026-01-31T14:38:23.097Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"62f4eba6-b6a1-4254-8a5b-a59b88f03001","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:38:23.098Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":14963,"updatedAgeMs":10004,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 14963, updatedAgeMs: 10004"}
{"level":"warn","time":"2026-01-31T14:38:26.162Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","provider":"openai","operation":"completeJSON","latencyMs":4011,"success":false,"retryCount":2,"errorCode":"Error","errorReason":"Request was aborted.","timestamp":"2026-01-31T14:38:26.162Z","msg":"Provider call failed: openai.completeJSON"}
{"level":"warn","time":"2026-01-31T14:38:26.163Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"cuisine_enforcer","promptVersion":"unknown","requestId":"req-1769870288126-1zv5nhiv6","attempt":3,"model":"gpt-4o-mini","timeoutMs":4000,"timeoutHit":true,"buildPromptMs":0.07,"networkMs":4011.95,"parseMs":0,"totalMs":13050.72,"promptChars":2629,"inputTokens":null,"outputTokens":null,"retriesCount":2,"success":false,"errorType":"abort_timeout","errorReason":"Request aborted or timeout","statusCode":null,"msg":"llm_gate_timing"}
{"level":"warn","time":"2026-01-31T14:38:26.163Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","attempt":3,"maxAttempts":3,"errorType":"abort_timeout","msg":"[LLM] Timeout, will retry with backoff"}
{"level":"warn","time":"2026-01-31T14:38:26.163Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","attempt":3,"maxAttempts":3,"msg":"[LLM] Retriable transport error"}
{"level":"error","time":"2026-01-31T14:38:26.163Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","attempts":3,"msg":"[LLM] All retry attempts exhausted"}
{"level":"error","time":"2026-01-31T14:38:26.163Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"cuisine_enforcement_llm_failed","policy":"SOFT_BOOST","error":"Request was aborted.","msg":"[CUISINE_ENFORCER] LLM call failed, returning all places"}
{"level":"info","time":"2026-01-31T14:38:26.164Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","pipelineVersion":"route2","event":"cuisine_enforcement_completed","countIn":9,"countOut":9,"relaxApplied":false,"relaxStrategy":"none","hasScores":false,"msg":"[ROUTE2] Cuisine enforcement completed"}
{"level":"info","time":"2026-01-31T14:38:26.164Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"cuisine_score_only_applied","countIn":9,"countOut":9,"mode":"SCORE_ONLY","msg":"[ROUTE2] Cuisine score-only mode: all results kept for ranking"}
{"level":"info","time":"2026-01-31T14:38:26.164Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","pipelineVersion":"route2","event":"await_post_constraints","msg":"[ROUTE2] Awaiting post constraints (late)"}
{"level":"info","time":"2026-01-31T14:38:26.179Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","status":"RUNNING","progress":75,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:38:26.180Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"ranking_input_order","count":9,"first10":[{"idx":0,"placeId":"ChIJ_S7mBQC7AhURwexf1P3Wrp8","rating":4.8,"userRatingCount":1021},{"idx":1,"placeId":"ChIJE3ynH5G5AhUR2Y_ifHJwHpI","rating":4.2,"userRatingCount":51},{"idx":2,"placeId":"ChIJtfMizea7AhURHix3ZiSHtXc","rating":4.3,"userRatingCount":2155},{"idx":3,"placeId":"ChIJ59KxWOS7AhUR8GRmz82gAPY","rating":4.1,"userRatingCount":801},{"idx":4,"placeId":"ChIJif-ayk27AhURHAx4Cif3RbY","rating":4.9,"userRatingCount":621},{"idx":5,"placeId":"ChIJja5NDWC5AhURJtQIcOHI2hM","rating":4.3,"userRatingCount":2427},{"idx":6,"placeId":"ChIJ01avgGW5AhURK77L-yJpgrA","rating":4.5,"userRatingCount":748},{"idx":7,"placeId":"ChIJWSq2RdS_AhURdiCI341I8GM","rating":4.7,"userRatingCount":664},{"idx":8,"placeId":"ChIJ9cu5nKK3AhURZbfGfRLIxdI","rating":4.8,"userRatingCount":910}],"orderSource":"google","reordered":false,"msg":"[RANKING] Input order (Google)"}
{"level":"info","time":"2026-01-31T14:38:26.181Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"ranking_profile_selected","profile":"NO_LOCATION","weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"reason":"no_user_location","cuisineKey":"asian","route":"TEXTSEARCH","source":"deterministic","msg":"[RANKING] No user location - using NO_LOCATION profile (distance weight = 0)"}
{"level":"info","time":"2026-01-31T14:38:26.181Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"ranking_distance_origin_selected","origin":"NONE","hadUserLocation":false,"intentReason":"explicit_city_mentioned","msg":"[RANKING] Distance origin: NONE"}
{"level":"info","time":"2026-01-31T14:38:26.182Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"ranking_output_order","count":9,"first10":[{"idx":0,"placeId":"ChIJja5NDWC5AhURJtQIcOHI2hM","rating":4.3,"userRatingCount":2427},{"idx":1,"placeId":"ChIJtfMizea7AhURHix3ZiSHtXc","rating":4.3,"userRatingCount":2155},{"idx":2,"placeId":"ChIJ_S7mBQC7AhURwexf1P3Wrp8","rating":4.8,"userRatingCount":1021},{"idx":3,"placeId":"ChIJ9cu5nKK3AhURZbfGfRLIxdI","rating":4.8,"userRatingCount":910},{"idx":4,"placeId":"ChIJif-ayk27AhURHAx4Cif3RbY","rating":4.9,"userRatingCount":621},{"idx":5,"placeId":"ChIJWSq2RdS_AhURdiCI341I8GM","rating":4.7,"userRatingCount":664},{"idx":6,"placeId":"ChIJ01avgGW5AhURK77L-yJpgrA","rating":4.5,"userRatingCount":748},{"idx":7,"placeId":"ChIJ59KxWOS7AhUR8GRmz82gAPY","rating":4.1,"userRatingCount":801},{"idx":8,"placeId":"ChIJE3ynH5G5AhUR2Y_ifHJwHpI","rating":4.2,"userRatingCount":51}],"orderSource":"ranking","reordered":true,"msg":"[RANKING] Output order (ranked)"}
{"level":"info","time":"2026-01-31T14:38:26.182Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"ranking_score_breakdown","profile":"BALANCED","top10":[{"placeId":"ChIJja5NDWC5AhURJtQIcOHI2hM","rating":4.3,"userRatingCount":2427,"distanceMeters":null,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.344,"reviewsScore":0.237,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.756},{"placeId":"ChIJtfMizea7AhURHix3ZiSHtXc","rating":4.3,"userRatingCount":2155,"distanceMeters":null,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.344,"reviewsScore":0.233,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.752},{"placeId":"ChIJ_S7mBQC7AhURwexf1P3Wrp8","rating":4.8,"userRatingCount":1021,"distanceMeters":null,"openNow":false,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.384,"reviewsScore":0.211,"distanceScore":0,"openBoostScore":0,"cuisineMatchScore":0.075},"totalScore":0.67},{"placeId":"ChIJ9cu5nKK3AhURZbfGfRLIxdI","rating":4.8,"userRatingCount":910,"distanceMeters":null,"openNow":false,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.384,"reviewsScore":0.207,"distanceScore":0,"openBoostScore":0,"cuisineMatchScore":0.075},"totalScore":0.666},{"placeId":"ChIJif-ayk27AhURHAx4Cif3RbY","rating":4.9,"userRatingCount":621,"distanceMeters":null,"openNow":false,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.392,"reviewsScore":0.196,"distanceScore":0,"openBoostScore":0,"cuisineMatchScore":0.075},"totalScore":0.663},{"placeId":"ChIJWSq2RdS_AhURdiCI341I8GM","rating":4.7,"userRatingCount":664,"distanceMeters":null,"openNow":false,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.376,"reviewsScore":0.198,"distanceScore":0,"openBoostScore":0,"cuisineMatchScore":0.075},"totalScore":0.649},{"placeId":"ChIJ01avgGW5AhURK77L-yJpgrA","rating":4.5,"userRatingCount":748,"distanceMeters":null,"openNow":false,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.36,"reviewsScore":0.201,"distanceScore":0,"openBoostScore":0,"cuisineMatchScore":0.075},"totalScore":0.636},{"placeId":"ChIJ59KxWOS7AhUR8GRmz82gAPY","rating":4.1,"userRatingCount":801,"distanceMeters":null,"openNow":false,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.328,"reviewsScore":0.203,"distanceScore":0,"openBoostScore":0,"cuisineMatchScore":0.075},"totalScore":0.606},{"placeId":"ChIJE3ynH5G5AhUR2Y_ifHJwHpI","rating":4.2,"userRatingCount":51,"distanceMeters":null,"openNow":false,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.336,"reviewsScore":0.12,"distanceScore":0,"openBoostScore":0,"cuisineMatchScore":0.075},"totalScore":0.531}],"msg":"[RANKING] Score breakdown for top 10 results"}
{"level":"info","time":"2026-01-31T14:38:26.183Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"post_rank_applied","profile":"BALANCED","weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"resultCount":9,"hadUserLocation":false,"mode":"LLM_SCORE","orderSource":"ranking","reordered":true,"msg":"[RANKING] Results ranked deterministically"}
{"level":"info","time":"2026-01-31T14:38:26.185Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","status":"RUNNING","progress":90,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:38:26.186Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"assistant_language_resolved","assistantLanguage":"he","source":"uiLanguage","detectedLanguage":"other","languageConfidence":1,"confidenceThreshold":0.7,"uiLanguage":"he","msg":"[ASSISTANT] Language resolved for assistant message"}
{"level":"info","time":"2026-01-31T14:38:26.187Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","assistantType":"SUMMARY","sessionIdPresent":true,"event":"assistant_deferred_start","msg":"[ASSISTANT] Deferred generation started (non-blocking)"}
{"level":"info","time":"2026-01-31T14:38:26.188Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","stage":"assistant_llm","event":"assistant_llm_start","type":"SUMMARY","questionLanguage":"he","queryLen":22,"schemaVersion":"v3_strict_validation","promptVersion":"v2_language_enforcement","msg":"[ASSISTANT] Calling LLM"}
{"level":"info","time":"2026-01-31T14:38:26.189Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"pagination_meta","fetchedCount":9,"returnedCount":9,"clientVisibleCount":12,"clientNextIncrement":5,"serverPagination":false,"msg":"[ROUTE2] Pagination metadata (client-side)"}
{"level":"info","time":"2026-01-31T14:38:26.189Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"final_response_order","count":9,"first10":[{"idx":0,"placeId":"ChIJja5NDWC5AhURJtQIcOHI2hM","name":"Aberto"},{"idx":1,"placeId":"ChIJtfMizea7AhURHix3ZiSHtXc","name":"Otman Brothers Restaurant"},{"idx":2,"placeId":"ChIJ_S7mBQC7AhURwexf1P3Wrp8","name":"אוטוטו מסעדת סושי סניף גדרה"},{"idx":3,"placeId":"ChIJ9cu5nKK3AhURZbfGfRLIxdI","name":"רד סאן סושי & ווק - בילו סנטר red sun sushi"},{"idx":4,"placeId":"ChIJif-ayk27AhURHAx4Cif3RbY","name":"טרנקילו בעיר אסאי מדרום אמריקה Tranquilo"},{"idx":5,"placeId":"ChIJWSq2RdS_AhURdiCI341I8GM","name":"התאילנדית"},{"idx":6,"placeId":"ChIJ01avgGW5AhURK77L-yJpgrA","name":"Beit tamar Gedera"},{"idx":7,"placeId":"ChIJ59KxWOS7AhUR8GRmz82gAPY","name":"מיו סושי"},{"idx":8,"placeId":"ChIJE3ynH5G5AhUR2Y_ifHJwHpI","name":"אושי אושי גדרה"}],"orderSource":"ranking","reordered":true,"msg":"[ROUTE2] Final response order (ranked deterministically)"}
{"level":"info","time":"2026-01-31T14:38:26.191Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"order_weights_resolved","base":"balanced","weights":{"rating":25,"reviews":20,"price":15,"openNow":15,"distance":25},"reasonCodes":["BASE_BALANCED"],"ctx":{"method":"textsearch","hasUserLocation":false,"distanceIntent":false,"openNowRequested":false,"priceIntent":"any","qualityIntent":false,"occasion":null,"cuisineKey":"asian"},"normalizedSum":100,"msg":"[ORDER] Hybrid order weights resolved"}
{"level":"info","time":"2026-01-31T14:38:26.191Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"response_order_check","hasOrder":true,"orderProfile":"balanced","resultCount":9,"msg":"[ORDER] Response order metadata check before send"}
{"level":"info","time":"2026-01-31T14:38:26.249Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","hasResult":true,"msg":"[RedisJobStore] Result stored"}
{"level":"info","time":"2026-01-31T14:38:26.249Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","resultCount":9,"hasAssist":true,"event":"result_stored","msg":"[Observability] Search result stored successfully"}
{"level":"info","time":"2026-01-31T14:38:26.299Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","status":"DONE_SUCCESS","progress":100,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:38:26.299Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","status":"DONE_SUCCESS","progress":100,"event":"status_done","msg":"[Observability] Job reached terminal status"}
{"level":"info","time":"2026-01-31T14:38:27.110Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"ebb509ca-db9e-458f-8375-96205aac432c","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:38:27.112Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","event":"getResult_status","status":"DONE_SUCCESS","hasResult":true,"ageMs":18977,"updatedAgeMs":861,"progress":100,"isStale":false,"msg":"[HTTP] GET /result - status: DONE_SUCCESS, ageMs: 18977, updatedAgeMs: 861"}
{"level":"info","time":"2026-01-31T14:38:27.113Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","photoUrlsSanitized":true,"resultCount":9,"hasResult":true,"status":"DONE_SUCCESS","event":"getResult_returned","msg":"[Observability] GET /result returned successfully with results"}
{"level":"info","time":"2026-01-31T14:38:28.184Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"06af385f-3e8a-4e9a-b0dc-0ee665db7925","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1994,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:38:28.183Z","model":"gpt-4o-mini","tokensIn":921,"tokensOut":75,"totalTokens":996,"schemaName":"response","schemaStrict":true,"schemaHash":"4330761d782c","schemaVersion":"v1","promptVersion":"v2_language_enforcement","promptLength":2981,"estimatedCostUsd":0.00018314999999999998,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:38:28.186Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"assistant_llm","promptVersion":"v2_language_enforcement","schemaHash":"553fdda035a7","requestId":"req-1769870288126-1zv5nhiv6","traceId":"06af385f-3e8a-4e9a-b0dc-0ee665db7925","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3000,"timeoutHit":false,"buildPromptMs":0.09,"networkMs":1995.73,"parseMs":1.07,"totalMs":1997.06,"promptChars":2981,"inputTokens":921,"outputTokens":75,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:38:28.188Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","stage":"assistant_llm","event":"assistant_llm_success","type":"SUMMARY","questionLanguage":"he","suggestedAction":"NONE","blocksSearch":false,"durationMs":1998,"usage":{"prompt_tokens":921,"completion_tokens":75,"total_tokens":996},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"info","time":"2026-01-31T14:38:28.189Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","assistantType":"SUMMARY","durationMs":2002,"event":"assistant_deferred_done","msg":"[ASSISTANT] Deferred generation completed"}
{"level":"info","time":"2026-01-31T14:38:28.189Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","channel":"assistant","requestId":"req-1769870288126-1zv5nhiv6","sessionHash":"2c3b20d765e7","payloadType":"assistant","event":"assistant_ws_publish","msg":"[ASSISTANT] Publishing to WebSocket"}
{"level":"info","time":"2026-01-31T14:38:28.190Z","pid":12464,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769870288126-1zv5nhiv6","channel":"assistant","payloadType":"assistant","event":"assistant_published","assistantType":"SUMMARY","blocksSearch":false,"suggestedAction":"NONE","msg":"[ASSISTANT] Published to WebSocket"}
{"level":"warn","time":"2026-01-31T14:39:25.508Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:39:25.891Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:39:25.893Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:39:25.895Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:39:25.898Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:39:25.940Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:39:25.944Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":45,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:39:25.946Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:39:25.958Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:39:25.968Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:39:25.969Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:39:25.972Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:39:25.972Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:39:25.973Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:39:25.975Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"warn","time":"2026-01-31T14:39:25.614Z","pid":21316,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:39:26.014Z","pid":21316,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:39:26.016Z","pid":21316,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:39:26.018Z","pid":21316,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:39:26.024Z","pid":21316,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:39:26.081Z","pid":21316,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:39:26.085Z","pid":21316,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":60,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:39:26.131Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","traceId":"e6ebd0e3-d761-4d28-80fa-207fd6695d6c","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"3839d1bb1cf7","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:39:26.087Z","pid":21316,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:39:26.103Z","pid":21316,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:39:26.111Z","pid":21316,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:39:26.113Z","pid":21316,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:39:26.119Z","pid":21316,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:39:26.120Z","pid":21316,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:39:26.122Z","pid":21316,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:39:26.123Z","pid":21316,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:39:26.131Z","pid":21316,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:39:26.156Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870366155-4gjvrm","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:39:27.114Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","traceId":"d15ac26f-cfaa-401a-937a-0f4c56946689","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"b79c67c688a8","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:39:27.128Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870367127-c5iypg","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:39:27.135Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-01-31T14:39:27.137Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-01-31T14:39:27.138Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-01-31T14:39:27.138Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized with shared client"}
{"level":"info","time":"2026-01-31T14:39:27.148Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870367127-c5iypg","channel":"search","requestIdHash":"a8999deca186","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:39:27.150Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870367127-c5iypg","channel":"search","requestIdHash":"a8999deca186","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:39:27.151Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870367127-c5iypg","channel":"assistant","requestIdHash":"a8999deca186","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:39:27.152Z","pid":20596,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870367127-c5iypg","channel":"assistant","requestIdHash":"a8999deca186","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"warn","time":"2026-01-31T14:40:13.297Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:40:13.669Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:40:13.671Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:40:13.674Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:40:13.678Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:40:13.724Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:40:13.728Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":48,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:40:13.731Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:40:13.746Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:40:13.755Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:40:13.757Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:40:13.760Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:40:13.761Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"warn","time":"2026-01-31T14:40:13.346Z","pid":19508,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:40:13.763Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:40:13.765Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:40:13.728Z","pid":19508,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:40:13.731Z","pid":19508,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:40:13.733Z","pid":19508,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:40:13.737Z","pid":19508,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:40:13.795Z","pid":19508,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:40:13.799Z","pid":19508,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":60,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:40:13.803Z","pid":19508,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:40:13.819Z","pid":19508,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:40:13.827Z","pid":19508,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:40:13.828Z","pid":19508,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:40:13.831Z","pid":19508,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:40:13.833Z","pid":19508,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:40:13.834Z","pid":19508,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:40:13.835Z","pid":19508,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:40:13.844Z","pid":19508,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:40:13.941Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","traceId":"fccdfb89-5f4c-437d-abea-0a18c6ed7717","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"08dd0a64d221","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:40:13.974Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","traceId":"b261f41d-1b0b-41a6-b76e-86561d72b81a","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"a7d6b28174dc","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:40:13.987Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870413987-5qvcn6","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:40:13.996Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-01-31T14:40:14.007Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-01-31T14:40:14.008Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-01-31T14:40:14.008Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized with shared client"}
{"level":"info","time":"2026-01-31T14:40:14.018Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870413987-5qvcn6","channel":"search","requestIdHash":"a8999deca186","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:40:14.022Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870413987-5qvcn6","channel":"search","requestIdHash":"a8999deca186","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:40:14.025Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870413987-5qvcn6","channel":"assistant","requestIdHash":"a8999deca186","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:40:14.026Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870413987-5qvcn6","channel":"assistant","requestIdHash":"a8999deca186","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:40:14.039Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870414039-cicw4v","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:41:14.708Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870414039-cicw4v","code":1001,"reason":"none","wasClean":true,"msg":"websocket_disconnected"}
{"level":"info","time":"2026-01-31T14:41:15.235Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870413987-5qvcn6","code":1001,"reason":"none","wasClean":true,"msg":"websocket_disconnected"}
{"level":"info","time":"2026-01-31T14:41:15.393Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","traceId":"70b3769b-67a4-403e-97ba-1a739c932376","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"c445472a3783","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:41:15.417Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870475416-unkbr3","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:41:15.666Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","traceId":"97f49097-28a0-43e7-8f0c-3d562638530b","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"6dfc8d2db479","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:41:15.701Z","pid":10632,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870475701-k6x2by","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:41:40.093Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:41:40.472Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:41:40.474Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:41:40.476Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:41:40.480Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:41:40.530Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:41:40.533Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":52,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"warn","time":"2026-01-31T14:41:40.121Z","pid":13624,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:41:40.537Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:41:40.552Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:41:40.563Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:41:40.564Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:41:40.567Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:41:40.568Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:41:40.570Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:41:40.503Z","pid":13624,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:41:40.571Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:41:40.506Z","pid":13624,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:41:40.509Z","pid":13624,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:41:40.515Z","pid":13624,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:41:40.582Z","pid":13624,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:41:40.587Z","pid":13624,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":69,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:41:40.589Z","pid":13624,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:41:40.603Z","pid":13624,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:41:40.610Z","pid":13624,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:41:40.612Z","pid":13624,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:41:40.618Z","pid":13624,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:41:40.619Z","pid":13624,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:41:40.620Z","pid":13624,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:41:40.621Z","pid":13624,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:41:40.626Z","pid":13624,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:41:40.687Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","traceId":"4b2652a6-640f-4244-8387-0e793e8e38ec","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"7337495b3e0e","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:41:40.708Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","traceId":"ecb5e847-40b1-47e0-ba49-e18a2b8dea69","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"f5dd94abc32e","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:41:40.715Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870500715-oe2aqo","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:41:40.736Z","pid":17112,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870500736-ewersp","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:41:47.057Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:41:47.406Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:41:47.407Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:41:47.410Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:41:47.416Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"warn","time":"2026-01-31T14:41:47.075Z","pid":10456,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:41:47.417Z","pid":10456,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:41:47.419Z","pid":10456,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:41:47.420Z","pid":10456,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:41:47.425Z","pid":10456,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:41:47.457Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:41:47.460Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":42,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:41:47.462Z","pid":10456,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:41:47.464Z","pid":10456,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":36,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:41:47.462Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:41:47.470Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:41:47.465Z","pid":10456,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:41:47.496Z","pid":10456,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:41:47.502Z","pid":10456,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:41:47.502Z","pid":10456,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:41:47.504Z","pid":10456,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:41:47.505Z","pid":10456,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:41:47.506Z","pid":10456,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:41:47.507Z","pid":10456,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:41:47.511Z","pid":10456,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:41:47.477Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:41:47.477Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:41:47.479Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:41:47.480Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:41:47.481Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:41:47.482Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:41:47.543Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","traceId":"c0271de6-2673-4d43-9192-3f5cff594671","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"3d7facbb3e93","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:41:47.569Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870507569-qj0oe2","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:41:48.101Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","traceId":"04760605-0af3-4543-b6a6-3863d3189e8f","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"97686be4cd7f","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:41:48.108Z","pid":8784,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870508108-szt68d","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:42:18.405Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:42:18.799Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:42:18.801Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:42:18.802Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:42:18.805Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:42:18.848Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:42:18.852Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":45,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:42:18.855Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:42:18.872Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:42:18.884Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:42:18.885Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:42:18.887Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:42:18.888Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:42:18.889Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:42:18.890Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"warn","time":"2026-01-31T14:42:18.529Z","pid":22128,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:42:18.917Z","pid":22128,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:42:18.919Z","pid":22128,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:42:18.921Z","pid":22128,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:42:18.926Z","pid":22128,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:42:18.980Z","pid":22128,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:42:18.984Z","pid":22128,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":57,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:42:18.987Z","pid":22128,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:42:19.003Z","pid":22128,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:42:19.013Z","pid":22128,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:42:19.014Z","pid":22128,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:42:19.016Z","pid":22128,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:42:19.017Z","pid":22128,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:42:19.018Z","pid":22128,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:42:19.019Z","pid":22128,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:42:19.023Z","pid":22128,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:42:19.061Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","traceId":"e9c5b6a5-1d8b-405a-ab6e-51d7994469d2","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"43a53f5ed255","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:42:19.065Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","traceId":"90dbcb97-a92c-4863-afc4-8a8ee6c89891","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"dd2736a714a6","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:42:19.084Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870539083-h10sfw","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:42:19.108Z","pid":22008,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870539108-ca0cht","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:42:42.018Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:42:42.431Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:42:42.433Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:42:42.434Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:42:42.437Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:42:42.480Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:42:42.484Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":45,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:42:42.487Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:42:42.499Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:42:42.510Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:42:42.511Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:42:42.514Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:42:42.515Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:42:42.517Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:42:42.518Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"warn","time":"2026-01-31T14:42:42.105Z","pid":22512,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:42:42.484Z","pid":22512,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:42:42.486Z","pid":22512,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:42:42.489Z","pid":22512,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:42:42.494Z","pid":22512,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:42:42.548Z","pid":22512,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:42:42.551Z","pid":22512,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":56,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:42:42.554Z","pid":22512,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:42:42.571Z","pid":22512,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:42:42.582Z","pid":22512,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:42:42.584Z","pid":22512,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:42:42.600Z","pid":22512,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:42:42.602Z","pid":22512,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:42:42.603Z","pid":22512,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:42:42.606Z","pid":22512,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:42:42.617Z","pid":22512,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:42:43.166Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","traceId":"b2eee328-27e3-4ca8-9909-93bde3444be6","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"0110522bcd27","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:42:43.187Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870563186-ybfb4r","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:42:43.658Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","traceId":"9d30f004-b22f-4c0c-8963-1fa7617ec958","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"2dc19fe31397","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:42:43.710Z","pid":17620,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870563710-7q0yz3","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:42:54.355Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:42:54.653Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:42:54.655Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:42:54.657Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:42:54.661Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:42:54.698Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:42:54.702Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":40,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:42:54.704Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:42:54.714Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:42:54.720Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:42:54.721Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:42:54.723Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:42:54.724Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:42:54.725Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:42:54.726Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"warn","time":"2026-01-31T14:42:54.432Z","pid":17000,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:42:54.722Z","pid":17000,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:42:54.724Z","pid":17000,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:42:54.726Z","pid":17000,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:42:54.730Z","pid":17000,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:42:54.763Z","pid":17000,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:42:54.767Z","pid":17000,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":36,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:42:54.769Z","pid":17000,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:42:54.780Z","pid":17000,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:42:54.786Z","pid":17000,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:42:54.787Z","pid":17000,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:42:54.790Z","pid":17000,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:42:54.791Z","pid":17000,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:42:54.791Z","pid":17000,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:42:54.792Z","pid":17000,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:42:54.796Z","pid":17000,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:42:54.835Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","traceId":"5863b1d6-4054-477c-b739-3cca94859526","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"20354ab9623e","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:42:54.842Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","traceId":"24b5345e-3ca8-4b53-a60f-c0cf0e2f5ef2","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"151130861bab","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:42:54.857Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870574856-yhb3jb","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:42:54.870Z","pid":868,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870574870-kghmkz","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:43:12.072Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:43:12.598Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:43:12.602Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:43:12.607Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:43:12.614Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:43:12.725Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:43:12.731Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":115,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"warn","time":"2026-01-31T14:43:12.155Z","pid":22180,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:43:12.735Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:43:12.751Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:43:12.765Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:43:12.766Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:43:12.769Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:43:12.779Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:43:12.781Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:43:12.783Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:43:12.736Z","pid":22180,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:43:12.739Z","pid":22180,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:43:12.745Z","pid":22180,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:43:12.750Z","pid":22180,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:43:12.832Z","pid":22180,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:43:12.835Z","pid":22180,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":84,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:43:12.838Z","pid":22180,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:43:12.861Z","pid":22180,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:43:12.870Z","pid":22180,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:43:12.872Z","pid":22180,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:43:12.874Z","pid":22180,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:43:12.875Z","pid":22180,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:43:12.877Z","pid":22180,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:43:12.881Z","pid":22180,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:43:12.888Z","pid":22180,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:43:12.998Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","traceId":"683060c7-8600-49db-877d-7c738a3940c5","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"05eedc6cec6c","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:43:13.032Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870593031-2q6krb","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:43:13.098Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","traceId":"fbe590e5-4bab-4752-a0be-d989e1466395","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"466e860b8439","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:43:13.117Z","pid":20264,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870593117-mjpzoa","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:43:33.180Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:43:33.836Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:43:33.838Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:43:33.841Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:43:33.846Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:43:33.899Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:43:33.903Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":56,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:43:33.906Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:43:33.924Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"warn","time":"2026-01-31T14:43:33.309Z","pid":20016,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:43:33.939Z","pid":20016,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:43:33.941Z","pid":20016,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:43:33.943Z","pid":20016,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:43:33.961Z","pid":20016,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:43:34.019Z","pid":20016,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:43:34.024Z","pid":20016,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":59,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:43:33.933Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:43:33.934Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:43:34.028Z","pid":20016,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:43:34.048Z","pid":20016,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:43:34.055Z","pid":20016,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:43:34.056Z","pid":20016,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:43:34.060Z","pid":20016,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:43:34.062Z","pid":20016,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:43:34.063Z","pid":20016,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:43:34.064Z","pid":20016,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:43:34.069Z","pid":20016,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:43:33.939Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:43:33.940Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:43:33.942Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:43:33.944Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:43:34.066Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","traceId":"b55c40c0-8ed6-44b0-83a1-deb990742a73","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"fb6161360e42","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:43:34.073Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","traceId":"1b2e9648-0f1f-4971-9bad-ca6132202e05","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"644bd8e5a506","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:43:34.088Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870614088-bkohq8","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:43:34.114Z","pid":4672,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870614114-w0bb1a","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:43:48.153Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:43:48.577Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:43:48.579Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:43:48.581Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:43:48.599Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:43:48.657Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:43:48.661Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":59,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:43:48.664Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:43:48.686Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:43:48.697Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:43:48.698Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:43:48.701Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:43:48.702Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:43:48.705Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:43:48.709Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"warn","time":"2026-01-31T14:43:48.280Z","pid":9624,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:43:48.696Z","pid":9624,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:43:48.698Z","pid":9624,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:43:48.700Z","pid":9624,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:43:48.705Z","pid":9624,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:43:48.767Z","pid":9624,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:43:48.771Z","pid":9624,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":62,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:43:48.774Z","pid":9624,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:43:48.787Z","pid":9624,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:43:48.794Z","pid":9624,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:43:48.796Z","pid":9624,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:43:48.799Z","pid":9624,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:43:48.800Z","pid":9624,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:43:48.802Z","pid":9624,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:43:48.803Z","pid":9624,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:43:48.810Z","pid":9624,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:43:49.155Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","traceId":"8235920b-fbb8-44cb-8e2a-566795952fd0","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"aa3a665dce14","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:43:49.175Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870629175-uylz0t","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:43:49.316Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","traceId":"d8f89dc6-ae72-4d38-a5a3-d61edac2d185","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"27398b7731ba","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:43:49.326Z","pid":12672,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870629326-bqr922","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:44:01.809Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:44:02.331Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:44:02.333Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:44:02.337Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:44:02.343Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:44:02.393Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:44:02.396Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":51,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:44:02.398Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"warn","time":"2026-01-31T14:44:01.861Z","pid":20704,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:44:02.400Z","pid":20704,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:44:02.403Z","pid":20704,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:44:02.406Z","pid":20704,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:44:02.411Z","pid":20704,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:44:02.469Z","pid":20704,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:44:02.412Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:44:02.477Z","pid":20704,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":64,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:44:02.480Z","pid":20704,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:02.498Z","pid":20704,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:44:02.507Z","pid":20704,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:44:02.509Z","pid":20704,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:02.511Z","pid":20704,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:44:02.512Z","pid":20704,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:44:02.514Z","pid":20704,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:44:02.516Z","pid":20704,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:44:02.522Z","pid":20704,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:44:02.420Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:44:02.421Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:02.426Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:44:02.427Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:44:02.429Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:44:02.430Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:44:02.556Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","traceId":"66d7e88a-e9ae-4ea0-aa98-90105c13c838","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"871ea1c85037","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:44:02.560Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","traceId":"6c3bd7f1-4b00-4726-897c-895eaa1ea898","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"cdcf5c4b38a1","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:44:02.575Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870642575-4zx1fh","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:44:02.594Z","pid":1852,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870642594-sjwl9h","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:44:12.811Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:44:13.270Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:44:13.273Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:44:13.274Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:44:13.277Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:44:13.330Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:44:13.333Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":55,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:44:13.335Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:13.344Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:44:13.351Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:44:13.352Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:13.354Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:44:13.355Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:44:13.356Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:44:13.357Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"warn","time":"2026-01-31T14:44:12.811Z","pid":4076,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:44:13.340Z","pid":4076,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:44:13.342Z","pid":4076,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:44:13.343Z","pid":4076,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:44:13.347Z","pid":4076,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:44:13.380Z","pid":4076,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:44:13.382Z","pid":4076,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":34,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:44:13.384Z","pid":4076,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:13.397Z","pid":4076,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:44:13.403Z","pid":4076,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:44:13.404Z","pid":4076,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:13.406Z","pid":4076,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:44:13.406Z","pid":4076,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:44:13.407Z","pid":4076,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:44:13.408Z","pid":4076,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:44:13.413Z","pid":4076,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:44:13.645Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","traceId":"156aca9c-18ea-4c36-a760-d97f49436cd5","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"cf1f91697fbd","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:44:13.654Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","traceId":"bbf449dc-5e68-482d-9f09-aefa98cfabfc","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"972de8ca2d08","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:44:13.673Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870653672-rrj59p","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:44:13.693Z","pid":20004,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870653693-pnkzw9","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:44:27.709Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:44:27.911Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:44:27.912Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:44:27.913Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:44:27.915Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:44:27.940Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:44:27.942Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":27,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"warn","time":"2026-01-31T14:44:27.736Z","pid":21644,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:44:27.943Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:27.950Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:44:27.957Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:44:27.958Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:27.959Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:44:27.960Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:44:27.936Z","pid":21644,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:44:27.961Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:44:27.962Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:44:27.938Z","pid":21644,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:44:27.939Z","pid":21644,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:44:27.942Z","pid":21644,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:44:27.970Z","pid":21644,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:44:27.972Z","pid":21644,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":29,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:44:27.973Z","pid":21644,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:27.981Z","pid":21644,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:44:27.985Z","pid":21644,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:44:27.986Z","pid":21644,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:27.988Z","pid":21644,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:44:27.988Z","pid":21644,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:44:27.989Z","pid":21644,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:44:27.989Z","pid":21644,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:44:27.992Z","pid":21644,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:44:28.142Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","traceId":"20af8595-754d-475e-a3be-d1e254a68bd0","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"7f9ecacebc3d","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:44:28.145Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","traceId":"8ac2abd4-a777-4480-9926-cb8994c056ef","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"6ab38b54d05b","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:44:28.153Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870668153-9km5go","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:44:28.168Z","pid":11132,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870668168-iu39n0","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:44:36.021Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:44:36.240Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:44:36.241Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:44:36.242Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:44:36.243Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:44:36.271Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:44:36.273Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":29,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:44:36.275Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:36.283Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:44:36.289Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"warn","time":"2026-01-31T14:44:36.078Z","pid":21376,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:44:36.300Z","pid":21376,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:44:36.301Z","pid":21376,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:44:36.302Z","pid":21376,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:44:36.317Z","pid":21376,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:44:36.290Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:36.349Z","pid":21376,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:44:36.352Z","pid":21376,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":34,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:44:36.291Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:44:36.292Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:44:36.292Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:44:36.293Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:44:36.355Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","traceId":"7bb89661-19cd-44c8-bd34-314626b3c0c4","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"e32ce3e38777","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:44:36.359Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","traceId":"cab5d7ea-c42c-4cdf-8f4a-7e17a0d8a4c4","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"b53daf4431e3","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:44:36.370Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870676369-krg07s","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:44:36.353Z","pid":21376,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:36.363Z","pid":21376,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:44:36.368Z","pid":21376,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:44:36.369Z","pid":21376,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:36.371Z","pid":21376,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:44:36.372Z","pid":21376,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:44:36.372Z","pid":21376,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:44:36.373Z","pid":21376,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:44:36.377Z","pid":21376,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:44:36.390Z","pid":1996,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870676390-4r0zpf","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:44:42.703Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:44:43.008Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:44:43.009Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"warn","time":"2026-01-31T14:44:42.703Z","pid":14144,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:44:43.011Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:44:43.016Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:44:43.012Z","pid":14144,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:44:43.013Z","pid":14144,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:44:43.015Z","pid":14144,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:44:43.019Z","pid":14144,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:44:43.064Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:44:43.069Z","pid":14144,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:44:43.069Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":50,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:44:43.072Z","pid":14144,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":51,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:44:43.071Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:43.084Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:44:43.093Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:44:43.094Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:43.095Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:44:43.096Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:44:43.097Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:44:43.098Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:44:43.074Z","pid":14144,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:43.086Z","pid":14144,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:44:43.092Z","pid":14144,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:44:43.093Z","pid":14144,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:43.095Z","pid":14144,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:44:43.096Z","pid":14144,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:44:43.096Z","pid":14144,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:44:43.097Z","pid":14144,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:44:43.102Z","pid":14144,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:44:43.189Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","traceId":"c5f953d4-a782-494c-a8b3-38ed8c2a3477","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"9e1befa0b5b0","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:44:43.207Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","traceId":"090e135b-8beb-4748-b900-fbc52df6f68a","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"08e2aabc1932","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:44:43.214Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870683214-92rrh3","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:44:43.231Z","pid":19392,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870683231-w7zczg","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:44:52.928Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:44:53.660Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:44:53.662Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:44:53.664Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:44:53.669Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:44:53.725Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:44:53.729Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":58,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:44:53.732Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:53.748Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:44:53.758Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:44:53.759Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:53.762Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:44:53.763Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:44:53.764Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:44:53.766Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"warn","time":"2026-01-31T14:44:53.128Z","pid":10440,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:44:53.769Z","pid":10440,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:44:53.771Z","pid":10440,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:44:53.772Z","pid":10440,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:44:53.777Z","pid":10440,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:44:53.853Z","pid":10440,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:44:53.858Z","pid":10440,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":80,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:44:53.885Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","traceId":"364488af-f325-42e6-b36f-af51d1d90de7","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"4dabe778a6f3","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:44:53.910Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870693909-3snxu9","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:44:53.861Z","pid":10440,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:53.882Z","pid":10440,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:44:53.893Z","pid":10440,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:44:53.894Z","pid":10440,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:44:53.899Z","pid":10440,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:44:53.900Z","pid":10440,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:44:53.901Z","pid":10440,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:44:53.903Z","pid":10440,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:44:53.910Z","pid":10440,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:44:54.095Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","traceId":"7c98907a-87dd-4865-94ab-407e42e6f3eb","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"f138abb8fdbf","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:44:54.107Z","pid":9456,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870694107-wocqq6","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:45:23.197Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-boost-1","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":20,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:45:23.211Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-boost-1","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":2,"preferredTermsCount":2,"placesCount":20,"promptChars":1801,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:45:23.215Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-boost-1","event":"cuisine_scores_top10","scores":[{"placeId":"place_Asian_1","placeName":"Asian 1","score":0.9},{"placeId":"place_Asian_2","placeName":"Asian 2","score":0.88},{"placeId":"place_Asian_3","placeName":"Asian 3","score":0.86},{"placeId":"place_Asian_4","placeName":"Asian 4","score":0.8400000000000001},{"placeId":"place_Asian_5","placeName":"Asian 5","score":0.8200000000000001},{"placeId":"place_Asian_6","placeName":"Asian 6","score":0.8},{"placeId":"place_Asian_7","placeName":"Asian 7","score":0.78},{"placeId":"place_Asian_8","placeName":"Asian 8","score":0.76},{"placeId":"place_Asian_9","placeName":"Asian 9","score":0.74},{"placeId":"place_Asian_10","placeName":"Asian 10","score":0.72}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:45:23.217Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-boost-1","event":"cuisine_enforcement_llm_success","countIn":20,"countOut":20,"hasScores":true,"scoresCount":20,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:45:23.221Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-boost-2","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":18,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:45:23.222Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-boost-2","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":2,"preferredTermsCount":0,"placesCount":18,"promptChars":1597,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:45:23.223Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-boost-2","event":"cuisine_scores_top10","scores":[{"placeId":"place_Meat_1","placeName":"Meat 1","score":0.85},{"placeId":"place_Meat_2","placeName":"Meat 2","score":0.82},{"placeId":"place_Meat_3","placeName":"Meat 3","score":0.79},{"placeId":"place_Meat_4","placeName":"Meat 4","score":0.76},{"placeId":"place_Meat_5","placeName":"Meat 5","score":0.73},{"placeId":"place_Meat_6","placeName":"Meat 6","score":0.7},{"placeId":"place_Meat_7","placeName":"Meat 7","score":0.6699999999999999},{"placeId":"place_Meat_8","placeName":"Meat 8","score":0.64},{"placeId":"place_Meat_9","placeName":"Meat 9","score":0.61},{"placeId":"place_Meat_10","placeName":"Meat 10","score":0.58}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:45:23.224Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-boost-2","event":"cuisine_enforcement_llm_success","countIn":18,"countOut":18,"hasScores":true,"scoresCount":18,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:45:23.226Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-fast-path","event":"cuisine_enforcer_fast_path","countIn":3,"msg":"[CUISINE_ENFORCER] Small result set, skipping LLM"}
{"level":"info","time":"2026-01-31T14:45:23.227Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-llm-path","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":4,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:45:23.228Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-llm-path","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":4,"promptChars":609,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:45:23.229Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-llm-path","event":"cuisine_scores_top10","scores":[{"placeId":"place_Italian_1","placeName":"Italian 1","score":0.8},{"placeId":"place_Italian_2","placeName":"Italian 2","score":0.7000000000000001},{"placeId":"place_Italian_3","placeName":"Italian 3","score":0.6000000000000001},{"placeId":"place_Italian_4","placeName":"Italian 4","score":0.5}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:45:23.230Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-llm-path","event":"cuisine_enforcement_llm_success","countIn":4,"countOut":4,"hasScores":true,"scoresCount":4,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:45:23.232Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-city-1","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":20,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:45:23.232Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-city-1","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":20,"promptChars":1858,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:45:23.233Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-city-1","event":"cuisine_scores_top10","scores":[{"placeId":"place_TelAviv_1","placeName":"TelAviv 1","score":0.7},{"placeId":"place_TelAviv_2","placeName":"TelAviv 2","score":0.69},{"placeId":"place_TelAviv_3","placeName":"TelAviv 3","score":0.6799999999999999},{"placeId":"place_TelAviv_4","placeName":"TelAviv 4","score":0.6699999999999999},{"placeId":"place_TelAviv_5","placeName":"TelAviv 5","score":0.6599999999999999},{"placeId":"place_TelAviv_6","placeName":"TelAviv 6","score":0.6499999999999999},{"placeId":"place_TelAviv_7","placeName":"TelAviv 7","score":0.6399999999999999},{"placeId":"place_TelAviv_8","placeName":"TelAviv 8","score":0.6299999999999999},{"placeId":"place_TelAviv_9","placeName":"TelAviv 9","score":0.62},{"placeId":"place_TelAviv_10","placeName":"TelAviv 10","score":0.61}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:45:23.233Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-city-1","event":"cuisine_enforcement_llm_success","countIn":20,"countOut":20,"hasScores":true,"scoresCount":20,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:45:23.235Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-low-scores","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":15,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:45:23.235Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-low-scores","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":15,"promptChars":1403,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:45:23.235Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-low-scores","event":"cuisine_scores_top10","scores":[{"placeId":"place_Mixed_1","placeName":"Mixed 1","score":0.8},{"placeId":"place_Mixed_2","placeName":"Mixed 2","score":0.8},{"placeId":"place_Mixed_3","placeName":"Mixed 3","score":0.8},{"placeId":"place_Mixed_4","placeName":"Mixed 4","score":0.2},{"placeId":"place_Mixed_5","placeName":"Mixed 5","score":0.2},{"placeId":"place_Mixed_6","placeName":"Mixed 6","score":0.2},{"placeId":"place_Mixed_7","placeName":"Mixed 7","score":0.2},{"placeId":"place_Mixed_8","placeName":"Mixed 8","score":0.2},{"placeId":"place_Mixed_9","placeName":"Mixed 9","score":0.2},{"placeId":"place_Mixed_10","placeName":"Mixed 10","score":0.2}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:45:23.236Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-low-scores","event":"cuisine_enforcement_llm_success","countIn":15,"countOut":15,"hasScores":true,"scoresCount":15,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:45:23.237Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-always-boost","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":20,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:45:23.238Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-always-boost","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":20,"promptChars":1858,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:45:23.239Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-always-boost","event":"cuisine_scores_top10","scores":[{"placeId":"place_Italian_1","placeName":"Italian 1","score":0.8},{"placeId":"place_Italian_2","placeName":"Italian 2","score":0.78},{"placeId":"place_Italian_3","placeName":"Italian 3","score":0.76},{"placeId":"place_Italian_4","placeName":"Italian 4","score":0.74},{"placeId":"place_Italian_5","placeName":"Italian 5","score":0.7200000000000001},{"placeId":"place_Italian_6","placeName":"Italian 6","score":0.7000000000000001},{"placeId":"place_Italian_7","placeName":"Italian 7","score":0.68},{"placeId":"place_Italian_8","placeName":"Italian 8","score":0.66},{"placeId":"place_Italian_9","placeName":"Italian 9","score":0.64},{"placeId":"place_Italian_10","placeName":"Italian 10","score":0.6200000000000001}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:45:23.239Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-always-boost","event":"cuisine_enforcement_llm_success","countIn":20,"countOut":20,"hasScores":true,"scoresCount":20,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:45:23.240Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-always-all","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":18,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:45:23.241Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-always-all","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":18,"promptChars":1628,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:45:23.241Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-always-all","event":"cuisine_scores_top10","scores":[{"placeId":"place_Asian_1","placeName":"Asian 1","score":0.75},{"placeId":"place_Asian_2","placeName":"Asian 2","score":0.75},{"placeId":"place_Asian_3","placeName":"Asian 3","score":0.75},{"placeId":"place_Asian_4","placeName":"Asian 4","score":0.75},{"placeId":"place_Asian_5","placeName":"Asian 5","score":0.75},{"placeId":"place_Asian_6","placeName":"Asian 6","score":0.75},{"placeId":"place_Asian_7","placeName":"Asian 7","score":0.75},{"placeId":"place_Asian_8","placeName":"Asian 8","score":0.75},{"placeId":"place_Asian_9","placeName":"Asian 9","score":0.75},{"placeId":"place_Asian_10","placeName":"Asian 10","score":0.75}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:45:23.241Z","pid":9392,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-req-always-all","event":"cuisine_enforcement_llm_success","countIn":18,"countOut":18,"hasScores":true,"scoresCount":18,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"warn","time":"2026-01-31T14:45:42.736Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:45:43.127Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:45:43.129Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:45:43.130Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:45:43.132Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:45:43.164Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:45:43.167Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":34,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"warn","time":"2026-01-31T14:45:42.775Z","pid":14084,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:45:43.156Z","pid":14084,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:45:43.157Z","pid":14084,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:45:43.159Z","pid":14084,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:45:43.162Z","pid":14084,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:45:43.168Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:45:43.198Z","pid":14084,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:45:43.179Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:45:43.189Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:45:43.190Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:45:43.193Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:45:43.194Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:45:43.195Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:45:43.195Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:45:43.201Z","pid":14084,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":38,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:45:43.203Z","pid":14084,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:45:43.217Z","pid":14084,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:45:43.225Z","pid":14084,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:45:43.226Z","pid":14084,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:45:43.229Z","pid":14084,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:45:43.231Z","pid":14084,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:45:43.232Z","pid":14084,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:45:43.233Z","pid":14084,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:45:43.239Z","pid":14084,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:45:43.458Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","traceId":"96a1df51-2387-4949-8abb-3f9200e48598","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"36ad73362486","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:45:43.472Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870743472-gv6hs9","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:45:43.653Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","traceId":"bdd0a296-6ac9-4995-95e3-9a74dbb7456e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"df769e0e01a6","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:45:43.664Z","pid":20900,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870743664-cqn9ix","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:46:04.152Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:46:05.343Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:46:05.346Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:46:05.347Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:46:05.351Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:46:05.444Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:46:05.450Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":98,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:46:05.454Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:46:05.469Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:46:05.494Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:46:05.499Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:46:05.508Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:46:05.514Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:46:05.516Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:46:05.518Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:46:05.764Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","traceId":"b3b841db-1ae4-408f-9ca3-720be6b93af3","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"4719657cfd07","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:46:05.786Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","traceId":"486b8d29-0fd3-4912-829d-dea3752ea5fb","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"255e28d78bd6","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:46:05.795Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870765795-btvwyr","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:46:05.817Z","pid":18652,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870765817-wnwq6s","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:46:05.748Z","pid":19940,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:46:06.207Z","pid":19940,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:46:06.209Z","pid":19940,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:46:06.210Z","pid":19940,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:46:06.217Z","pid":19940,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:46:06.283Z","pid":19940,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:46:06.288Z","pid":19940,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":69,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:46:06.291Z","pid":19940,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:46:06.305Z","pid":19940,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:46:06.312Z","pid":19940,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:46:06.313Z","pid":19940,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:46:06.315Z","pid":19940,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:46:06.316Z","pid":19940,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:46:06.317Z","pid":19940,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:46:06.318Z","pid":19940,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:46:06.322Z","pid":19940,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"warn","time":"2026-01-31T14:47:32.957Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:47:33.295Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:47:33.297Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:47:33.300Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:47:33.304Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:47:33.345Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:47:33.348Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":42,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"warn","time":"2026-01-31T14:47:33.050Z","pid":20656,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:47:33.336Z","pid":20656,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:47:33.350Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:47:33.338Z","pid":20656,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:47:33.363Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:47:33.340Z","pid":20656,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:47:33.373Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:47:33.343Z","pid":20656,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:47:33.374Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:47:33.378Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:47:33.379Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:47:33.380Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:47:33.382Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:47:33.392Z","pid":20656,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:47:33.397Z","pid":20656,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":53,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:47:33.399Z","pid":20656,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:47:33.409Z","pid":20656,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:47:33.416Z","pid":20656,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:47:33.417Z","pid":20656,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:47:33.420Z","pid":20656,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:47:33.421Z","pid":20656,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:47:33.422Z","pid":20656,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:47:33.424Z","pid":20656,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:47:33.429Z","pid":20656,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:47:33.478Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","traceId":"fb5147d9-7475-43f2-bdd9-7fe54259ae0d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"2bed2cf0ff6f","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:47:33.482Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","traceId":"63423edc-d115-42e2-8979-bcd48d513c63","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"75127a2f7582","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:47:33.497Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870853497-ohm8o9","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:47:33.523Z","pid":22044,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870853523-pgmoro","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:47:40.198Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-asian-generic","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":20,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:47:40.208Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-asian-generic","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":2,"preferredTermsCount":3,"placesCount":20,"promptChars":1688,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:47:40.210Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-asian-generic","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Asian 1","score":0.85},{"placeId":"place_2","placeName":"Asian 2","score":0.83},{"placeId":"place_3","placeName":"Asian 3","score":0.8099999999999999},{"placeId":"place_4","placeName":"Asian 4","score":0.79},{"placeId":"place_5","placeName":"Asian 5","score":0.77},{"placeId":"place_6","placeName":"Asian 6","score":0.75},{"placeId":"place_7","placeName":"Asian 7","score":0.73},{"placeId":"place_8","placeName":"Asian 8","score":0.71},{"placeId":"place_9","placeName":"Asian 9","score":0.69},{"placeId":"place_10","placeName":"Asian 10","score":0.6699999999999999}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:47:40.211Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-asian-generic","event":"cuisine_enforcement_llm_success","countIn":20,"countOut":20,"hasScores":true,"scoresCount":20,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:47:40.213Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-always-boost","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":20,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:47:40.214Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-always-boost","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":20,"promptChars":1658,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:47:40.214Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-always-boost","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Asian 1","score":0.9},{"placeId":"place_2","placeName":"Asian 2","score":0.87},{"placeId":"place_3","placeName":"Asian 3","score":0.8400000000000001},{"placeId":"place_4","placeName":"Asian 4","score":0.81},{"placeId":"place_5","placeName":"Asian 5","score":0.78},{"placeId":"place_6","placeName":"Asian 6","score":0.75},{"placeId":"place_7","placeName":"Asian 7","score":0.72},{"placeId":"place_8","placeName":"Asian 8","score":0.6900000000000001},{"placeId":"place_9","placeName":"Asian 9","score":0.66},{"placeId":"place_10","placeName":"Asian 10","score":0.63}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:47:40.215Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-always-boost","event":"cuisine_enforcement_llm_success","countIn":20,"countOut":20,"hasScores":true,"scoresCount":20,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:47:40.216Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-meat-ashkelon","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":18,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:47:40.217Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-meat-ashkelon","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":2,"preferredTermsCount":0,"placesCount":18,"promptChars":1506,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:47:40.218Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-meat-ashkelon","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Meat 1","score":0.9},{"placeId":"place_2","placeName":"Meat 2","score":0.87},{"placeId":"place_3","placeName":"Meat 3","score":0.8400000000000001},{"placeId":"place_4","placeName":"Meat 4","score":0.81},{"placeId":"place_5","placeName":"Meat 5","score":0.78},{"placeId":"place_6","placeName":"Meat 6","score":0.75},{"placeId":"place_7","placeName":"Meat 7","score":0.72},{"placeId":"place_8","placeName":"Meat 8","score":0.6900000000000001},{"placeId":"place_9","placeName":"Meat 9","score":0.66},{"placeId":"place_10","placeName":"Meat 10","score":0.63}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:47:40.218Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-meat-ashkelon","event":"cuisine_enforcement_llm_success","countIn":18,"countOut":18,"hasScores":true,"scoresCount":18,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:47:40.220Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-dairy-kosher-pt","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":16,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:47:40.221Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-dairy-kosher-pt","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":2,"preferredTermsCount":0,"placesCount":16,"promptChars":1387,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:47:40.221Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-dairy-kosher-pt","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Dairy 1","score":0.88},{"placeId":"place_2","placeName":"Dairy 2","score":0.855},{"placeId":"place_3","placeName":"Dairy 3","score":0.83},{"placeId":"place_4","placeName":"Dairy 4","score":0.8049999999999999},{"placeId":"place_5","placeName":"Dairy 5","score":0.78},{"placeId":"place_6","placeName":"Dairy 6","score":0.755},{"placeId":"place_7","placeName":"Dairy 7","score":0.73},{"placeId":"place_8","placeName":"Dairy 8","score":0.705},{"placeId":"place_9","placeName":"Dairy 9","score":0.6799999999999999},{"placeId":"place_10","placeName":"Dairy 10","score":0.655}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:47:40.222Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-dairy-kosher-pt","event":"cuisine_enforcement_llm_success","countIn":16,"countOut":16,"hasScores":true,"scoresCount":16,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:47:40.237Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-drop-tracking","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":20,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:47:40.238Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-drop-tracking","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":20,"promptChars":1758,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:47:40.239Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-drop-tracking","event":"cuisine_enforcement_llm_success","countIn":20,"countOut":15,"hasScores":false,"scoresCount":0,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:47:40.248Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-drop-boost","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":20,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:47:40.248Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-drop-boost","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":20,"promptChars":1658,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:47:40.249Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-drop-boost","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Asian 1","score":0.7},{"placeId":"place_2","placeName":"Asian 2","score":0.69},{"placeId":"place_3","placeName":"Asian 3","score":0.6799999999999999},{"placeId":"place_4","placeName":"Asian 4","score":0.6699999999999999},{"placeId":"place_5","placeName":"Asian 5","score":0.6599999999999999},{"placeId":"place_6","placeName":"Asian 6","score":0.6499999999999999},{"placeId":"place_7","placeName":"Asian 7","score":0.6399999999999999},{"placeId":"place_8","placeName":"Asian 8","score":0.6299999999999999},{"placeId":"place_9","placeName":"Asian 9","score":0.62},{"placeId":"place_10","placeName":"Asian 10","score":0.61}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:47:40.249Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-drop-boost","event":"cuisine_enforcement_llm_success","countIn":20,"countOut":20,"hasScores":true,"scoresCount":20,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:47:40.251Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-kosher-active","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":20,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:47:40.251Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-kosher-active","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":20,"promptChars":1698,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:47:40.252Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-kosher-active","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Italian 1","score":0.8},{"placeId":"place_2","placeName":"Italian 2","score":0.8},{"placeId":"place_3","placeName":"Italian 3","score":0.8},{"placeId":"place_4","placeName":"Italian 4","score":0.8},{"placeId":"place_5","placeName":"Italian 5","score":0.8},{"placeId":"place_6","placeName":"Italian 6","score":0.8},{"placeId":"place_7","placeName":"Italian 7","score":0.8},{"placeId":"place_8","placeName":"Italian 8","score":0.8},{"placeId":"place_9","placeName":"Italian 9","score":0.8},{"placeId":"place_10","placeName":"Italian 10","score":0.8}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:47:40.252Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-kosher-active","event":"cuisine_enforcement_llm_success","countIn":20,"countOut":20,"hasScores":true,"scoresCount":20,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:47:40.253Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-meat-cuisine","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":18,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:47:40.254Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-meat-cuisine","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":18,"promptChars":1608,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:47:40.254Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-meat-cuisine","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Steakhouse 1","score":0.9},{"placeId":"place_2","placeName":"Steakhouse 2","score":0.9},{"placeId":"place_3","placeName":"Steakhouse 3","score":0.9},{"placeId":"place_4","placeName":"Steakhouse 4","score":0.9},{"placeId":"place_5","placeName":"Steakhouse 5","score":0.9},{"placeId":"place_6","placeName":"Steakhouse 6","score":0.9},{"placeId":"place_7","placeName":"Steakhouse 7","score":0.9},{"placeId":"place_8","placeName":"Steakhouse 8","score":0.9},{"placeId":"place_9","placeName":"Steakhouse 9","score":0.9},{"placeId":"place_10","placeName":"Steakhouse 10","score":0.9}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:47:40.255Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-meat-cuisine","event":"cuisine_enforcement_llm_success","countIn":18,"countOut":18,"hasScores":true,"scoresCount":18,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:47:40.257Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-dairy-cuisine","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":15,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:47:40.257Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-dairy-cuisine","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":15,"promptChars":1310,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:47:40.258Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-dairy-cuisine","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Dairy 1","score":0.85},{"placeId":"place_2","placeName":"Dairy 2","score":0.85},{"placeId":"place_3","placeName":"Dairy 3","score":0.85},{"placeId":"place_4","placeName":"Dairy 4","score":0.85},{"placeId":"place_5","placeName":"Dairy 5","score":0.85},{"placeId":"place_6","placeName":"Dairy 6","score":0.85},{"placeId":"place_7","placeName":"Dairy 7","score":0.85},{"placeId":"place_8","placeName":"Dairy 8","score":0.85},{"placeId":"place_9","placeName":"Dairy 9","score":0.85},{"placeId":"place_10","placeName":"Dairy 10","score":0.85}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:47:40.258Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-dairy-cuisine","event":"cuisine_enforcement_llm_success","countIn":15,"countOut":15,"hasScores":true,"scoresCount":15,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:47:40.259Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-preserve-12","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":22,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:47:40.259Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-preserve-12","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":22,"promptChars":1839,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:47:40.259Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-preserve-12","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Generic 1","score":0.7},{"placeId":"place_2","placeName":"Generic 2","score":0.69},{"placeId":"place_3","placeName":"Generic 3","score":0.6799999999999999},{"placeId":"place_4","placeName":"Generic 4","score":0.6699999999999999},{"placeId":"place_5","placeName":"Generic 5","score":0.6599999999999999},{"placeId":"place_6","placeName":"Generic 6","score":0.6499999999999999},{"placeId":"place_7","placeName":"Generic 7","score":0.6399999999999999},{"placeId":"place_8","placeName":"Generic 8","score":0.6299999999999999},{"placeId":"place_9","placeName":"Generic 9","score":0.62},{"placeId":"place_10","placeName":"Generic 10","score":0.61}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:47:40.260Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-preserve-12","event":"cuisine_enforcement_llm_success","countIn":22,"countOut":22,"hasScores":true,"scoresCount":22,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:47:40.260Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-aggressive","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":20,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:47:40.261Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-aggressive","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":20,"promptChars":1658,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:47:40.261Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-aggressive","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Asian 1","score":0.75},{"placeId":"place_2","placeName":"Asian 2","score":0.75},{"placeId":"place_3","placeName":"Asian 3","score":0.75},{"placeId":"place_4","placeName":"Asian 4","score":0.75},{"placeId":"place_5","placeName":"Asian 5","score":0.75},{"placeId":"place_6","placeName":"Asian 6","score":0.75},{"placeId":"place_7","placeName":"Asian 7","score":0.75},{"placeId":"place_8","placeName":"Asian 8","score":0.75},{"placeId":"place_9","placeName":"Asian 9","score":0.75},{"placeId":"place_10","placeName":"Asian 10","score":0.75}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:47:40.261Z","pid":19124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-aggressive","event":"cuisine_enforcement_llm_success","countIn":20,"countOut":20,"hasScores":true,"scoresCount":20,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"warn","time":"2026-01-31T14:48:00.966Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:48:01.320Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:48:01.323Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:48:01.324Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:48:01.327Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"warn","time":"2026-01-31T14:48:00.985Z","pid":20048,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:48:01.369Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:48:01.332Z","pid":20048,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:48:01.333Z","pid":20048,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:48:01.334Z","pid":20048,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:48:01.372Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":44,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:48:01.336Z","pid":20048,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:48:01.379Z","pid":20048,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:48:01.381Z","pid":20048,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":44,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:48:01.375Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:48:01.387Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:48:01.395Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:48:01.396Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:48:01.398Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:48:01.399Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:48:01.399Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:48:01.400Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:48:01.383Z","pid":20048,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:48:01.393Z","pid":20048,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:48:01.398Z","pid":20048,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:48:01.398Z","pid":20048,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:48:01.400Z","pid":20048,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:48:01.401Z","pid":20048,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:48:01.402Z","pid":20048,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:48:01.403Z","pid":20048,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:48:01.411Z","pid":20048,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:48:01.474Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","traceId":"72f942ed-4edb-4e19-a0f1-7b3b1e99e54e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"b79418367890","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:48:01.495Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","traceId":"122ae14b-1d04-41b5-b99c-788076c53662","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"0b5c0a8f915b","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:48:01.502Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870881502-x75hh7","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:48:01.518Z","pid":21072,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769870881518-g3md67","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:48:07.921Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-asian-generic","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":20,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:48:07.930Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-asian-generic","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":2,"preferredTermsCount":3,"placesCount":20,"promptChars":1688,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:48:07.933Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-asian-generic","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Asian 1","score":0.85},{"placeId":"place_2","placeName":"Asian 2","score":0.83},{"placeId":"place_3","placeName":"Asian 3","score":0.8099999999999999},{"placeId":"place_4","placeName":"Asian 4","score":0.79},{"placeId":"place_5","placeName":"Asian 5","score":0.77},{"placeId":"place_6","placeName":"Asian 6","score":0.75},{"placeId":"place_7","placeName":"Asian 7","score":0.73},{"placeId":"place_8","placeName":"Asian 8","score":0.71},{"placeId":"place_9","placeName":"Asian 9","score":0.69},{"placeId":"place_10","placeName":"Asian 10","score":0.6699999999999999}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:48:07.934Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-asian-generic","event":"cuisine_enforcement_llm_success","countIn":20,"countOut":20,"hasScores":true,"scoresCount":20,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:48:07.936Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-always-boost","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":20,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:48:07.937Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-always-boost","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":20,"promptChars":1658,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:48:07.938Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-always-boost","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Asian 1","score":0.9},{"placeId":"place_2","placeName":"Asian 2","score":0.87},{"placeId":"place_3","placeName":"Asian 3","score":0.8400000000000001},{"placeId":"place_4","placeName":"Asian 4","score":0.81},{"placeId":"place_5","placeName":"Asian 5","score":0.78},{"placeId":"place_6","placeName":"Asian 6","score":0.75},{"placeId":"place_7","placeName":"Asian 7","score":0.72},{"placeId":"place_8","placeName":"Asian 8","score":0.6900000000000001},{"placeId":"place_9","placeName":"Asian 9","score":0.66},{"placeId":"place_10","placeName":"Asian 10","score":0.63}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:48:07.939Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-always-boost","event":"cuisine_enforcement_llm_success","countIn":20,"countOut":20,"hasScores":true,"scoresCount":20,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:48:07.940Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-meat-ashkelon","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":18,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:48:07.941Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-meat-ashkelon","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":2,"preferredTermsCount":0,"placesCount":18,"promptChars":1506,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:48:07.942Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-meat-ashkelon","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Meat 1","score":0.9},{"placeId":"place_2","placeName":"Meat 2","score":0.87},{"placeId":"place_3","placeName":"Meat 3","score":0.8400000000000001},{"placeId":"place_4","placeName":"Meat 4","score":0.81},{"placeId":"place_5","placeName":"Meat 5","score":0.78},{"placeId":"place_6","placeName":"Meat 6","score":0.75},{"placeId":"place_7","placeName":"Meat 7","score":0.72},{"placeId":"place_8","placeName":"Meat 8","score":0.6900000000000001},{"placeId":"place_9","placeName":"Meat 9","score":0.66},{"placeId":"place_10","placeName":"Meat 10","score":0.63}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:48:07.942Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-meat-ashkelon","event":"cuisine_enforcement_llm_success","countIn":18,"countOut":18,"hasScores":true,"scoresCount":18,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:48:07.944Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-dairy-kosher-pt","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":16,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:48:07.945Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-dairy-kosher-pt","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":2,"preferredTermsCount":0,"placesCount":16,"promptChars":1387,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:48:07.945Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-dairy-kosher-pt","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Dairy 1","score":0.88},{"placeId":"place_2","placeName":"Dairy 2","score":0.855},{"placeId":"place_3","placeName":"Dairy 3","score":0.83},{"placeId":"place_4","placeName":"Dairy 4","score":0.8049999999999999},{"placeId":"place_5","placeName":"Dairy 5","score":0.78},{"placeId":"place_6","placeName":"Dairy 6","score":0.755},{"placeId":"place_7","placeName":"Dairy 7","score":0.73},{"placeId":"place_8","placeName":"Dairy 8","score":0.705},{"placeId":"place_9","placeName":"Dairy 9","score":0.6799999999999999},{"placeId":"place_10","placeName":"Dairy 10","score":0.655}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:48:07.946Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-dairy-kosher-pt","event":"cuisine_enforcement_llm_success","countIn":16,"countOut":16,"hasScores":true,"scoresCount":16,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:48:07.948Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-drops","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":20,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:48:07.948Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-drops","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":20,"promptChars":1758,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:48:07.948Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-drops","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Restaurant 1","score":0.8},{"placeId":"place_2","placeName":"Restaurant 2","score":0.78},{"placeId":"place_3","placeName":"Restaurant 3","score":0.76},{"placeId":"place_4","placeName":"Restaurant 4","score":0.74},{"placeId":"place_5","placeName":"Restaurant 5","score":0.7200000000000001},{"placeId":"place_6","placeName":"Restaurant 6","score":0.7000000000000001},{"placeId":"place_7","placeName":"Restaurant 7","score":0.68},{"placeId":"place_8","placeName":"Restaurant 8","score":0.66},{"placeId":"place_9","placeName":"Restaurant 9","score":0.64},{"placeId":"place_10","placeName":"Restaurant 10","score":0.6200000000000001}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:48:07.949Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-drops","event":"cuisine_enforcement_llm_success","countIn":20,"countOut":20,"hasScores":true,"scoresCount":20,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:48:07.949Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-drop-boost","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":20,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:48:07.950Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-drop-boost","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":20,"promptChars":1658,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:48:07.950Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-drop-boost","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Asian 1","score":0.7},{"placeId":"place_2","placeName":"Asian 2","score":0.69},{"placeId":"place_3","placeName":"Asian 3","score":0.6799999999999999},{"placeId":"place_4","placeName":"Asian 4","score":0.6699999999999999},{"placeId":"place_5","placeName":"Asian 5","score":0.6599999999999999},{"placeId":"place_6","placeName":"Asian 6","score":0.6499999999999999},{"placeId":"place_7","placeName":"Asian 7","score":0.6399999999999999},{"placeId":"place_8","placeName":"Asian 8","score":0.6299999999999999},{"placeId":"place_9","placeName":"Asian 9","score":0.62},{"placeId":"place_10","placeName":"Asian 10","score":0.61}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:48:07.950Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-drop-boost","event":"cuisine_enforcement_llm_success","countIn":20,"countOut":20,"hasScores":true,"scoresCount":20,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:48:07.951Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-kosher-active","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":20,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:48:07.952Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-kosher-active","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":20,"promptChars":1698,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:48:07.952Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-kosher-active","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Italian 1","score":0.8},{"placeId":"place_2","placeName":"Italian 2","score":0.8},{"placeId":"place_3","placeName":"Italian 3","score":0.8},{"placeId":"place_4","placeName":"Italian 4","score":0.8},{"placeId":"place_5","placeName":"Italian 5","score":0.8},{"placeId":"place_6","placeName":"Italian 6","score":0.8},{"placeId":"place_7","placeName":"Italian 7","score":0.8},{"placeId":"place_8","placeName":"Italian 8","score":0.8},{"placeId":"place_9","placeName":"Italian 9","score":0.8},{"placeId":"place_10","placeName":"Italian 10","score":0.8}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:48:07.952Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-kosher-active","event":"cuisine_enforcement_llm_success","countIn":20,"countOut":20,"hasScores":true,"scoresCount":20,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:48:07.953Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-meat-cuisine","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":18,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:48:07.953Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-meat-cuisine","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":18,"promptChars":1608,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:48:07.953Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-meat-cuisine","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Steakhouse 1","score":0.9},{"placeId":"place_2","placeName":"Steakhouse 2","score":0.9},{"placeId":"place_3","placeName":"Steakhouse 3","score":0.9},{"placeId":"place_4","placeName":"Steakhouse 4","score":0.9},{"placeId":"place_5","placeName":"Steakhouse 5","score":0.9},{"placeId":"place_6","placeName":"Steakhouse 6","score":0.9},{"placeId":"place_7","placeName":"Steakhouse 7","score":0.9},{"placeId":"place_8","placeName":"Steakhouse 8","score":0.9},{"placeId":"place_9","placeName":"Steakhouse 9","score":0.9},{"placeId":"place_10","placeName":"Steakhouse 10","score":0.9}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:48:07.954Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-meat-cuisine","event":"cuisine_enforcement_llm_success","countIn":18,"countOut":18,"hasScores":true,"scoresCount":18,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:48:07.955Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-dairy-cuisine","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":15,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:48:07.955Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-dairy-cuisine","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":15,"promptChars":1310,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:48:07.956Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-dairy-cuisine","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Dairy 1","score":0.85},{"placeId":"place_2","placeName":"Dairy 2","score":0.85},{"placeId":"place_3","placeName":"Dairy 3","score":0.85},{"placeId":"place_4","placeName":"Dairy 4","score":0.85},{"placeId":"place_5","placeName":"Dairy 5","score":0.85},{"placeId":"place_6","placeName":"Dairy 6","score":0.85},{"placeId":"place_7","placeName":"Dairy 7","score":0.85},{"placeId":"place_8","placeName":"Dairy 8","score":0.85},{"placeId":"place_9","placeName":"Dairy 9","score":0.85},{"placeId":"place_10","placeName":"Dairy 10","score":0.85}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:48:07.956Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-dairy-cuisine","event":"cuisine_enforcement_llm_success","countIn":15,"countOut":15,"hasScores":true,"scoresCount":15,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:48:07.957Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-preserve-12","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":22,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:48:07.958Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-preserve-12","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":22,"promptChars":1839,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:48:07.958Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-preserve-12","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Generic 1","score":0.7},{"placeId":"place_2","placeName":"Generic 2","score":0.69},{"placeId":"place_3","placeName":"Generic 3","score":0.6799999999999999},{"placeId":"place_4","placeName":"Generic 4","score":0.6699999999999999},{"placeId":"place_5","placeName":"Generic 5","score":0.6599999999999999},{"placeId":"place_6","placeName":"Generic 6","score":0.6499999999999999},{"placeId":"place_7","placeName":"Generic 7","score":0.6399999999999999},{"placeId":"place_8","placeName":"Generic 8","score":0.6299999999999999},{"placeId":"place_9","placeName":"Generic 9","score":0.62},{"placeId":"place_10","placeName":"Generic 10","score":0.61}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:48:07.958Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-preserve-12","event":"cuisine_enforcement_llm_success","countIn":22,"countOut":22,"hasScores":true,"scoresCount":22,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"info","time":"2026-01-31T14:48:07.959Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-aggressive","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":20,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:48:07.959Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-aggressive","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":1,"preferredTermsCount":0,"placesCount":20,"promptChars":1658,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:48:07.959Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-aggressive","event":"cuisine_scores_top10","scores":[{"placeId":"place_1","placeName":"Asian 1","score":0.75},{"placeId":"place_2","placeName":"Asian 2","score":0.75},{"placeId":"place_3","placeName":"Asian 3","score":0.75},{"placeId":"place_4","placeName":"Asian 4","score":0.75},{"placeId":"place_5","placeName":"Asian 5","score":0.75},{"placeId":"place_6","placeName":"Asian 6","score":0.75},{"placeId":"place_7","placeName":"Asian 7","score":0.75},{"placeId":"place_8","placeName":"Asian 8","score":0.75},{"placeId":"place_9","placeName":"Asian 9","score":0.75},{"placeId":"place_10","placeName":"Asian 10","score":0.75}],"msg":"[CUISINE_ENFORCER] Top 10 cuisine scores"}
{"level":"info","time":"2026-01-31T14:48:07.959Z","pid":21248,"hostname":"il-dev-win-lt-shahar-pot","requestId":"test-no-aggressive","event":"cuisine_enforcement_llm_success","countIn":20,"countOut":20,"hasScores":true,"scoresCount":20,"msg":"[CUISINE_ENFORCER] LLM scoring completed"}
{"level":"warn","time":"2026-01-31T14:52:27.287Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:52:28.126Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:52:28.128Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:52:28.130Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:52:28.134Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:52:28.215Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:52:28.219Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":81,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:52:28.222Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:52:28.235Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:52:28.244Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:52:28.245Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:52:28.247Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:52:28.248Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:52:28.249Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:52:28.250Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"warn","time":"2026-01-31T14:52:27.566Z","pid":19304,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:52:28.262Z","pid":19304,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:52:28.264Z","pid":19304,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:52:28.266Z","pid":19304,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:52:28.270Z","pid":19304,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:52:28.325Z","pid":19304,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:52:28.329Z","pid":19304,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":58,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:52:28.332Z","pid":19304,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:52:28.346Z","pid":19304,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:52:28.354Z","pid":19304,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:52:28.355Z","pid":19304,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:52:28.359Z","pid":19304,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:52:28.360Z","pid":19304,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:52:28.361Z","pid":19304,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:52:28.363Z","pid":19304,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:52:28.370Z","pid":19304,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:52:28.433Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","traceId":"ee28fdb0-dc04-47f7-8862-19db3a7f2006","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"1a17f9a18dba","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:52:28.458Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871148457-ovgb4u","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:52:28.860Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","traceId":"54b4701c-f5d7-4766-b7a1-b7e5aefeb098","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"8643ee4af4cb","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:52:28.871Z","pid":20568,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871148871-g4vpk4","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:54:24.069Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:54:24.819Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:54:24.822Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:54:24.826Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:54:24.831Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:54:24.906Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:54:24.910Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":77,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:54:24.913Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:54:24.930Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:54:24.944Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:54:24.945Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:54:24.949Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:54:24.950Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:54:24.952Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:54:24.955Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:54:25.194Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","traceId":"f48d360b-59a7-41bb-8a1e-e4a48569232d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"73fdf4645b47","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:54:25.220Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871265219-2ghdew","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:54:24.820Z","pid":1160,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:54:25.505Z","pid":1160,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:54:25.507Z","pid":1160,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:54:25.508Z","pid":1160,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:54:25.512Z","pid":1160,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:54:25.569Z","pid":1160,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:54:25.573Z","pid":1160,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":60,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:54:25.575Z","pid":1160,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:54:25.587Z","pid":1160,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:54:25.594Z","pid":1160,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:54:25.595Z","pid":1160,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:54:25.598Z","pid":1160,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:54:25.598Z","pid":1160,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:54:25.599Z","pid":1160,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:54:25.601Z","pid":1160,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:54:25.606Z","pid":1160,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:54:26.481Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","traceId":"85a64269-4d01-4bfc-bb37-aaa2097f1817","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"c6dbbbd51891","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:54:26.491Z","pid":18528,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871266490-efbxek","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:55:32.952Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:55:33.354Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:55:33.356Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:55:33.358Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:55:33.361Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:55:33.457Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:55:33.462Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":100,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:55:33.465Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:55:33.485Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:55:33.501Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:55:33.503Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:55:33.508Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:55:33.510Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:55:33.515Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:55:33.518Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T14:55:33.669Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","traceId":"d5fc3493-bb44-4b35-80ff-3f43560a9fb2","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"fe12d792ebef","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:55:33.674Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","traceId":"b1bc1c23-bf10-4cf3-a938-59a429d4ad8e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"554b623bc871","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:55:33.690Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871333690-zwn846","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:55:33.714Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871333714-eg8j2s","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"warn","time":"2026-01-31T14:55:33.329Z","pid":5468,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T14:55:33.844Z","pid":5468,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T14:55:33.845Z","pid":5468,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T14:55:33.847Z","pid":5468,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T14:55:33.854Z","pid":5468,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T14:55:33.920Z","pid":5468,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T14:55:33.928Z","pid":5468,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":73,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T14:55:33.932Z","pid":5468,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T14:55:33.950Z","pid":5468,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T14:55:33.963Z","pid":5468,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T14:55:33.965Z","pid":5468,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T14:55:33.968Z","pid":5468,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T14:55:33.970Z","pid":5468,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T14:55:33.972Z","pid":5468,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T14:55:33.973Z","pid":5468,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T14:55:33.979Z","pid":5468,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T14:56:25.018Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871333690-zwn846","code":1001,"reason":"none","wasClean":true,"msg":"websocket_disconnected"}
{"level":"info","time":"2026-01-31T14:56:25.142Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","traceId":"8222b718-1c9c-48df-bc4a-ec51c0ebc2a9","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"a71383f4b423","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T14:56:25.153Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871385153-7yllhf","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T14:56:28.543Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-01-31T14:56:28.546Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-01-31T14:56:28.547Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-01-31T14:56:28.547Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized with shared client"}
{"level":"info","time":"2026-01-31T14:56:28.555Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","query":"מסעדות  אסיאתיות בתל אביב","status":"PENDING","hasOwner":true,"hasIdempotencyKey":true,"msg":"[RedisJobStore] Job created"}
{"level":"info","time":"2026-01-31T14:56:28.556Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","sessionHash":"2c3b20d765e7","hasUserId":false,"operation":"createJob","decision":"ACCEPTED","hasIdempotencyKey":true,"event":"job_created","msg":"[Observability] Job created with JWT session binding and idempotency key"}
{"level":"info","time":"2026-01-31T14:56:28.560Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","status":"RUNNING","progress":10,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:56:28.561Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","status":"RUNNING","progress":10,"event":"status_running","msg":"[Observability] Job status set to RUNNING"}
{"level":"info","time":"2026-01-31T14:56:28.563Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769871388538-l1rci83b4","event":"backlog_created","msg":"WebSocket backlog created for late subscribers"}
{"level":"info","time":"2026-01-31T14:56:28.564Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","pipelineVersion":"route2","event":"pipeline_selected","queryLen":25,"queryHash":"1e5c9660e4c0","msg":"[ROUTE2] Pipeline selected"}
{"level":"info","time":"2026-01-31T14:56:28.565Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","pipelineVersion":"route2","event":"device_region_resolved","userRegionCode":"IL","userRegionSource":"config","msg":"[ROUTE2] Device region resolved"}
{"level":"info","time":"2026-01-31T14:56:28.565Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","traceId":"02449140-427e-46aa-9b88-86839797748d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_started","queryLen":25,"queryHash":"1e5c9660e4c0","msg":"[ROUTE2] gate2 started"}
{"level":"info","time":"2026-01-31T14:56:28.644Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871385153-7yllhf","channel":"search","requestIdHash":"efd7d8f1cb33","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:56:28.645Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871385153-7yllhf","channel":"search","requestIdHash":"efd7d8f1cb33","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:56:28.645Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871385153-7yllhf","channel":"assistant","requestIdHash":"efd7d8f1cb33","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:56:28.646Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871385153-7yllhf","channel":"assistant","requestIdHash":"efd7d8f1cb33","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:56:28.647Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769871388538-l1rci83b4","count":1,"event":"backlog_drained","msg":"WebSocket backlog drained to late subscriber"}
{"level":"info","time":"2026-01-31T14:56:29.519Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"02449140-427e-46aa-9b88-86839797748d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":952,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:56:29.519Z","model":"gpt-4o-mini","tokensIn":223,"tokensOut":12,"totalTokens":235,"schemaName":"response","schemaStrict":true,"schemaHash":"ecbf2c0a0457","schemaVersion":"v1","promptVersion":"gate2_v4","promptHash":"417e5c5eced45df60519ffa2d62a71e758d5dd81618a8f8dd394670184d7c480","promptLength":561,"estimatedCostUsd":0.00004065,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:56:29.521Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","traceId":"02449140-427e-46aa-9b88-86839797748d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_completed","durationMs":955,"route":"CONTINUE","foodSignal":"YES","confidence":0.95,"tokenUsage":{"input":223,"output":12,"total":235,"model":"gpt-4o-mini"},"msg":"[ROUTE2] gate2 completed"}
{"level":"info","time":"2026-01-31T14:56:29.523Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","status":"RUNNING","progress":25,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:56:29.524Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","traceId":"02449140-427e-46aa-9b88-86839797748d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"intent","event":"stage_started","queryLen":25,"queryHash":"1e5c9660e4c0","msg":"[ROUTE2] intent started"}
{"level":"info","time":"2026-01-31T14:56:31.880Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"02449140-427e-46aa-9b88-86839797748d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":2355,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:56:31.880Z","model":"gpt-4o-mini","tokensIn":1601,"tokensOut":81,"totalTokens":1682,"schemaName":"response","schemaStrict":true,"schemaHash":"f731e75551db","schemaVersion":"v1","promptVersion":"intent_v4","promptHash":"7d0cb4f0f10cec33408d81bef29a9ab039df93163813d0fb2660eb8dda9adb95","estimatedCostUsd":0.00028875,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:56:31.884Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"intent","promptVersion":"intent_v4","schemaHash":"f58b8106b963","requestId":"req-1769871388538-l1rci83b4","traceId":"02449140-427e-46aa-9b88-86839797748d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3500,"timeoutHit":false,"buildPromptMs":0.05,"networkMs":2356.4,"parseMs":3.12,"totalMs":2359.62,"promptChars":4882,"inputTokens":1601,"outputTokens":81,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:56:31.885Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","traceId":"02449140-427e-46aa-9b88-86839797748d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"intent","event":"stage_completed","durationMs":2361,"route":"TEXTSEARCH","confidence":1,"reason":"explicit_city_mentioned","msg":"[ROUTE2] intent completed"}
{"level":"info","time":"2026-01-31T14:56:31.891Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","status":"RUNNING","progress":40,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:56:31.891Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","pipelineVersion":"route2","event":"intent_decided","route":"TEXTSEARCH","regionCandidate":"IL","language":"he","confidence":1,"reason":"explicit_city_mentioned","msg":"[ROUTE2] Intent routing decided (regionCandidate will be validated by filters_resolved)"}
{"level":"info","time":"2026-01-31T14:56:31.894Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","pipelineVersion":"route2","event":"parallel_started","route":"TEXTSEARCH","isGenericWithLocation":false,"skipBaseFilters":false,"hasUserLocation":false,"hasCityText":true,"msg":"[ROUTE2] Starting parallel tasks (base_filters + post_constraints)"}
{"level":"info","time":"2026-01-31T14:56:31.897Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","pipelineVersion":"route2","event":"base_filters_llm_started","query":"מסעדות  אסיאתיות בתל אביב","route":"TEXTSEARCH","msg":"[ROUTE2] Base filters LLM started"}
{"level":"info","time":"2026-01-31T14:56:31.899Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","pipelineVersion":"route2","event":"google_parallel_started","regionCode":"IL","providerLanguage":"he","uiLanguage":"he","msg":"[ROUTE2] Starting Google fetch in parallel (early context derived)"}
{"level":"info","time":"2026-01-31T14:56:31.901Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","stage":"textsearch_mapper","event":"schema_check_before_llm","schemaId":"TEXTSEARCH_JSON_SCHEMA","schemaProperties":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"schemaPropertiesCount":12,"schemaRequired":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"schemaRequiredCount":12,"hasModeField":true,"schemaValid":true,"schemaHash":"textsearch_v5_keyed_freetext_mode"}
{"level":"info","time":"2026-01-31T14:56:31.902Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","stage":"textsearch_mapper","event":"schema_final_check","schemaType":"object","propertyKeys":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"requiredKeys":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"hasModeField":true,"additionalProperties":false,"isValid":true,"msg":"[TEXTSEARCH] Final schema check before OpenAI call"}
{"level":"info","time":"2026-01-31T14:56:32.603Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"a610854b-18f0-4af4-847d-a89ce1342dd7","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:56:32.607Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":4055,"updatedAgeMs":719,"progress":40,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 4055, updatedAgeMs: 719"}
{"level":"info","time":"2026-01-31T14:56:33.631Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"02449140-427e-46aa-9b88-86839797748d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1733,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:56:33.631Z","model":"gpt-4o-mini","tokensIn":1465,"tokensOut":62,"totalTokens":1527,"schemaName":"response","schemaStrict":true,"schemaHash":"d2d4176c14f8","schemaVersion":"v1","promptVersion":"base_filters_v1","promptHash":"b24fef29feccd3ea093ed98af52e3a66b4790fa26ba4ac39bfb11465691690b1","promptLength":3191,"estimatedCostUsd":0.00025695,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:56:33.637Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"base_filters_llm","promptVersion":"base_filters_v1","schemaHash":"b3796b7ffc83","requestId":"req-1769871388538-l1rci83b4","traceId":"02449140-427e-46aa-9b88-86839797748d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":4500,"timeoutHit":false,"buildPromptMs":0.09,"networkMs":1734.83,"parseMs":3.92,"totalMs":1738.91,"promptChars":3216,"inputTokens":1465,"outputTokens":62,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:56:33.638Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","pipelineVersion":"route2","event":"base_filters_llm_completed","durationMs":1741,"language":"he","openState":null,"openAt":null,"openBetween":null,"priceIntent":null,"minRatingBucket":null,"minReviewCountBucket":null,"regionHint":"IL","tokenUsage":{"input":1465,"output":62,"total":1527,"model":"gpt-4o-mini"},"msg":"[ROUTE2] Base filters LLM completed"}
{"level":"info","time":"2026-01-31T14:56:33.658Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"02449140-427e-46aa-9b88-86839797748d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1762,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:56:33.658Z","model":"gpt-4o-mini","tokensIn":1698,"tokensOut":61,"totalTokens":1759,"schemaName":"response","schemaStrict":true,"schemaHash":"9cb7c40fd303","schemaVersion":"v1","promptVersion":"post_constraints_v1","promptHash":"7a9eb00cc4c93e1a79c0b2b54a37ae3f0f136351e35eca7a675dba627252da53","estimatedCostUsd":0.0002913,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:56:33.664Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"post_constraints","promptVersion":"post_constraints_v1","schemaHash":"666abe1760c4","requestId":"req-1769871388538-l1rci83b4","traceId":"02449140-427e-46aa-9b88-86839797748d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3500,"timeoutHit":false,"buildPromptMs":0.12,"networkMs":1763.92,"parseMs":3.49,"totalMs":1767.66,"promptChars":4348,"inputTokens":1698,"outputTokens":61,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:56:34.198Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"71426d05-ae81-4f8b-9ade-b2904855bee2","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:56:34.200Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":5648,"updatedAgeMs":2312,"progress":40,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 5648, updatedAgeMs: 2312"}
{"level":"info","time":"2026-01-31T14:56:34.531Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"02449140-427e-46aa-9b88-86839797748d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":2628,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:56:34.531Z","model":"gpt-4o-mini","tokensIn":966,"tokensOut":100,"totalTokens":1066,"schemaName":"response","schemaStrict":true,"schemaHash":"924556626f01","schemaVersion":"v1","promptVersion":"textsearch_mapper_v4_keyed_freetext","promptHash":"6ec296a5225613c761b0a90ee0f4c21f97678e5167324a48f11ec42152ee1caa","estimatedCostUsd":0.0002049,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:56:34.532Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"textsearch_mapper","promptVersion":"textsearch_mapper_v4_keyed_freetext","schemaHash":"textsearch_v5_keyed_freetext_mode","requestId":"req-1769871388538-l1rci83b4","traceId":"02449140-427e-46aa-9b88-86839797748d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3500,"timeoutHit":false,"buildPromptMs":0.09,"networkMs":2628.43,"parseMs":1.16,"totalMs":2629.76,"promptChars":2280,"inputTokens":966,"outputTokens":100,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:56:34.533Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","stage":"textsearch_mapper","event":"deterministic_builder_keyed","mode":"KEYED","cuisineKey":"asian","cityText":"תל אביב","cityEnglish":"Tel Aviv","providerTextQuery":"Asian restaurant in Tel Aviv","providerLanguage":"en","source":"deterministic_builder","msg":"[TEXTSEARCH] Built KEYED mode query (cuisine + city) - fully in English"}
{"level":"info","time":"2026-01-31T14:56:34.533Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","stage":"textsearch_mapper","event":"cuisine_terms_generated","cuisineKey":"asian","searchLanguage":"he","requiredTerms":["אסייתית","אסיה"],"preferredTerms":["סיני","תאילנדי","יפני"],"msg":"[TEXTSEARCH] Generated cuisine terms from cuisineKey"}
{"level":"info","time":"2026-01-31T14:56:34.533Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","stage":"textsearch_mapper","event":"bias_planned","source":"cityCenter_pending_geocode","cityText":"תל אביב","intentReason":"explicit_city_mentioned","note":"explicit_city_preferred_over_userLocation","msg":"[TEXTSEARCH] City-center bias planned (explicit city takes priority over userLocation)"}
{"level":"info","time":"2026-01-31T14:56:34.533Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","stage":"textsearch_mapper","event":"mapper_success","mode":"KEYED","cuisineKey":"asian","cityText":"תל אביב","providerTextQuery":"Asian restaurant in Tel Aviv","providerLanguage":"en","source":"deterministic_builder_keyed","strictness":"STRICT","msg":"[TEXTSEARCH] Mapper completed successfully"}
{"level":"info","time":"2026-01-31T14:56:34.533Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","pipelineVersion":"route2","event":"route_llm_mapped","providerMethod":"textSearch","region":"IL","language":"he","msg":"[ROUTE2] Route-LLM mapping completed (using early context)"}
{"level":"info","time":"2026-01-31T14:56:34.534Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","pipelineVersion":"route2","stage":"google_maps","event":"stage_started","providerMethod":"textSearch","region":"IL","language":"he","msg":"[ROUTE2] google_maps started"}
{"level":"info","time":"2026-01-31T14:56:34.534Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","provider":"google_places_new","method":"searchText","providerTextQuery":"Asian restaurant in Tel Aviv","providerLanguage":"en","region":"IL","hasBiasPlanned":true,"biasSource":"cityText_pending_geocode","mode":"KEYED","cityText":"תל אביב","msg":"[GOOGLE] Calling Text Search API (New) - using providerTextQuery/providerLanguage"}
{"level":"info","time":"2026-01-31T14:56:34.535Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"CACHE_WRAP_ENTER","providerMethod":"textSearch","cacheKey":"g:textsearch:f9cbb809a5084bf8ef9889a9e0226dc5","ttlSeconds":900}
{"level":"info","time":"2026-01-31T14:56:34.536Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","pipelineVersion":"route2","event":"google_parallel_awaited","parallelDurationMs":2637,"msg":"[ROUTE2] Awaiting Google results + base_filters/post_constraints (barrier)"}
{"level":"info","time":"2026-01-31T14:56:34.536Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","pipelineVersion":"route2","event":"await_base_filters","msg":"[ROUTE2] Awaiting base filters"}
{"level":"info","time":"2026-01-31T14:56:34.537Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"language_context_resolved","uiLanguage":"he","queryLanguage":"he","intentLanguage":"he","intentLanguageConfidence":1,"assistantLanguage":"he","searchLanguage":"he","providerLanguage":"he","regionCode":"IL","sources":{"assistantLanguage":"query_language_deterministic","searchLanguage":"query_language_policy"},"providerLanguagePolicy":"queryLanguage","msg":"[LANGUAGE] Language context resolved with strict separation"}
{"level":"info","time":"2026-01-31T14:56:34.537Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","pipelineVersion":"route2","event":"filters_resolved","base":{"language":"he","openState":null,"openAt":null,"openBetween":null,"priceIntent":null,"minRatingBucket":null,"regionHint":"IL"},"final":{"uiLanguage":"he","providerLanguage":"he","openState":null,"openAt":null,"openBetween":null,"priceIntent":null,"minRatingBucket":null,"regionCode":"IL"},"sanitized":false,"msg":"[ROUTE2] Filters resolved"}
{"level":"info","time":"2026-01-31T14:56:34.538Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"google_textsearch_using_provider_fields","providerTextQuery":"Asian restaurant in Tel Aviv","providerLanguage":"en","mode":"KEYED","source":"mapper_deterministic_builder","msg":"[GOOGLE] Using providerTextQuery/providerLanguage from mapper"}
{"level":"info","time":"2026-01-31T14:56:34.774Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"city_center_resolved","cityText":"תל אביב","lat":32.0852999,"lng":34.78176759999999,"servedFromCache":false,"radiusMeters":10000,"hadOriginalBias":false,"biasSource":"cityCenter","msg":"[GOOGLE] City center resolved, applying city-center bias"}
{"level":"info","time":"2026-01-31T14:56:34.775Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"google_call_language","providerMethod":"textSearch","languageCode":"en","providerLanguage":"en","regionCode":"IL","providerTextQuery":"Asian restaurant in Tel Aviv","mode":"KEYED","languageSource":"mapper_deterministic_builder","msg":"[GOOGLE] Text Search API call language (from mapper providerLanguage)"}
{"level":"info","time":"2026-01-31T14:56:34.775Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"textsearch_request_payload","providerTextQuery":"Asian restaurant in Tel Aviv","textQueryLen":28,"textQueryHash":"5fa9abb8b460","mode":"KEYED","hasExplicitCity":true,"languageCode":"en","regionCode":"IL","regionCodeSent":true,"hasBiasApplied":true,"biasSource":"cityCenter","biasLat":32.0852999,"biasLng":34.78176759999999,"biasRadiusMeters":10000,"maxResultCount":20,"msg":"[GOOGLE] Text Search request payload (providerTextQuery)"}
{"level":"info","time":"2026-01-31T14:56:34.775Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"google_textsearch_bias_applied","biasType":"cityCenter","lat":32.0852999,"lng":34.78176759999999,"radiusMeters":10000,"msg":"[GOOGLE] Location bias ACTUALLY applied to Google request"}
{"level":"info","time":"2026-01-31T14:56:34.776Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"google_textsearch_page","page":1,"maxResults":20,"maxPages":3,"textQuery":"Asian restaurant in Tel Aviv","msg":"[GOOGLE] Fetching page 1"}
{"level":"info","time":"2026-01-31T14:56:35.683Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"cb695459-4cf0-42ff-b49c-9e42126abdb3","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:56:35.686Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":7134,"updatedAgeMs":3798,"progress":40,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 7134, updatedAgeMs: 3798"}
{"level":"info","time":"2026-01-31T14:56:36.066Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"google_textsearch_page","page":1,"fetchedCount":20,"cumulativeCount":20,"hasNextPageToken":false,"msg":"[GOOGLE] Page 1 completed"}
{"level":"info","time":"2026-01-31T14:56:36.067Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"google_textsearch_aggregated","requested":20,"returned":20,"pagesUsed":1,"maxPagesAllowed":3,"totalFetched":20,"duplicatesRemoved":0,"stopReason":"max_results_reached","hadMorePages":false,"msg":"[GOOGLE] Text Search aggregated results"}
{"level":"info","time":"2026-01-31T14:56:36.082Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"CACHE_WRAP_EXIT","providerMethod":"textSearch","servedFrom":"google_api","cacheTier":"MISS","durationMs":1548}
{"level":"info","time":"2026-01-31T14:56:36.082Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","provider":"google_places_new","method":"searchText","durationMs":1548,"resultCount":20,"fieldMaskUsed":"places.id,places.displayName,places.formattedAddress,places.location,places.rating,places.userRatingCount,places.priceLevel,places.currentOpeningHours,places.regularOpeningHours,places.utcOffsetMinutes,places.photos,places.types,places.googleMapsUri","servedFrom":"google_api","msg":"[GOOGLE] Text Search completed"}
{"level":"info","time":"2026-01-31T14:56:36.083Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","pipelineVersion":"route2","stage":"google_maps","event":"stage_completed","durationMs":1549,"providerMethod":"textSearch","resultCount":20,"region":"IL","language":"he","msg":"[ROUTE2] google_maps completed"}
{"level":"info","time":"2026-01-31T14:56:36.083Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","pipelineVersion":"route2","event":"google_parallel_completed","totalDurationMs":4184,"googleDurationMs":1549,"criticalPathSavedMs":2635,"msg":"[ROUTE2] Google fetch completed (parallel optimization saved time)"}
{"level":"info","time":"2026-01-31T14:56:36.085Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","status":"RUNNING","progress":60,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:56:36.085Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","pipelineVersion":"route2","event":"cuisine_enforcement_started","strictness":"STRICT","requiredTerms":["אסייתית","אסיה"],"preferredTerms":["סיני","תאילנדי","יפני"],"countIn":20,"hardConstraintsExist":false,"hardConstraintsActive":[],"msg":"[ROUTE2] Starting cuisine enforcement"}
{"level":"info","time":"2026-01-31T14:56:36.086Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":20,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:56:36.086Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":2,"preferredTermsCount":3,"placesCount":20,"promptChars":2442,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:56:37.257Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"ac084043-f466-4410-a329-5f125cae7b16","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:56:37.258Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":8706,"updatedAgeMs":1174,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 8706, updatedAgeMs: 1174"}
{"level":"info","time":"2026-01-31T14:56:38.623Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"69a77a2b-c4aa-4492-b1fd-4ada0e256bd9","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:56:38.625Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":10073,"updatedAgeMs":2541,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 10073, updatedAgeMs: 2541"}
{"level":"warn","time":"2026-01-31T14:56:40.101Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","provider":"openai","operation":"completeJSON","latencyMs":4014,"success":false,"retryCount":0,"errorCode":"Error","errorReason":"Request was aborted.","timestamp":"2026-01-31T14:56:40.101Z","msg":"Provider call failed: openai.completeJSON"}
{"level":"warn","time":"2026-01-31T14:56:40.103Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"cuisine_enforcer","promptVersion":"unknown","requestId":"req-1769871388538-l1rci83b4","attempt":1,"model":"gpt-4o-mini","timeoutMs":4000,"timeoutHit":true,"buildPromptMs":0.09,"networkMs":4015.49,"parseMs":0,"totalMs":4015.63,"promptChars":2442,"inputTokens":null,"outputTokens":null,"retriesCount":0,"success":false,"errorType":"abort_timeout","errorReason":"Request aborted or timeout","statusCode":null,"msg":"llm_gate_timing"}
{"level":"warn","time":"2026-01-31T14:56:40.104Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":1,"maxAttempts":3,"errorType":"abort_timeout","msg":"[LLM] Timeout, will retry with backoff"}
{"level":"warn","time":"2026-01-31T14:56:40.104Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":1,"maxAttempts":3,"msg":"[LLM] Retriable transport error"}
{"level":"info","time":"2026-01-31T14:56:40.242Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"4b23ec42-55be-496d-bb6f-b50d9319bbfe","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:56:40.243Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":11691,"updatedAgeMs":4159,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 11691, updatedAgeMs: 4159"}
{"level":"info","time":"2026-01-31T14:56:41.849Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"ad86098a-6c91-49c0-95f8-370274daee02","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:56:41.850Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":13298,"updatedAgeMs":5766,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 13298, updatedAgeMs: 5766"}
{"level":"info","time":"2026-01-31T14:56:44.115Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"033ba4b4-d157-409f-97ba-e5460f9d2c4c","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:56:44.118Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":15566,"updatedAgeMs":537,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 15566, updatedAgeMs: 537"}
{"level":"warn","time":"2026-01-31T14:56:44.375Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","provider":"openai","operation":"completeJSON","latencyMs":4016,"success":false,"retryCount":1,"errorCode":"Error","errorReason":"Request was aborted.","timestamp":"2026-01-31T14:56:44.375Z","msg":"Provider call failed: openai.completeJSON"}
{"level":"warn","time":"2026-01-31T14:56:44.376Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"cuisine_enforcer","promptVersion":"unknown","requestId":"req-1769871388538-l1rci83b4","attempt":2,"model":"gpt-4o-mini","timeoutMs":4000,"timeoutHit":true,"buildPromptMs":0.09,"networkMs":4017.59,"parseMs":0,"totalMs":8289.43,"promptChars":2442,"inputTokens":null,"outputTokens":null,"retriesCount":1,"success":false,"errorType":"abort_timeout","errorReason":"Request aborted or timeout","statusCode":null,"msg":"llm_gate_timing"}
{"level":"warn","time":"2026-01-31T14:56:44.377Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":2,"maxAttempts":3,"errorType":"abort_timeout","msg":"[LLM] Timeout, will retry with backoff"}
{"level":"warn","time":"2026-01-31T14:56:44.378Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":2,"maxAttempts":3,"msg":"[LLM] Retriable transport error"}
{"level":"info","time":"2026-01-31T14:56:49.107Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"6dbaf222-a9a2-4c63-8a3f-e4cb8b61852c","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:56:49.111Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":20559,"updatedAgeMs":5530,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 20559, updatedAgeMs: 5530"}
{"level":"warn","time":"2026-01-31T14:56:49.132Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","provider":"openai","operation":"completeJSON","latencyMs":4004,"success":false,"retryCount":2,"errorCode":"Error","errorReason":"Request was aborted.","timestamp":"2026-01-31T14:56:49.132Z","msg":"Provider call failed: openai.completeJSON"}
{"level":"warn","time":"2026-01-31T14:56:49.132Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"cuisine_enforcer","promptVersion":"unknown","requestId":"req-1769871388538-l1rci83b4","attempt":3,"model":"gpt-4o-mini","timeoutMs":4000,"timeoutHit":true,"buildPromptMs":0.09,"networkMs":4003.92,"parseMs":0,"totalMs":13045.7,"promptChars":2442,"inputTokens":null,"outputTokens":null,"retriesCount":2,"success":false,"errorType":"abort_timeout","errorReason":"Request aborted or timeout","statusCode":null,"msg":"llm_gate_timing"}
{"level":"warn","time":"2026-01-31T14:56:49.133Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":3,"maxAttempts":3,"errorType":"abort_timeout","msg":"[LLM] Timeout, will retry with backoff"}
{"level":"warn","time":"2026-01-31T14:56:49.133Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":3,"maxAttempts":3,"msg":"[LLM] Retriable transport error"}
{"level":"error","time":"2026-01-31T14:56:49.134Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempts":3,"msg":"[LLM] All retry attempts exhausted"}
{"level":"error","time":"2026-01-31T14:56:49.134Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"cuisine_enforcement_llm_failed","error":"Request was aborted.","msg":"[CUISINE_ENFORCER] LLM call failed, returning all places"}
{"level":"info","time":"2026-01-31T14:56:49.135Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"cuisine_scores_attached","scoresAttached":0,"resultsCount":20,"msg":"[ROUTE2] Cuisine scores attached to results for ranking"}
{"level":"info","time":"2026-01-31T14:56:49.136Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","pipelineVersion":"route2","event":"cuisine_enforcement_completed","countIn":20,"countOut":20,"relaxApplied":false,"relaxStrategy":"none","hasScores":true,"msg":"[ROUTE2] Cuisine enforcement completed"}
{"level":"info","time":"2026-01-31T14:56:49.136Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"cuisine_score_only_applied","countIn":20,"countOut":20,"mode":"SCORE_ONLY","msg":"[ROUTE2] Cuisine score-only mode: all results kept for ranking"}
{"level":"info","time":"2026-01-31T14:56:49.137Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","pipelineVersion":"route2","event":"await_post_constraints","msg":"[ROUTE2] Awaiting post constraints (late)"}
{"level":"info","time":"2026-01-31T14:56:49.150Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","status":"RUNNING","progress":75,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:56:49.151Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"ranking_input_order","count":20,"first10":[{"idx":0,"placeId":"ChIJTTswQp1LHRURgkOXrxroDw0","rating":4.3,"userRatingCount":5437},{"idx":1,"placeId":"ChIJkTcI-ndLHRUROPXLq-re_yM","rating":4.4,"userRatingCount":2886},{"idx":2,"placeId":"ChIJoY2zs91NHRUR6rn9glaKmVA","rating":4.4,"userRatingCount":970},{"idx":3,"placeId":"ChIJyTi3bkVLHRURVCvwlD4OCKQ","rating":4.7,"userRatingCount":214},{"idx":4,"placeId":"ChIJLyvwqPVLHRUR_M8_-Jipom8","rating":4.5,"userRatingCount":6043},{"idx":5,"placeId":"ChIJa9zBe3tLHRURQHbcLSWNU1g","rating":4.5,"userRatingCount":7264},{"idx":6,"placeId":"ChIJc_dwHk9LHRURGBR4oKBWFHQ","rating":4.5,"userRatingCount":322},{"idx":7,"placeId":"ChIJ6wce6JxMHRUR4fYs_tAoL2k","rating":4.3,"userRatingCount":3396},{"idx":8,"placeId":"ChIJneDij4NLHRURtlTdjTgpmww","rating":4.4,"userRatingCount":2082},{"idx":9,"placeId":"ChIJyRY33LZNHRURjMgW1FlUnEY","rating":4.6,"userRatingCount":245}],"orderSource":"google","reordered":false,"msg":"[RANKING] Input order (Google)"}
{"level":"info","time":"2026-01-31T14:56:49.152Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"ranking_profile_selected","profile":"NO_LOCATION","weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"reason":"no_user_location","cuisineKey":"asian","route":"TEXTSEARCH","source":"deterministic","msg":"[RANKING] No user location - using NO_LOCATION profile (distance weight = 0)"}
{"level":"info","time":"2026-01-31T14:56:49.152Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"ranking_distance_origin_selected","origin":"CITY_CENTER","cityText":"תל אביב","hadUserLocation":false,"refLatLng":{"lat":32.0852999,"lng":34.78176759999999},"intentReason":"explicit_city_mentioned","msg":"[RANKING] Distance origin: CITY_CENTER"}
{"level":"info","time":"2026-01-31T14:56:49.154Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"ranking_output_order","count":20,"first10":[{"idx":0,"placeId":"ChIJP841K3xMHRURebdaloB-MZA","rating":4.4,"userRatingCount":9031},{"idx":1,"placeId":"ChIJ0beHun9MHRURfDSJZE-1RJA","rating":4.4,"userRatingCount":5368},{"idx":2,"placeId":"ChIJTTswQp1LHRURgkOXrxroDw0","rating":4.3,"userRatingCount":5437},{"idx":3,"placeId":"ChIJ4SoclmJLHRURHArSXtGHgjo","rating":4.4,"userRatingCount":2982},{"idx":4,"placeId":"ChIJkTcI-ndLHRUROPXLq-re_yM","rating":4.4,"userRatingCount":2886},{"idx":5,"placeId":"ChIJ6wce6JxMHRUR4fYs_tAoL2k","rating":4.3,"userRatingCount":3396},{"idx":6,"placeId":"ChIJ1yyDisNLHRURUttYiwLqWUI","rating":4.7,"userRatingCount":1074},{"idx":7,"placeId":"ChIJneDij4NLHRURtlTdjTgpmww","rating":4.4,"userRatingCount":2082},{"idx":8,"placeId":"ChIJCV7WSoNMHRURA5y3Fmt7gbg","rating":4.2,"userRatingCount":3208},{"idx":9,"placeId":"ChIJud9rg8dMHRURgmuX8UpjJo4","rating":4.3,"userRatingCount":1663}],"orderSource":"ranking","reordered":true,"msg":"[RANKING] Output order (ranked)"}
{"level":"info","time":"2026-01-31T14:56:49.156Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"ranking_score_breakdown","profile":"BALANCED","top10":[{"placeId":"ChIJP841K3xMHRURebdaloB-MZA","rating":4.4,"userRatingCount":9031,"distanceMeters":1537,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.352,"reviewsScore":0.277,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.804},{"placeId":"ChIJ0beHun9MHRURfDSJZE-1RJA","rating":4.4,"userRatingCount":5368,"distanceMeters":1411,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.352,"reviewsScore":0.261,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.788},{"placeId":"ChIJTTswQp1LHRURgkOXrxroDw0","rating":4.3,"userRatingCount":5437,"distanceMeters":1683,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.344,"reviewsScore":0.261,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.78},{"placeId":"ChIJ4SoclmJLHRURHArSXtGHgjo","rating":4.4,"userRatingCount":2982,"distanceMeters":2691,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.352,"reviewsScore":0.243,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.77},{"placeId":"ChIJkTcI-ndLHRUROPXLq-re_yM","rating":4.4,"userRatingCount":2886,"distanceMeters":1830,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.352,"reviewsScore":0.242,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.769},{"placeId":"ChIJ6wce6JxMHRUR4fYs_tAoL2k","rating":4.3,"userRatingCount":3396,"distanceMeters":1413,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.344,"reviewsScore":0.247,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.766},{"placeId":"ChIJ1yyDisNLHRURUttYiwLqWUI","rating":4.7,"userRatingCount":1074,"distanceMeters":2471,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.376,"reviewsScore":0.212,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.763},{"placeId":"ChIJneDij4NLHRURtlTdjTgpmww","rating":4.4,"userRatingCount":2082,"distanceMeters":1106,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.352,"reviewsScore":0.232,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.759},{"placeId":"ChIJCV7WSoNMHRURA5y3Fmt7gbg","rating":4.2,"userRatingCount":3208,"distanceMeters":2782,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.336,"reviewsScore":0.245,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.756},{"placeId":"ChIJud9rg8dMHRURgmuX8UpjJo4","rating":4.3,"userRatingCount":1663,"distanceMeters":4611,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.344,"reviewsScore":0.225,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.744}],"msg":"[RANKING] Score breakdown for top 10 results"}
{"level":"info","time":"2026-01-31T14:56:49.157Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"post_rank_applied","profile":"BALANCED","weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"resultCount":20,"hadUserLocation":false,"mode":"LLM_SCORE","orderSource":"ranking","reordered":true,"msg":"[RANKING] Results ranked deterministically"}
{"level":"info","time":"2026-01-31T14:56:49.162Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","status":"RUNNING","progress":90,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:56:49.164Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"assistant_language_resolved","assistantLanguage":"he","source":"uiLanguage","detectedLanguage":"other","languageConfidence":1,"confidenceThreshold":0.7,"uiLanguage":"he","msg":"[ASSISTANT] Language resolved for assistant message"}
{"level":"info","time":"2026-01-31T14:56:49.165Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","assistantType":"SUMMARY","sessionIdPresent":true,"event":"assistant_deferred_start","msg":"[ASSISTANT] Deferred generation started (non-blocking)"}
{"level":"info","time":"2026-01-31T14:56:49.165Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","stage":"assistant_llm","event":"assistant_llm_start","type":"SUMMARY","questionLanguage":"he","queryLen":25,"schemaVersion":"v3_strict_validation","promptVersion":"v2_language_enforcement","msg":"[ASSISTANT] Calling LLM"}
{"level":"info","time":"2026-01-31T14:56:49.167Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"pagination_meta","fetchedCount":20,"returnedCount":20,"clientVisibleCount":12,"clientNextIncrement":5,"serverPagination":false,"msg":"[ROUTE2] Pagination metadata (client-side)"}
{"level":"info","time":"2026-01-31T14:56:49.168Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"final_response_order","count":20,"first10":[{"idx":0,"placeId":"ChIJP841K3xMHRURebdaloB-MZA","name":"Thai House"},{"idx":1,"placeId":"ChIJ0beHun9MHRURfDSJZE-1RJA","name":"Moon Sushi"},{"idx":2,"placeId":"ChIJTTswQp1LHRURgkOXrxroDw0","name":"מינה טומיי תל אביב"},{"idx":3,"placeId":"ChIJ4SoclmJLHRURHArSXtGHgjo","name":"Okinawa Levontin"},{"idx":4,"placeId":"ChIJkTcI-ndLHRUROPXLq-re_yM","name":"Zozobra"},{"idx":5,"placeId":"ChIJ6wce6JxMHRUR4fYs_tAoL2k","name":"Vong"},{"idx":6,"placeId":"ChIJ1yyDisNLHRURUttYiwLqWUI","name":"Wat Sang sushi & more"},{"idx":7,"placeId":"ChIJneDij4NLHRURtlTdjTgpmww","name":"Shi-Shi"},{"idx":8,"placeId":"ChIJCV7WSoNMHRURA5y3Fmt7gbg","name":"TYO"},{"idx":9,"placeId":"ChIJud9rg8dMHRURgmuX8UpjJo4","name":"JASIA"}],"orderSource":"ranking","reordered":true,"msg":"[ROUTE2] Final response order (ranked deterministically)"}
{"level":"info","time":"2026-01-31T14:56:49.170Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"order_weights_resolved","base":"balanced","weights":{"rating":25,"reviews":20,"price":15,"openNow":15,"distance":25},"reasonCodes":["BASE_BALANCED"],"ctx":{"method":"textsearch","hasUserLocation":false,"distanceIntent":false,"openNowRequested":false,"priceIntent":"any","qualityIntent":false,"occasion":null,"cuisineKey":"asian"},"normalizedSum":100,"msg":"[ORDER] Hybrid order weights resolved"}
{"level":"info","time":"2026-01-31T14:56:49.171Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"response_order_check","hasOrder":true,"orderProfile":"balanced","resultCount":20,"msg":"[ORDER] Response order metadata check before send"}
{"level":"info","time":"2026-01-31T14:56:49.235Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","hasResult":true,"msg":"[RedisJobStore] Result stored"}
{"level":"info","time":"2026-01-31T14:56:49.235Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","resultCount":20,"hasAssist":true,"event":"result_stored","msg":"[Observability] Search result stored successfully"}
{"level":"info","time":"2026-01-31T14:56:49.285Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","status":"DONE_SUCCESS","progress":100,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:56:49.285Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","status":"DONE_SUCCESS","progress":100,"event":"status_done","msg":"[Observability] Job reached terminal status"}
{"level":"info","time":"2026-01-31T14:56:50.112Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"b545d7cb-8334-407e-9810-ced3a64e3e4d","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:56:50.116Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","event":"getResult_status","status":"DONE_SUCCESS","hasResult":true,"ageMs":21564,"updatedAgeMs":878,"progress":100,"isStale":false,"msg":"[HTTP] GET /result - status: DONE_SUCCESS, ageMs: 21564, updatedAgeMs: 878"}
{"level":"info","time":"2026-01-31T14:56:50.117Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","photoUrlsSanitized":true,"resultCount":20,"hasResult":true,"status":"DONE_SUCCESS","event":"getResult_returned","msg":"[Observability] GET /result returned successfully with results"}
{"level":"info","time":"2026-01-31T14:56:51.132Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"02449140-427e-46aa-9b88-86839797748d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1966,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:56:51.132Z","model":"gpt-4o-mini","tokensIn":915,"tokensOut":72,"totalTokens":987,"schemaName":"response","schemaStrict":true,"schemaHash":"4330761d782c","schemaVersion":"v1","promptVersion":"v2_language_enforcement","promptLength":2973,"estimatedCostUsd":0.00018045,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:56:51.133Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"assistant_llm","promptVersion":"v2_language_enforcement","schemaHash":"553fdda035a7","requestId":"req-1769871388538-l1rci83b4","traceId":"02449140-427e-46aa-9b88-86839797748d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3000,"timeoutHit":false,"buildPromptMs":0.1,"networkMs":1966.5,"parseMs":0.63,"totalMs":1967.28,"promptChars":2973,"inputTokens":915,"outputTokens":72,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:56:51.134Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","stage":"assistant_llm","event":"assistant_llm_success","type":"SUMMARY","questionLanguage":"he","suggestedAction":"NONE","blocksSearch":false,"durationMs":1969,"usage":{"prompt_tokens":915,"completion_tokens":72,"total_tokens":987},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"info","time":"2026-01-31T14:56:51.135Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","assistantType":"SUMMARY","durationMs":1969,"event":"assistant_deferred_done","msg":"[ASSISTANT] Deferred generation completed"}
{"level":"info","time":"2026-01-31T14:56:51.135Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","channel":"assistant","requestId":"req-1769871388538-l1rci83b4","sessionHash":"2c3b20d765e7","payloadType":"assistant","event":"assistant_ws_publish","msg":"[ASSISTANT] Publishing to WebSocket"}
{"level":"info","time":"2026-01-31T14:56:51.135Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871388538-l1rci83b4","channel":"assistant","payloadType":"assistant","event":"assistant_published","assistantType":"SUMMARY","blocksSearch":false,"suggestedAction":"NONE","msg":"[ASSISTANT] Published to WebSocket"}
{"level":"info","time":"2026-01-31T14:56:51.400Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"01b2b613-f91e-46d6-b113-407943f33cb9","ip":"::1","photoRefHash":"e1f9ac268f10","contentType":"image/jpeg","sizeBytes":50505,"durationMs":801,"slow":true,"msg":"[PhotoProxy] Photo served"}
{"level":"info","time":"2026-01-31T14:56:55.956Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"6d0969bd-c1ae-4756-a86f-61a3edb0777d","ip":"::1","photoRefHash":"9de114f955fe","contentType":"image/jpeg","sizeBytes":37246,"durationMs":907,"slow":true,"msg":"[PhotoProxy] Photo served"}
{"level":"info","time":"2026-01-31T14:57:03.066Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","query":"מסעדות   איטלקיות בתל אביב","status":"PENDING","hasOwner":true,"hasIdempotencyKey":true,"msg":"[RedisJobStore] Job created"}
{"level":"info","time":"2026-01-31T14:57:03.066Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","sessionHash":"2c3b20d765e7","hasUserId":false,"operation":"createJob","decision":"ACCEPTED","hasIdempotencyKey":true,"event":"job_created","msg":"[Observability] Job created with JWT session binding and idempotency key"}
{"level":"info","time":"2026-01-31T14:57:03.069Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","status":"RUNNING","progress":10,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:57:03.070Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","status":"RUNNING","progress":10,"event":"status_running","msg":"[Observability] Job status set to RUNNING"}
{"level":"info","time":"2026-01-31T14:57:03.070Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769871423049-pepujqibe","event":"backlog_created","msg":"WebSocket backlog created for late subscribers"}
{"level":"info","time":"2026-01-31T14:57:03.070Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","pipelineVersion":"route2","event":"pipeline_selected","queryLen":26,"queryHash":"3aa904b2a67c","msg":"[ROUTE2] Pipeline selected"}
{"level":"info","time":"2026-01-31T14:57:03.070Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","pipelineVersion":"route2","event":"device_region_resolved","userRegionCode":"IL","userRegionSource":"config","msg":"[ROUTE2] Device region resolved"}
{"level":"info","time":"2026-01-31T14:57:03.071Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","traceId":"ee48845c-339e-4189-934a-23d13a84e059","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_started","queryLen":26,"queryHash":"3aa904b2a67c","msg":"[ROUTE2] gate2 started"}
{"level":"info","time":"2026-01-31T14:57:03.082Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871385153-7yllhf","channel":"search","requestIdHash":"a0169cf11f8b","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:57:03.083Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871385153-7yllhf","channel":"search","requestIdHash":"a0169cf11f8b","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:57:03.084Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769871423049-pepujqibe","count":1,"event":"backlog_drained","msg":"WebSocket backlog drained to late subscriber"}
{"level":"info","time":"2026-01-31T14:57:03.085Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871385153-7yllhf","channel":"assistant","requestIdHash":"a0169cf11f8b","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:57:03.085Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871385153-7yllhf","channel":"assistant","requestIdHash":"a0169cf11f8b","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:57:03.814Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"ee48845c-339e-4189-934a-23d13a84e059","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":738,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:57:03.809Z","model":"gpt-4o-mini","tokensIn":224,"tokensOut":12,"totalTokens":236,"schemaName":"response","schemaStrict":true,"schemaHash":"ecbf2c0a0457","schemaVersion":"v1","promptVersion":"gate2_v4","promptHash":"417e5c5eced45df60519ffa2d62a71e758d5dd81618a8f8dd394670184d7c480","promptLength":561,"estimatedCostUsd":0.000040799999999999996,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:57:03.817Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","traceId":"ee48845c-339e-4189-934a-23d13a84e059","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_completed","durationMs":746,"route":"CONTINUE","foodSignal":"YES","confidence":0.95,"tokenUsage":{"input":224,"output":12,"total":236,"model":"gpt-4o-mini"},"msg":"[ROUTE2] gate2 completed"}
{"level":"info","time":"2026-01-31T14:57:03.822Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","status":"RUNNING","progress":25,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:57:03.823Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","traceId":"ee48845c-339e-4189-934a-23d13a84e059","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"intent","event":"stage_started","queryLen":26,"queryHash":"3aa904b2a67c","msg":"[ROUTE2] intent started"}
{"level":"info","time":"2026-01-31T14:57:06.334Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"ee48845c-339e-4189-934a-23d13a84e059","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":2509,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:57:06.333Z","model":"gpt-4o-mini","tokensIn":1602,"tokensOut":85,"totalTokens":1687,"schemaName":"response","schemaStrict":true,"schemaHash":"f731e75551db","schemaVersion":"v1","promptVersion":"intent_v4","promptHash":"7d0cb4f0f10cec33408d81bef29a9ab039df93163813d0fb2660eb8dda9adb95","estimatedCostUsd":0.0002913,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:57:06.336Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"intent","promptVersion":"intent_v4","schemaHash":"f58b8106b963","requestId":"req-1769871423049-pepujqibe","traceId":"ee48845c-339e-4189-934a-23d13a84e059","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3500,"timeoutHit":false,"buildPromptMs":0.11,"networkMs":2511.58,"parseMs":0.45,"totalMs":2512.21,"promptChars":4883,"inputTokens":1602,"outputTokens":85,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:57:06.337Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","traceId":"ee48845c-339e-4189-934a-23d13a84e059","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"intent","event":"stage_completed","durationMs":2514,"route":"TEXTSEARCH","confidence":1,"reason":"explicit_city_mentioned","msg":"[ROUTE2] intent completed"}
{"level":"info","time":"2026-01-31T14:57:06.355Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","status":"RUNNING","progress":40,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:57:06.356Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","pipelineVersion":"route2","event":"intent_decided","route":"TEXTSEARCH","regionCandidate":"IL","language":"he","confidence":1,"reason":"explicit_city_mentioned","msg":"[ROUTE2] Intent routing decided (regionCandidate will be validated by filters_resolved)"}
{"level":"info","time":"2026-01-31T14:57:06.358Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","pipelineVersion":"route2","event":"parallel_started","route":"TEXTSEARCH","isGenericWithLocation":false,"skipBaseFilters":false,"hasUserLocation":false,"hasCityText":true,"msg":"[ROUTE2] Starting parallel tasks (base_filters + post_constraints)"}
{"level":"info","time":"2026-01-31T14:57:06.359Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","pipelineVersion":"route2","event":"base_filters_llm_started","query":"מסעדות   איטלקיות בתל אביב","route":"TEXTSEARCH","msg":"[ROUTE2] Base filters LLM started"}
{"level":"info","time":"2026-01-31T14:57:06.361Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","pipelineVersion":"route2","event":"google_parallel_started","regionCode":"IL","providerLanguage":"he","uiLanguage":"he","msg":"[ROUTE2] Starting Google fetch in parallel (early context derived)"}
{"level":"info","time":"2026-01-31T14:57:06.361Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","stage":"textsearch_mapper","event":"schema_check_before_llm","schemaId":"TEXTSEARCH_JSON_SCHEMA","schemaProperties":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"schemaPropertiesCount":12,"schemaRequired":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"schemaRequiredCount":12,"hasModeField":true,"schemaValid":true,"schemaHash":"textsearch_v5_keyed_freetext_mode"}
{"level":"info","time":"2026-01-31T14:57:06.364Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","stage":"textsearch_mapper","event":"schema_final_check","schemaType":"object","propertyKeys":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"requiredKeys":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"hasModeField":true,"additionalProperties":false,"isValid":true,"msg":"[TEXTSEARCH] Final schema check before OpenAI call"}
{"level":"info","time":"2026-01-31T14:57:06.905Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"fa8ac381-911c-4b50-84ec-7a86d960ccaa","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:57:06.906Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":3856,"updatedAgeMs":566,"progress":40,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 3856, updatedAgeMs: 566"}
{"level":"info","time":"2026-01-31T14:57:07.382Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","query":"מסעדות   איטלקיות בגדרה","status":"PENDING","hasOwner":true,"hasIdempotencyKey":true,"msg":"[RedisJobStore] Job created"}
{"level":"info","time":"2026-01-31T14:57:07.383Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","sessionHash":"2c3b20d765e7","hasUserId":false,"operation":"createJob","decision":"ACCEPTED","hasIdempotencyKey":true,"event":"job_created","msg":"[Observability] Job created with JWT session binding and idempotency key"}
{"level":"info","time":"2026-01-31T14:57:07.387Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","status":"RUNNING","progress":10,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:57:07.387Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","status":"RUNNING","progress":10,"event":"status_running","msg":"[Observability] Job status set to RUNNING"}
{"level":"info","time":"2026-01-31T14:57:07.387Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769871427374-hhp981mt5","event":"backlog_created","msg":"WebSocket backlog created for late subscribers"}
{"level":"info","time":"2026-01-31T14:57:07.388Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","pipelineVersion":"route2","event":"pipeline_selected","queryLen":23,"queryHash":"5555eae2a438","msg":"[ROUTE2] Pipeline selected"}
{"level":"info","time":"2026-01-31T14:57:07.388Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","pipelineVersion":"route2","event":"device_region_resolved","userRegionCode":"IL","userRegionSource":"config","msg":"[ROUTE2] Device region resolved"}
{"level":"info","time":"2026-01-31T14:57:07.388Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","traceId":"678cde2e-fa1d-47fe-941d-e5f08d3c5793","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_started","queryLen":23,"queryHash":"5555eae2a438","msg":"[ROUTE2] gate2 started"}
{"level":"info","time":"2026-01-31T14:57:07.396Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871385153-7yllhf","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:57:07.397Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871385153-7yllhf","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:57:07.397Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769871427374-hhp981mt5","count":1,"event":"backlog_drained","msg":"WebSocket backlog drained to late subscriber"}
{"level":"info","time":"2026-01-31T14:57:07.398Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871385153-7yllhf","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T14:57:07.398Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871385153-7yllhf","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T14:57:07.788Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"ee48845c-339e-4189-934a-23d13a84e059","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1428,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:57:07.788Z","model":"gpt-4o-mini","tokensIn":1466,"tokensOut":62,"totalTokens":1528,"schemaName":"response","schemaStrict":true,"schemaHash":"d2d4176c14f8","schemaVersion":"v1","promptVersion":"base_filters_v1","promptHash":"b24fef29feccd3ea093ed98af52e3a66b4790fa26ba4ac39bfb11465691690b1","promptLength":3191,"estimatedCostUsd":0.0002571,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:57:07.790Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","pipelineVersion":"route2","event":"base_filters_llm_completed","durationMs":1431,"language":"he","openState":null,"openAt":null,"openBetween":null,"priceIntent":null,"minRatingBucket":null,"minReviewCountBucket":null,"regionHint":"IL","tokenUsage":{"input":1466,"output":62,"total":1528,"model":"gpt-4o-mini"},"msg":"[ROUTE2] Base filters LLM completed"}
{"level":"info","time":"2026-01-31T14:57:07.820Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"ee48845c-339e-4189-934a-23d13a84e059","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1461,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:57:07.820Z","model":"gpt-4o-mini","tokensIn":1699,"tokensOut":61,"totalTokens":1760,"schemaName":"response","schemaStrict":true,"schemaHash":"9cb7c40fd303","schemaVersion":"v1","promptVersion":"post_constraints_v1","promptHash":"7a9eb00cc4c93e1a79c0b2b54a37ae3f0f136351e35eca7a675dba627252da53","estimatedCostUsd":0.00029144999999999996,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:57:08.071Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"678cde2e-fa1d-47fe-941d-e5f08d3c5793","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":681,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:57:08.070Z","model":"gpt-4o-mini","tokensIn":223,"tokensOut":12,"totalTokens":235,"schemaName":"response","schemaStrict":true,"schemaHash":"ecbf2c0a0457","schemaVersion":"v1","promptVersion":"gate2_v4","promptHash":"417e5c5eced45df60519ffa2d62a71e758d5dd81618a8f8dd394670184d7c480","promptLength":561,"estimatedCostUsd":0.00004065,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:57:08.072Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","traceId":"678cde2e-fa1d-47fe-941d-e5f08d3c5793","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_completed","durationMs":683,"route":"CONTINUE","foodSignal":"YES","confidence":0.95,"tokenUsage":{"input":223,"output":12,"total":235,"model":"gpt-4o-mini"},"msg":"[ROUTE2] gate2 completed"}
{"level":"info","time":"2026-01-31T14:57:08.074Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","status":"RUNNING","progress":25,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:57:08.075Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","traceId":"678cde2e-fa1d-47fe-941d-e5f08d3c5793","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"intent","event":"stage_started","queryLen":23,"queryHash":"5555eae2a438","msg":"[ROUTE2] intent started"}
{"level":"info","time":"2026-01-31T14:57:08.764Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"ee48845c-339e-4189-934a-23d13a84e059","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":2399,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:57:08.764Z","model":"gpt-4o-mini","tokensIn":967,"tokensOut":101,"totalTokens":1068,"schemaName":"response","schemaStrict":true,"schemaHash":"924556626f01","schemaVersion":"v1","promptVersion":"textsearch_mapper_v4_keyed_freetext","promptHash":"6ec296a5225613c761b0a90ee0f4c21f97678e5167324a48f11ec42152ee1caa","estimatedCostUsd":0.00020564999999999998,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:57:08.765Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"textsearch_mapper","promptVersion":"textsearch_mapper_v4_keyed_freetext","schemaHash":"textsearch_v5_keyed_freetext_mode","requestId":"req-1769871423049-pepujqibe","traceId":"ee48845c-339e-4189-934a-23d13a84e059","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3500,"timeoutHit":false,"buildPromptMs":0.11,"networkMs":2400.21,"parseMs":0.29,"totalMs":2400.68,"promptChars":2281,"inputTokens":967,"outputTokens":101,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:57:08.766Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","stage":"textsearch_mapper","event":"deterministic_builder_keyed","mode":"KEYED","cuisineKey":"italian","cityText":"תל אביב","cityEnglish":"Tel Aviv","providerTextQuery":"Italian restaurant in Tel Aviv","providerLanguage":"en","source":"deterministic_builder","msg":"[TEXTSEARCH] Built KEYED mode query (cuisine + city) - fully in English"}
{"level":"info","time":"2026-01-31T14:57:08.767Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","stage":"textsearch_mapper","event":"cuisine_terms_generated","cuisineKey":"italian","searchLanguage":"he","requiredTerms":["איטלקית","איטלקי"],"preferredTerms":["פסטה","פיצה","ריזוטו"],"msg":"[TEXTSEARCH] Generated cuisine terms from cuisineKey"}
{"level":"info","time":"2026-01-31T14:57:08.768Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","stage":"textsearch_mapper","event":"bias_planned","source":"cityCenter_pending_geocode","cityText":"תל אביב","intentReason":"explicit_city_mentioned","note":"explicit_city_preferred_over_userLocation","msg":"[TEXTSEARCH] City-center bias planned (explicit city takes priority over userLocation)"}
{"level":"info","time":"2026-01-31T14:57:08.768Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","stage":"textsearch_mapper","event":"mapper_success","mode":"KEYED","cuisineKey":"italian","cityText":"תל אביב","providerTextQuery":"Italian restaurant in Tel Aviv","providerLanguage":"en","source":"deterministic_builder_keyed","strictness":"STRICT","msg":"[TEXTSEARCH] Mapper completed successfully"}
{"level":"info","time":"2026-01-31T14:57:08.769Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","pipelineVersion":"route2","event":"route_llm_mapped","providerMethod":"textSearch","region":"IL","language":"he","msg":"[ROUTE2] Route-LLM mapping completed (using early context)"}
{"level":"info","time":"2026-01-31T14:57:08.769Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","pipelineVersion":"route2","stage":"google_maps","event":"stage_started","providerMethod":"textSearch","region":"IL","language":"he","msg":"[ROUTE2] google_maps started"}
{"level":"info","time":"2026-01-31T14:57:08.770Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","provider":"google_places_new","method":"searchText","providerTextQuery":"Italian restaurant in Tel Aviv","providerLanguage":"en","region":"IL","hasBiasPlanned":true,"biasSource":"cityText_pending_geocode","mode":"KEYED","cityText":"תל אביב","msg":"[GOOGLE] Calling Text Search API (New) - using providerTextQuery/providerLanguage"}
{"level":"info","time":"2026-01-31T14:57:08.771Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"CACHE_WRAP_ENTER","providerMethod":"textSearch","cacheKey":"g:textsearch:744a535eee3f3b38f578d22fea51ea90","ttlSeconds":900}
{"level":"info","time":"2026-01-31T14:57:08.772Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","pipelineVersion":"route2","event":"google_parallel_awaited","parallelDurationMs":2411,"msg":"[ROUTE2] Awaiting Google results + base_filters/post_constraints (barrier)"}
{"level":"info","time":"2026-01-31T14:57:08.772Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","pipelineVersion":"route2","event":"await_base_filters","msg":"[ROUTE2] Awaiting base filters"}
{"level":"info","time":"2026-01-31T14:57:08.773Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"language_context_resolved","uiLanguage":"he","queryLanguage":"he","intentLanguage":"he","intentLanguageConfidence":1,"assistantLanguage":"he","searchLanguage":"he","providerLanguage":"he","regionCode":"IL","sources":{"assistantLanguage":"query_language_deterministic","searchLanguage":"query_language_policy"},"providerLanguagePolicy":"queryLanguage","msg":"[LANGUAGE] Language context resolved with strict separation"}
{"level":"info","time":"2026-01-31T14:57:08.774Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","pipelineVersion":"route2","event":"filters_resolved","base":{"language":"he","openState":null,"openAt":null,"openBetween":null,"priceIntent":null,"minRatingBucket":null,"regionHint":"IL"},"final":{"uiLanguage":"he","providerLanguage":"he","openState":null,"openAt":null,"openBetween":null,"priceIntent":null,"minRatingBucket":null,"regionCode":"IL"},"sanitized":false,"msg":"[ROUTE2] Filters resolved"}
{"level":"info","time":"2026-01-31T14:57:08.775Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"google_textsearch_using_provider_fields","providerTextQuery":"Italian restaurant in Tel Aviv","providerLanguage":"en","mode":"KEYED","source":"mapper_deterministic_builder","msg":"[GOOGLE] Using providerTextQuery/providerLanguage from mapper"}
{"level":"info","time":"2026-01-31T14:57:08.777Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"city_center_resolved","cityText":"תל אביב","lat":32.0852999,"lng":34.78176759999999,"servedFromCache":true,"radiusMeters":10000,"hadOriginalBias":false,"biasSource":"cityCenter","msg":"[GOOGLE] City center resolved, applying city-center bias"}
{"level":"info","time":"2026-01-31T14:57:08.778Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"google_call_language","providerMethod":"textSearch","languageCode":"en","providerLanguage":"en","regionCode":"IL","providerTextQuery":"Italian restaurant in Tel Aviv","mode":"KEYED","languageSource":"mapper_deterministic_builder","msg":"[GOOGLE] Text Search API call language (from mapper providerLanguage)"}
{"level":"info","time":"2026-01-31T14:57:08.779Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"textsearch_request_payload","providerTextQuery":"Italian restaurant in Tel Aviv","textQueryLen":30,"textQueryHash":"398fb196158d","mode":"KEYED","hasExplicitCity":true,"languageCode":"en","regionCode":"IL","regionCodeSent":true,"hasBiasApplied":true,"biasSource":"cityCenter","biasLat":32.0852999,"biasLng":34.78176759999999,"biasRadiusMeters":10000,"maxResultCount":20,"msg":"[GOOGLE] Text Search request payload (providerTextQuery)"}
{"level":"info","time":"2026-01-31T14:57:08.780Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"google_textsearch_bias_applied","biasType":"cityCenter","lat":32.0852999,"lng":34.78176759999999,"radiusMeters":10000,"msg":"[GOOGLE] Location bias ACTUALLY applied to Google request"}
{"level":"info","time":"2026-01-31T14:57:08.780Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"google_textsearch_page","page":1,"maxResults":20,"maxPages":3,"textQuery":"Italian restaurant in Tel Aviv","msg":"[GOOGLE] Fetching page 1"}
{"level":"info","time":"2026-01-31T14:57:09.578Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"678cde2e-fa1d-47fe-941d-e5f08d3c5793","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1503,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:57:09.578Z","model":"gpt-4o-mini","tokensIn":1601,"tokensOut":81,"totalTokens":1682,"schemaName":"response","schemaStrict":true,"schemaHash":"f731e75551db","schemaVersion":"v1","promptVersion":"intent_v4","promptHash":"7d0cb4f0f10cec33408d81bef29a9ab039df93163813d0fb2660eb8dda9adb95","estimatedCostUsd":0.00028875,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:57:09.580Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"intent","promptVersion":"intent_v4","schemaHash":"f58b8106b963","requestId":"req-1769871427374-hhp981mt5","traceId":"678cde2e-fa1d-47fe-941d-e5f08d3c5793","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3500,"timeoutHit":false,"buildPromptMs":0.05,"networkMs":1504.6,"parseMs":0.35,"totalMs":1505.1,"promptChars":4880,"inputTokens":1601,"outputTokens":81,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:57:09.581Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","traceId":"678cde2e-fa1d-47fe-941d-e5f08d3c5793","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"intent","event":"stage_completed","durationMs":1506,"route":"TEXTSEARCH","confidence":1,"reason":"explicit_city_mentioned","msg":"[ROUTE2] intent completed"}
{"level":"info","time":"2026-01-31T14:57:09.600Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","status":"RUNNING","progress":40,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:57:09.601Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","pipelineVersion":"route2","event":"intent_decided","route":"TEXTSEARCH","regionCandidate":"IL","language":"he","confidence":1,"reason":"explicit_city_mentioned","msg":"[ROUTE2] Intent routing decided (regionCandidate will be validated by filters_resolved)"}
{"level":"info","time":"2026-01-31T14:57:09.602Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","pipelineVersion":"route2","event":"parallel_started","route":"TEXTSEARCH","isGenericWithLocation":false,"skipBaseFilters":false,"hasUserLocation":false,"hasCityText":true,"msg":"[ROUTE2] Starting parallel tasks (base_filters + post_constraints)"}
{"level":"info","time":"2026-01-31T14:57:09.603Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","pipelineVersion":"route2","event":"base_filters_llm_started","query":"מסעדות   איטלקיות בגדרה","route":"TEXTSEARCH","msg":"[ROUTE2] Base filters LLM started"}
{"level":"info","time":"2026-01-31T14:57:09.605Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","pipelineVersion":"route2","event":"google_parallel_started","regionCode":"IL","providerLanguage":"he","uiLanguage":"he","msg":"[ROUTE2] Starting Google fetch in parallel (early context derived)"}
{"level":"info","time":"2026-01-31T14:57:09.606Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","stage":"textsearch_mapper","event":"schema_check_before_llm","schemaId":"TEXTSEARCH_JSON_SCHEMA","schemaProperties":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"schemaPropertiesCount":12,"schemaRequired":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"schemaRequiredCount":12,"hasModeField":true,"schemaValid":true,"schemaHash":"textsearch_v5_keyed_freetext_mode"}
{"level":"info","time":"2026-01-31T14:57:09.607Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","stage":"textsearch_mapper","event":"schema_final_check","schemaType":"object","propertyKeys":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"requiredKeys":["providerMethod","mode","region","language","reason","cuisineKey","placeTypeKey","cityText","requiredTerms","preferredTerms","strictness","typeHint"],"hasModeField":true,"additionalProperties":false,"isValid":true,"msg":"[TEXTSEARCH] Final schema check before OpenAI call"}
{"level":"info","time":"2026-01-31T14:57:09.637Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"google_textsearch_page","page":1,"fetchedCount":20,"cumulativeCount":20,"hasNextPageToken":false,"msg":"[GOOGLE] Page 1 completed"}
{"level":"info","time":"2026-01-31T14:57:09.637Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"google_textsearch_aggregated","requested":20,"returned":20,"pagesUsed":1,"maxPagesAllowed":3,"totalFetched":20,"duplicatesRemoved":0,"stopReason":"max_results_reached","hadMorePages":false,"msg":"[GOOGLE] Text Search aggregated results"}
{"level":"info","time":"2026-01-31T14:57:09.685Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"CACHE_WRAP_EXIT","providerMethod":"textSearch","servedFrom":"google_api","cacheTier":"MISS","durationMs":915}
{"level":"info","time":"2026-01-31T14:57:09.685Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","provider":"google_places_new","method":"searchText","durationMs":915,"resultCount":20,"fieldMaskUsed":"places.id,places.displayName,places.formattedAddress,places.location,places.rating,places.userRatingCount,places.priceLevel,places.currentOpeningHours,places.regularOpeningHours,places.utcOffsetMinutes,places.photos,places.types,places.googleMapsUri","servedFrom":"google_api","msg":"[GOOGLE] Text Search completed"}
{"level":"info","time":"2026-01-31T14:57:09.686Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","pipelineVersion":"route2","stage":"google_maps","event":"stage_completed","durationMs":916,"providerMethod":"textSearch","resultCount":20,"region":"IL","language":"he","msg":"[ROUTE2] google_maps completed"}
{"level":"info","time":"2026-01-31T14:57:09.686Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","pipelineVersion":"route2","event":"google_parallel_completed","totalDurationMs":3325,"googleDurationMs":916,"criticalPathSavedMs":2409,"msg":"[ROUTE2] Google fetch completed (parallel optimization saved time)"}
{"level":"info","time":"2026-01-31T14:57:09.688Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","status":"RUNNING","progress":60,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:57:09.688Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","pipelineVersion":"route2","event":"cuisine_enforcement_started","strictness":"STRICT","requiredTerms":["איטלקית","איטלקי"],"preferredTerms":["פסטה","פיצה","ריזוטו"],"countIn":20,"hardConstraintsExist":false,"hardConstraintsActive":[],"msg":"[ROUTE2] Starting cuisine enforcement"}
{"level":"info","time":"2026-01-31T14:57:09.688Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":20,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:57:09.689Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":2,"preferredTermsCount":3,"placesCount":20,"promptChars":2371,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:57:10.929Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"678cde2e-fa1d-47fe-941d-e5f08d3c5793","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1325,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:57:10.929Z","model":"gpt-4o-mini","tokensIn":1465,"tokensOut":62,"totalTokens":1527,"schemaName":"response","schemaStrict":true,"schemaHash":"d2d4176c14f8","schemaVersion":"v1","promptVersion":"base_filters_v1","promptHash":"b24fef29feccd3ea093ed98af52e3a66b4790fa26ba4ac39bfb11465691690b1","promptLength":3191,"estimatedCostUsd":0.00025695,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:57:10.929Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","pipelineVersion":"route2","event":"base_filters_llm_completed","durationMs":1326,"language":"he","openState":null,"openAt":null,"openBetween":null,"priceIntent":null,"minRatingBucket":null,"minReviewCountBucket":null,"regionHint":"IL","tokenUsage":{"input":1465,"output":62,"total":1527,"model":"gpt-4o-mini"},"msg":"[ROUTE2] Base filters LLM completed"}
{"level":"info","time":"2026-01-31T14:57:10.966Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"678cde2e-fa1d-47fe-941d-e5f08d3c5793","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1363,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:57:10.966Z","model":"gpt-4o-mini","tokensIn":1698,"tokensOut":61,"totalTokens":1759,"schemaName":"response","schemaStrict":true,"schemaHash":"9cb7c40fd303","schemaVersion":"v1","promptVersion":"post_constraints_v1","promptHash":"7a9eb00cc4c93e1a79c0b2b54a37ae3f0f136351e35eca7a675dba627252da53","estimatedCostUsd":0.0002913,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:57:11.631Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"678cde2e-fa1d-47fe-941d-e5f08d3c5793","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":2023,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:57:11.631Z","model":"gpt-4o-mini","tokensIn":966,"tokensOut":100,"totalTokens":1066,"schemaName":"response","schemaStrict":true,"schemaHash":"924556626f01","schemaVersion":"v1","promptVersion":"textsearch_mapper_v4_keyed_freetext","promptHash":"6ec296a5225613c761b0a90ee0f4c21f97678e5167324a48f11ec42152ee1caa","estimatedCostUsd":0.0002049,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:57:11.632Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"textsearch_mapper","promptVersion":"textsearch_mapper_v4_keyed_freetext","schemaHash":"textsearch_v5_keyed_freetext_mode","requestId":"req-1769871427374-hhp981mt5","traceId":"678cde2e-fa1d-47fe-941d-e5f08d3c5793","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3500,"timeoutHit":false,"buildPromptMs":0.2,"networkMs":2024.3,"parseMs":0.22,"totalMs":2024.85,"promptChars":2278,"inputTokens":966,"outputTokens":100,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:57:11.633Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","stage":"textsearch_mapper","event":"deterministic_builder_keyed","mode":"KEYED","cuisineKey":"italian","cityText":"גדרה","cityEnglish":"Gedera","providerTextQuery":"Italian restaurant in Gedera","providerLanguage":"en","source":"deterministic_builder","msg":"[TEXTSEARCH] Built KEYED mode query (cuisine + city) - fully in English"}
{"level":"info","time":"2026-01-31T14:57:11.634Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","stage":"textsearch_mapper","event":"cuisine_terms_generated","cuisineKey":"italian","searchLanguage":"he","requiredTerms":["איטלקית","איטלקי"],"preferredTerms":["פסטה","פיצה","ריזוטו"],"msg":"[TEXTSEARCH] Generated cuisine terms from cuisineKey"}
{"level":"info","time":"2026-01-31T14:57:11.634Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","stage":"textsearch_mapper","event":"bias_planned","source":"cityCenter_pending_geocode","cityText":"גדרה","intentReason":"explicit_city_mentioned","note":"explicit_city_preferred_over_userLocation","msg":"[TEXTSEARCH] City-center bias planned (explicit city takes priority over userLocation)"}
{"level":"info","time":"2026-01-31T14:57:11.635Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","stage":"textsearch_mapper","event":"mapper_success","mode":"KEYED","cuisineKey":"italian","cityText":"גדרה","providerTextQuery":"Italian restaurant in Gedera","providerLanguage":"en","source":"deterministic_builder_keyed","strictness":"STRICT","msg":"[TEXTSEARCH] Mapper completed successfully"}
{"level":"info","time":"2026-01-31T14:57:11.635Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","pipelineVersion":"route2","event":"route_llm_mapped","providerMethod":"textSearch","region":"IL","language":"he","msg":"[ROUTE2] Route-LLM mapping completed (using early context)"}
{"level":"info","time":"2026-01-31T14:57:11.635Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","pipelineVersion":"route2","stage":"google_maps","event":"stage_started","providerMethod":"textSearch","region":"IL","language":"he","msg":"[ROUTE2] google_maps started"}
{"level":"info","time":"2026-01-31T14:57:11.636Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","provider":"google_places_new","method":"searchText","providerTextQuery":"Italian restaurant in Gedera","providerLanguage":"en","region":"IL","hasBiasPlanned":true,"biasSource":"cityText_pending_geocode","mode":"KEYED","cityText":"גדרה","msg":"[GOOGLE] Calling Text Search API (New) - using providerTextQuery/providerLanguage"}
{"level":"info","time":"2026-01-31T14:57:11.636Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"CACHE_WRAP_ENTER","providerMethod":"textSearch","cacheKey":"g:textsearch:d1ccfda2e0da8ab41bc2bc2526d264cc","ttlSeconds":900}
{"level":"info","time":"2026-01-31T14:57:11.637Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","pipelineVersion":"route2","event":"google_parallel_awaited","parallelDurationMs":2032,"msg":"[ROUTE2] Awaiting Google results + base_filters/post_constraints (barrier)"}
{"level":"info","time":"2026-01-31T14:57:11.637Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","pipelineVersion":"route2","event":"await_base_filters","msg":"[ROUTE2] Awaiting base filters"}
{"level":"info","time":"2026-01-31T14:57:11.638Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"language_context_resolved","uiLanguage":"he","queryLanguage":"he","intentLanguage":"he","intentLanguageConfidence":1,"assistantLanguage":"he","searchLanguage":"he","providerLanguage":"he","regionCode":"IL","sources":{"assistantLanguage":"query_language_deterministic","searchLanguage":"query_language_policy"},"providerLanguagePolicy":"queryLanguage","msg":"[LANGUAGE] Language context resolved with strict separation"}
{"level":"info","time":"2026-01-31T14:57:11.639Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","pipelineVersion":"route2","event":"filters_resolved","base":{"language":"he","openState":null,"openAt":null,"openBetween":null,"priceIntent":null,"minRatingBucket":null,"regionHint":"IL"},"final":{"uiLanguage":"he","providerLanguage":"he","openState":null,"openAt":null,"openBetween":null,"priceIntent":null,"minRatingBucket":null,"regionCode":"IL"},"sanitized":false,"msg":"[ROUTE2] Filters resolved"}
{"level":"info","time":"2026-01-31T14:57:11.640Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"google_textsearch_using_provider_fields","providerTextQuery":"Italian restaurant in Gedera","providerLanguage":"en","mode":"KEYED","source":"mapper_deterministic_builder","msg":"[GOOGLE] Using providerTextQuery/providerLanguage from mapper"}
{"level":"info","time":"2026-01-31T14:57:11.896Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"city_center_resolved","cityText":"גדרה","lat":31.8120082,"lng":34.7774347,"servedFromCache":false,"radiusMeters":10000,"hadOriginalBias":false,"biasSource":"cityCenter","msg":"[GOOGLE] City center resolved, applying city-center bias"}
{"level":"info","time":"2026-01-31T14:57:11.897Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"google_call_language","providerMethod":"textSearch","languageCode":"en","providerLanguage":"en","regionCode":"IL","providerTextQuery":"Italian restaurant in Gedera","mode":"KEYED","languageSource":"mapper_deterministic_builder","msg":"[GOOGLE] Text Search API call language (from mapper providerLanguage)"}
{"level":"info","time":"2026-01-31T14:57:11.897Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"textsearch_request_payload","providerTextQuery":"Italian restaurant in Gedera","textQueryLen":28,"textQueryHash":"9b7a4b7584dc","mode":"KEYED","hasExplicitCity":true,"languageCode":"en","regionCode":"IL","regionCodeSent":true,"hasBiasApplied":true,"biasSource":"cityCenter","biasLat":31.8120082,"biasLng":34.7774347,"biasRadiusMeters":10000,"maxResultCount":20,"msg":"[GOOGLE] Text Search request payload (providerTextQuery)"}
{"level":"info","time":"2026-01-31T14:57:11.898Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"google_textsearch_bias_applied","biasType":"cityCenter","lat":31.8120082,"lng":34.7774347,"radiusMeters":10000,"msg":"[GOOGLE] Location bias ACTUALLY applied to Google request"}
{"level":"info","time":"2026-01-31T14:57:11.898Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"google_textsearch_page","page":1,"maxResults":20,"maxPages":3,"textQuery":"Italian restaurant in Gedera","msg":"[GOOGLE] Fetching page 1"}
{"level":"info","time":"2026-01-31T14:57:12.090Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"37d677ca-8c8d-4ab4-96a3-1f26753f2b28","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:57:12.091Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":4713,"updatedAgeMs":2506,"progress":40,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 4713, updatedAgeMs: 2506"}
{"level":"info","time":"2026-01-31T14:57:12.444Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"google_textsearch_page","page":1,"fetchedCount":6,"cumulativeCount":6,"hasNextPageToken":false,"msg":"[GOOGLE] Page 1 completed"}
{"level":"info","time":"2026-01-31T14:57:12.444Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"google_textsearch_aggregated","requested":20,"returned":6,"pagesUsed":1,"maxPagesAllowed":3,"totalFetched":6,"duplicatesRemoved":0,"stopReason":"no_more_pages","hadMorePages":false,"msg":"[GOOGLE] Text Search aggregated results"}
{"level":"info","time":"2026-01-31T14:57:12.494Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"CACHE_WRAP_EXIT","providerMethod":"textSearch","servedFrom":"google_api","cacheTier":"MISS","durationMs":858}
{"level":"info","time":"2026-01-31T14:57:12.494Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","provider":"google_places_new","method":"searchText","durationMs":858,"resultCount":6,"fieldMaskUsed":"places.id,places.displayName,places.formattedAddress,places.location,places.rating,places.userRatingCount,places.priceLevel,places.currentOpeningHours,places.regularOpeningHours,places.utcOffsetMinutes,places.photos,places.types,places.googleMapsUri","servedFrom":"google_api","msg":"[GOOGLE] Text Search completed"}
{"level":"info","time":"2026-01-31T14:57:12.494Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","pipelineVersion":"route2","stage":"google_maps","event":"stage_completed","durationMs":859,"providerMethod":"textSearch","resultCount":6,"region":"IL","language":"he","msg":"[ROUTE2] google_maps completed"}
{"level":"info","time":"2026-01-31T14:57:12.494Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","pipelineVersion":"route2","event":"google_parallel_completed","totalDurationMs":2889,"googleDurationMs":859,"criticalPathSavedMs":2030,"msg":"[ROUTE2] Google fetch completed (parallel optimization saved time)"}
{"level":"info","time":"2026-01-31T14:57:12.496Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","status":"RUNNING","progress":60,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:57:12.497Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","pipelineVersion":"route2","event":"cuisine_enforcement_started","strictness":"STRICT","requiredTerms":["איטלקית","איטלקי"],"preferredTerms":["פסטה","פיצה","ריזוטו"],"countIn":6,"hardConstraintsExist":false,"hardConstraintsActive":[],"msg":"[ROUTE2] Starting cuisine enforcement"}
{"level":"info","time":"2026-01-31T14:57:12.497Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"cuisine_policy_selected","policy":"SOFT_BOOST","reason":"score_only_mode","countIn":6,"msg":"[CUISINE_ENFORCER] BOOST-only mode (score-only, never filter)"}
{"level":"info","time":"2026-01-31T14:57:12.497Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"cuisine_enforcement_llm_call","version":"cuisine_enforcer_v3_compact","requiredTermsCount":2,"preferredTermsCount":3,"placesCount":6,"promptChars":912,"model":"gpt-4o-mini","schemaHash":"8ab9e27fe722","msg":"[CUISINE_ENFORCER] Calling LLM for scoring"}
{"level":"info","time":"2026-01-31T14:57:13.663Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"15856e83-9f74-4509-be22-ce4336873b6c","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:57:13.664Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":6286,"updatedAgeMs":1168,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 6286, updatedAgeMs: 1168"}
{"level":"warn","time":"2026-01-31T14:57:13.705Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","provider":"openai","operation":"completeJSON","latencyMs":4015,"success":false,"retryCount":0,"errorCode":"Error","errorReason":"Request was aborted.","timestamp":"2026-01-31T14:57:13.705Z","msg":"Provider call failed: openai.completeJSON"}
{"level":"warn","time":"2026-01-31T14:57:13.705Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"cuisine_enforcer","promptVersion":"unknown","requestId":"req-1769871423049-pepujqibe","attempt":1,"model":"gpt-4o-mini","timeoutMs":4000,"timeoutHit":true,"buildPromptMs":0.04,"networkMs":4016.04,"parseMs":0,"totalMs":4016.1,"promptChars":2371,"inputTokens":null,"outputTokens":null,"retriesCount":0,"success":false,"errorType":"abort_timeout","errorReason":"Request aborted or timeout","statusCode":null,"msg":"llm_gate_timing"}
{"level":"warn","time":"2026-01-31T14:57:13.705Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":1,"maxAttempts":3,"errorType":"abort_timeout","msg":"[LLM] Timeout, will retry with backoff"}
{"level":"warn","time":"2026-01-31T14:57:13.705Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":1,"maxAttempts":3,"msg":"[LLM] Retriable transport error"}
{"level":"info","time":"2026-01-31T14:57:15.086Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"87c54f3a-9fbd-43be-9a16-f4973df61a6b","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:57:15.087Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":7709,"updatedAgeMs":2591,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 7709, updatedAgeMs: 2591"}
{"level":"warn","time":"2026-01-31T14:57:16.504Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","provider":"openai","operation":"completeJSON","latencyMs":4007,"success":false,"retryCount":0,"errorCode":"Error","errorReason":"Request was aborted.","timestamp":"2026-01-31T14:57:16.504Z","msg":"Provider call failed: openai.completeJSON"}
{"level":"warn","time":"2026-01-31T14:57:16.504Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"cuisine_enforcer","promptVersion":"unknown","requestId":"req-1769871427374-hhp981mt5","attempt":1,"model":"gpt-4o-mini","timeoutMs":4000,"timeoutHit":true,"buildPromptMs":0.04,"networkMs":4007.13,"parseMs":0,"totalMs":4007.2,"promptChars":912,"inputTokens":null,"outputTokens":null,"retriesCount":0,"success":false,"errorType":"abort_timeout","errorReason":"Request aborted or timeout","statusCode":null,"msg":"llm_gate_timing"}
{"level":"warn","time":"2026-01-31T14:57:16.505Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":1,"maxAttempts":3,"errorType":"abort_timeout","msg":"[LLM] Timeout, will retry with backoff"}
{"level":"warn","time":"2026-01-31T14:57:16.505Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":1,"maxAttempts":3,"msg":"[LLM] Retriable transport error"}
{"level":"info","time":"2026-01-31T14:57:17.106Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"f0844e42-4220-497c-95bf-45110a386ed2","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:57:17.107Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":9729,"updatedAgeMs":4611,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 9729, updatedAgeMs: 4611"}
{"level":"warn","time":"2026-01-31T14:57:17.970Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","provider":"openai","operation":"completeJSON","latencyMs":4004,"success":false,"retryCount":1,"errorCode":"Error","errorReason":"Request was aborted.","timestamp":"2026-01-31T14:57:17.970Z","msg":"Provider call failed: openai.completeJSON"}
{"level":"warn","time":"2026-01-31T14:57:17.971Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"cuisine_enforcer","promptVersion":"unknown","requestId":"req-1769871423049-pepujqibe","attempt":2,"model":"gpt-4o-mini","timeoutMs":4000,"timeoutHit":true,"buildPromptMs":0.04,"networkMs":4004.61,"parseMs":0,"totalMs":8281.75,"promptChars":2371,"inputTokens":null,"outputTokens":null,"retriesCount":1,"success":false,"errorType":"abort_timeout","errorReason":"Request aborted or timeout","statusCode":null,"msg":"llm_gate_timing"}
{"level":"warn","time":"2026-01-31T14:57:17.971Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":2,"maxAttempts":3,"errorType":"abort_timeout","msg":"[LLM] Timeout, will retry with backoff"}
{"level":"warn","time":"2026-01-31T14:57:17.971Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":2,"maxAttempts":3,"msg":"[LLM] Retriable transport error"}
{"level":"info","time":"2026-01-31T14:57:19.096Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"13ebfff4-7827-489b-84e5-d9980c4cf2bd","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:57:19.097Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":11719,"updatedAgeMs":6601,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 11719, updatedAgeMs: 6601"}
{"level":"warn","time":"2026-01-31T14:57:20.761Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","provider":"openai","operation":"completeJSON","latencyMs":4005,"success":false,"retryCount":1,"errorCode":"Error","errorReason":"Request was aborted.","timestamp":"2026-01-31T14:57:20.761Z","msg":"Provider call failed: openai.completeJSON"}
{"level":"warn","time":"2026-01-31T14:57:20.762Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"cuisine_enforcer","promptVersion":"unknown","requestId":"req-1769871427374-hhp981mt5","attempt":2,"model":"gpt-4o-mini","timeoutMs":4000,"timeoutHit":true,"buildPromptMs":0.04,"networkMs":4004.9,"parseMs":0,"totalMs":8264.24,"promptChars":912,"inputTokens":null,"outputTokens":null,"retriesCount":1,"success":false,"errorType":"abort_timeout","errorReason":"Request aborted or timeout","statusCode":null,"msg":"llm_gate_timing"}
{"level":"warn","time":"2026-01-31T14:57:20.762Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":2,"maxAttempts":3,"errorType":"abort_timeout","msg":"[LLM] Timeout, will retry with backoff"}
{"level":"warn","time":"2026-01-31T14:57:20.762Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":2,"maxAttempts":3,"msg":"[LLM] Retriable transport error"}
{"level":"info","time":"2026-01-31T14:57:21.100Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"4a1abbbd-d3d6-439e-b5f7-9aa0b7e0d8fc","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:57:21.103Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":13725,"updatedAgeMs":8607,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 13725, updatedAgeMs: 8607"}
{"level":"warn","time":"2026-01-31T14:57:22.741Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","provider":"openai","operation":"completeJSON","latencyMs":4016,"success":false,"retryCount":2,"errorCode":"Error","errorReason":"Request was aborted.","timestamp":"2026-01-31T14:57:22.741Z","msg":"Provider call failed: openai.completeJSON"}
{"level":"warn","time":"2026-01-31T14:57:22.742Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"cuisine_enforcer","promptVersion":"unknown","requestId":"req-1769871423049-pepujqibe","attempt":3,"model":"gpt-4o-mini","timeoutMs":4000,"timeoutHit":true,"buildPromptMs":0.04,"networkMs":4017.05,"parseMs":0,"totalMs":13053.08,"promptChars":2371,"inputTokens":null,"outputTokens":null,"retriesCount":2,"success":false,"errorType":"abort_timeout","errorReason":"Request aborted or timeout","statusCode":null,"msg":"llm_gate_timing"}
{"level":"warn","time":"2026-01-31T14:57:22.742Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":3,"maxAttempts":3,"errorType":"abort_timeout","msg":"[LLM] Timeout, will retry with backoff"}
{"level":"warn","time":"2026-01-31T14:57:22.742Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":3,"maxAttempts":3,"msg":"[LLM] Retriable transport error"}
{"level":"error","time":"2026-01-31T14:57:22.742Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempts":3,"msg":"[LLM] All retry attempts exhausted"}
{"level":"error","time":"2026-01-31T14:57:22.743Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"cuisine_enforcement_llm_failed","error":"Request was aborted.","msg":"[CUISINE_ENFORCER] LLM call failed, returning all places"}
{"level":"info","time":"2026-01-31T14:57:22.743Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"cuisine_scores_attached","scoresAttached":0,"resultsCount":20,"msg":"[ROUTE2] Cuisine scores attached to results for ranking"}
{"level":"info","time":"2026-01-31T14:57:22.743Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","pipelineVersion":"route2","event":"cuisine_enforcement_completed","countIn":20,"countOut":20,"relaxApplied":false,"relaxStrategy":"none","hasScores":true,"msg":"[ROUTE2] Cuisine enforcement completed"}
{"level":"info","time":"2026-01-31T14:57:22.743Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"cuisine_score_only_applied","countIn":20,"countOut":20,"mode":"SCORE_ONLY","msg":"[ROUTE2] Cuisine score-only mode: all results kept for ranking"}
{"level":"info","time":"2026-01-31T14:57:22.744Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","pipelineVersion":"route2","event":"await_post_constraints","msg":"[ROUTE2] Awaiting post constraints (late)"}
{"level":"info","time":"2026-01-31T14:57:22.748Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","status":"RUNNING","progress":75,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:57:22.748Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"ranking_input_order","count":20,"first10":[{"idx":0,"placeId":"ChIJ3fIA445LHRURFH_Ww1-rgMU","rating":4.5,"userRatingCount":7775},{"idx":1,"placeId":"ChIJo0OgbHxLHRUR-H4Z3uvx4yE","rating":4.5,"userRatingCount":4184},{"idx":2,"placeId":"ChIJ9-f71oVLHRUR65-qoTt6ClA","rating":4.4,"userRatingCount":1987},{"idx":3,"placeId":"ChIJde8TB3lMHRURFfTQ_m8LXxE","rating":4.3,"userRatingCount":2845},{"idx":4,"placeId":"ChIJbXsPa6JLHRURUmOpvub-dP4","rating":4.4,"userRatingCount":5987},{"idx":5,"placeId":"ChIJ4V7XfHtLHRURBpQlGeZSFfE","rating":4.3,"userRatingCount":6212},{"idx":6,"placeId":"ChIJfWhTHo1LHRUR6CVSjAEJq8Q","rating":4.2,"userRatingCount":3074},{"idx":7,"placeId":"ChIJq9Pf3ZxMHRURs_cAkicRJUQ","rating":4.5,"userRatingCount":3273},{"idx":8,"placeId":"ChIJYVEHnL1MHRUR5XLdVdFWp_4","rating":4.4,"userRatingCount":3299},{"idx":9,"placeId":"ChIJG8_Bm4xLHRURX3UgepOdWNY","rating":4.3,"userRatingCount":3205}],"orderSource":"google","reordered":false,"msg":"[RANKING] Input order (Google)"}
{"level":"info","time":"2026-01-31T14:57:22.749Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"ranking_profile_selected","profile":"NO_LOCATION","weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"reason":"no_user_location","cuisineKey":"italian","route":"TEXTSEARCH","source":"deterministic","msg":"[RANKING] No user location - using NO_LOCATION profile (distance weight = 0)"}
{"level":"info","time":"2026-01-31T14:57:22.749Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"ranking_distance_origin_selected","origin":"CITY_CENTER","cityText":"תל אביב","hadUserLocation":false,"refLatLng":{"lat":32.0852999,"lng":34.78176759999999},"intentReason":"explicit_city_mentioned","msg":"[RANKING] Distance origin: CITY_CENTER"}
{"level":"info","time":"2026-01-31T14:57:22.751Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"ranking_output_order","count":20,"first10":[{"idx":0,"placeId":"ChIJ3fIA445LHRURFH_Ww1-rgMU","rating":4.5,"userRatingCount":7775},{"idx":1,"placeId":"ChIJkUY0sH9MHRURTXu1bunhaDg","rating":4.6,"userRatingCount":2883},{"idx":2,"placeId":"ChIJ64mVj4VLHRUR43JF7ysTGzU","rating":4.8,"userRatingCount":1522},{"idx":3,"placeId":"ChIJq9Pf3ZxMHRURs_cAkicRJUQ","rating":4.5,"userRatingCount":3273},{"idx":4,"placeId":"ChIJbzT7mZNJHRURPISUNUQVAls","rating":4.4,"userRatingCount":3843},{"idx":5,"placeId":"ChIJYVEHnL1MHRUR5XLdVdFWp_4","rating":4.4,"userRatingCount":3299},{"idx":6,"placeId":"ChIJ2_4xdfJLHRURuc_fSew1DLY","rating":4.4,"userRatingCount":2473},{"idx":7,"placeId":"ChIJG8_Bm4xLHRURX3UgepOdWNY","rating":4.3,"userRatingCount":3205},{"idx":8,"placeId":"ChIJde8TB3lMHRURFfTQ_m8LXxE","rating":4.3,"userRatingCount":2845},{"idx":9,"placeId":"ChIJzTkFDYBLHRURpcKxDST7nk8","rating":4.2,"userRatingCount":3502}],"orderSource":"ranking","reordered":true,"msg":"[RANKING] Output order (ranked)"}
{"level":"info","time":"2026-01-31T14:57:22.751Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"ranking_score_breakdown","profile":"BALANCED","top10":[{"placeId":"ChIJ3fIA445LHRURFH_Ww1-rgMU","rating":4.5,"userRatingCount":7775,"distanceMeters":204,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.36,"reviewsScore":0.272,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.807},{"placeId":"ChIJkUY0sH9MHRURTXu1bunhaDg","rating":4.6,"userRatingCount":2883,"distanceMeters":1393,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.368,"reviewsScore":0.242,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.785},{"placeId":"ChIJ64mVj4VLHRUR43JF7ysTGzU","rating":4.8,"userRatingCount":1522,"distanceMeters":539,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.384,"reviewsScore":0.223,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.782},{"placeId":"ChIJq9Pf3ZxMHRURs_cAkicRJUQ","rating":4.5,"userRatingCount":3273,"distanceMeters":2655,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.36,"reviewsScore":0.246,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.781},{"placeId":"ChIJbzT7mZNJHRURPISUNUQVAls","rating":4.4,"userRatingCount":3843,"distanceMeters":5765,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.352,"reviewsScore":0.251,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.778},{"placeId":"ChIJYVEHnL1MHRUR5XLdVdFWp_4","rating":4.4,"userRatingCount":3299,"distanceMeters":3848,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.352,"reviewsScore":0.246,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.773},{"placeId":"ChIJ2_4xdfJLHRURuc_fSew1DLY","rating":4.4,"userRatingCount":2473,"distanceMeters":965,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.352,"reviewsScore":0.238,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.765},{"placeId":"ChIJG8_Bm4xLHRURX3UgepOdWNY","rating":4.3,"userRatingCount":3205,"distanceMeters":520,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.344,"reviewsScore":0.245,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.764},{"placeId":"ChIJde8TB3lMHRURFfTQ_m8LXxE","rating":4.3,"userRatingCount":2845,"distanceMeters":1106,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.344,"reviewsScore":0.242,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.761},{"placeId":"ChIJzTkFDYBLHRURpcKxDST7nk8","rating":4.2,"userRatingCount":3502,"distanceMeters":1374,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.336,"reviewsScore":0.248,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.759}],"msg":"[RANKING] Score breakdown for top 10 results"}
{"level":"info","time":"2026-01-31T14:57:22.752Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"post_rank_applied","profile":"BALANCED","weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"resultCount":20,"hadUserLocation":false,"mode":"LLM_SCORE","orderSource":"ranking","reordered":true,"msg":"[RANKING] Results ranked deterministically"}
{"level":"info","time":"2026-01-31T14:57:22.754Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","status":"RUNNING","progress":90,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:57:22.754Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"assistant_language_resolved","assistantLanguage":"he","source":"uiLanguage","detectedLanguage":"other","languageConfidence":1,"confidenceThreshold":0.7,"uiLanguage":"he","msg":"[ASSISTANT] Language resolved for assistant message"}
{"level":"info","time":"2026-01-31T14:57:22.755Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","assistantType":"SUMMARY","sessionIdPresent":true,"event":"assistant_deferred_start","msg":"[ASSISTANT] Deferred generation started (non-blocking)"}
{"level":"info","time":"2026-01-31T14:57:22.755Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","stage":"assistant_llm","event":"assistant_llm_start","type":"SUMMARY","questionLanguage":"he","queryLen":26,"schemaVersion":"v3_strict_validation","promptVersion":"v2_language_enforcement","msg":"[ASSISTANT] Calling LLM"}
{"level":"info","time":"2026-01-31T14:57:22.755Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"pagination_meta","fetchedCount":20,"returnedCount":20,"clientVisibleCount":12,"clientNextIncrement":5,"serverPagination":false,"msg":"[ROUTE2] Pagination metadata (client-side)"}
{"level":"info","time":"2026-01-31T14:57:22.756Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"final_response_order","count":20,"first10":[{"idx":0,"placeId":"ChIJ3fIA445LHRURFH_Ww1-rgMU","name":"Amore Mio"},{"idx":1,"placeId":"ChIJkUY0sH9MHRURTXu1bunhaDg","name":"HaPizza"},{"idx":2,"placeId":"ChIJ64mVj4VLHRUR43JF7ysTGzU","name":"Papi Pizza"},{"idx":3,"placeId":"ChIJq9Pf3ZxMHRURs_cAkicRJUQ","name":"Rustico Rothschild"},{"idx":4,"placeId":"ChIJbzT7mZNJHRURPISUNUQVAls","name":"POMO"},{"idx":5,"placeId":"ChIJYVEHnL1MHRUR5XLdVdFWp_4","name":"Italian restaurant Gemma"},{"idx":6,"placeId":"ChIJ2_4xdfJLHRURuc_fSew1DLY","name":"Juno"},{"idx":7,"placeId":"ChIJG8_Bm4xLHRURX3UgepOdWNY","name":"Rustico"},{"idx":8,"placeId":"ChIJde8TB3lMHRURFfTQ_m8LXxE","name":"Ernesto 90"},{"idx":9,"placeId":"ChIJzTkFDYBLHRURpcKxDST7nk8","name":"Matteo"}],"orderSource":"ranking","reordered":true,"msg":"[ROUTE2] Final response order (ranked deterministically)"}
{"level":"info","time":"2026-01-31T14:57:22.756Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"order_weights_resolved","base":"balanced","weights":{"rating":25,"reviews":20,"price":15,"openNow":15,"distance":25},"reasonCodes":["BASE_BALANCED"],"ctx":{"method":"textsearch","hasUserLocation":false,"distanceIntent":false,"openNowRequested":false,"priceIntent":"any","qualityIntent":false,"occasion":null,"cuisineKey":"italian"},"normalizedSum":100,"msg":"[ORDER] Hybrid order weights resolved"}
{"level":"info","time":"2026-01-31T14:57:22.756Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","event":"response_order_check","hasOrder":true,"orderProfile":"balanced","resultCount":20,"msg":"[ORDER] Response order metadata check before send"}
{"level":"info","time":"2026-01-31T14:57:22.813Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","hasResult":true,"msg":"[RedisJobStore] Result stored"}
{"level":"info","time":"2026-01-31T14:57:22.813Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","resultCount":20,"hasAssist":true,"event":"result_stored","msg":"[Observability] Search result stored successfully"}
{"level":"info","time":"2026-01-31T14:57:22.863Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","status":"DONE_SUCCESS","progress":100,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:57:22.863Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","status":"DONE_SUCCESS","progress":100,"event":"status_done","msg":"[Observability] Job reached terminal status"}
{"level":"info","time":"2026-01-31T14:57:23.099Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"52962205-2162-4999-99ad-03e99b8c8979","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:57:23.100Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":15722,"updatedAgeMs":690,"progress":60,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 15722, updatedAgeMs: 690"}
{"level":"info","time":"2026-01-31T14:57:24.707Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"ee48845c-339e-4189-934a-23d13a84e059","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1952,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:57:24.707Z","model":"gpt-4o-mini","tokensIn":915,"tokensOut":69,"totalTokens":984,"schemaName":"response","schemaStrict":true,"schemaHash":"4330761d782c","schemaVersion":"v1","promptVersion":"v2_language_enforcement","promptLength":2964,"estimatedCostUsd":0.00017865,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:57:24.707Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"assistant_llm","promptVersion":"v2_language_enforcement","schemaHash":"553fdda035a7","requestId":"req-1769871423049-pepujqibe","traceId":"ee48845c-339e-4189-934a-23d13a84e059","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3000,"timeoutHit":false,"buildPromptMs":0.07,"networkMs":1952.08,"parseMs":0.11,"totalMs":1952.3,"promptChars":2964,"inputTokens":915,"outputTokens":69,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:57:24.708Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","stage":"assistant_llm","event":"assistant_llm_success","type":"SUMMARY","questionLanguage":"he","suggestedAction":"NONE","blocksSearch":false,"durationMs":1953,"usage":{"prompt_tokens":915,"completion_tokens":69,"total_tokens":984},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"info","time":"2026-01-31T14:57:24.708Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","assistantType":"SUMMARY","durationMs":1953,"event":"assistant_deferred_done","msg":"[ASSISTANT] Deferred generation completed"}
{"level":"info","time":"2026-01-31T14:57:24.708Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","channel":"assistant","requestId":"req-1769871423049-pepujqibe","sessionHash":"2c3b20d765e7","payloadType":"assistant","event":"assistant_ws_publish","msg":"[ASSISTANT] Publishing to WebSocket"}
{"level":"info","time":"2026-01-31T14:57:24.709Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871423049-pepujqibe","channel":"assistant","payloadType":"assistant","event":"assistant_published","assistantType":"SUMMARY","blocksSearch":false,"suggestedAction":"NONE","msg":"[ASSISTANT] Published to WebSocket"}
{"level":"warn","time":"2026-01-31T14:57:25.525Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","provider":"openai","operation":"completeJSON","latencyMs":4003,"success":false,"retryCount":2,"errorCode":"Error","errorReason":"Request was aborted.","timestamp":"2026-01-31T14:57:25.525Z","msg":"Provider call failed: openai.completeJSON"}
{"level":"warn","time":"2026-01-31T14:57:25.525Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"cuisine_enforcer","promptVersion":"unknown","requestId":"req-1769871427374-hhp981mt5","attempt":3,"model":"gpt-4o-mini","timeoutMs":4000,"timeoutHit":true,"buildPromptMs":0.04,"networkMs":4002.8,"parseMs":0,"totalMs":13027.95,"promptChars":912,"inputTokens":null,"outputTokens":null,"retriesCount":2,"success":false,"errorType":"abort_timeout","errorReason":"Request aborted or timeout","statusCode":null,"msg":"llm_gate_timing"}
{"level":"warn","time":"2026-01-31T14:57:25.526Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":3,"maxAttempts":3,"errorType":"abort_timeout","msg":"[LLM] Timeout, will retry with backoff"}
{"level":"warn","time":"2026-01-31T14:57:25.526Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempt":3,"maxAttempts":3,"msg":"[LLM] Retriable transport error"}
{"level":"error","time":"2026-01-31T14:57:25.526Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","attempts":3,"msg":"[LLM] All retry attempts exhausted"}
{"level":"error","time":"2026-01-31T14:57:25.526Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"cuisine_enforcement_llm_failed","error":"Request was aborted.","msg":"[CUISINE_ENFORCER] LLM call failed, returning all places"}
{"level":"info","time":"2026-01-31T14:57:25.526Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"cuisine_scores_attached","scoresAttached":0,"resultsCount":6,"msg":"[ROUTE2] Cuisine scores attached to results for ranking"}
{"level":"info","time":"2026-01-31T14:57:25.526Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","pipelineVersion":"route2","event":"cuisine_enforcement_completed","countIn":6,"countOut":6,"relaxApplied":false,"relaxStrategy":"none","hasScores":true,"msg":"[ROUTE2] Cuisine enforcement completed"}
{"level":"info","time":"2026-01-31T14:57:25.527Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"cuisine_score_only_applied","countIn":6,"countOut":6,"mode":"SCORE_ONLY","msg":"[ROUTE2] Cuisine score-only mode: all results kept for ranking"}
{"level":"info","time":"2026-01-31T14:57:25.527Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","pipelineVersion":"route2","event":"await_post_constraints","msg":"[ROUTE2] Awaiting post constraints (late)"}
{"level":"info","time":"2026-01-31T14:57:25.542Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","status":"RUNNING","progress":75,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:57:25.543Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"ranking_input_order","count":6,"first10":[{"idx":0,"placeId":"ChIJ01avgGW5AhURK77L-yJpgrA","rating":4.5,"userRatingCount":748},{"idx":1,"placeId":"ChIJja5NDWC5AhURJtQIcOHI2hM","rating":4.3,"userRatingCount":2427},{"idx":2,"placeId":"ChIJtfMizea7AhURHix3ZiSHtXc","rating":4.3,"userRatingCount":2155},{"idx":3,"placeId":"ChIJ20_owd-7AhURq5A9JHQbSwI","rating":4.2,"userRatingCount":1870},{"idx":4,"placeId":"ChIJJbKfNmi5AhURYTVwnBWgrZA","rating":3.9,"userRatingCount":1412},{"idx":5,"placeId":"ChIJrwmqkt-7AhURbv_akJRrDDY","rating":4.7,"userRatingCount":132}],"orderSource":"google","reordered":false,"msg":"[RANKING] Input order (Google)"}
{"level":"info","time":"2026-01-31T14:57:25.543Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"ranking_profile_selected","profile":"NO_LOCATION","weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"reason":"no_user_location","cuisineKey":"italian","route":"TEXTSEARCH","source":"deterministic","msg":"[RANKING] No user location - using NO_LOCATION profile (distance weight = 0)"}
{"level":"info","time":"2026-01-31T14:57:25.543Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"ranking_distance_origin_selected","origin":"CITY_CENTER","cityText":"גדרה","hadUserLocation":false,"refLatLng":{"lat":31.8120082,"lng":34.7774347},"intentReason":"explicit_city_mentioned","msg":"[RANKING] Distance origin: CITY_CENTER"}
{"level":"info","time":"2026-01-31T14:57:25.543Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"ranking_output_order","count":6,"first10":[{"idx":0,"placeId":"ChIJja5NDWC5AhURJtQIcOHI2hM","rating":4.3,"userRatingCount":2427},{"idx":1,"placeId":"ChIJtfMizea7AhURHix3ZiSHtXc","rating":4.3,"userRatingCount":2155},{"idx":2,"placeId":"ChIJ20_owd-7AhURq5A9JHQbSwI","rating":4.2,"userRatingCount":1870},{"idx":3,"placeId":"ChIJ01avgGW5AhURK77L-yJpgrA","rating":4.5,"userRatingCount":748},{"idx":4,"placeId":"ChIJJbKfNmi5AhURYTVwnBWgrZA","rating":3.9,"userRatingCount":1412},{"idx":5,"placeId":"ChIJrwmqkt-7AhURbv_akJRrDDY","rating":4.7,"userRatingCount":132}],"orderSource":"ranking","reordered":true,"msg":"[RANKING] Output order (ranked)"}
{"level":"info","time":"2026-01-31T14:57:25.544Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"ranking_score_breakdown","profile":"BALANCED","top10":[{"placeId":"ChIJja5NDWC5AhURJtQIcOHI2hM","rating":4.3,"userRatingCount":2427,"distanceMeters":344,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.344,"reviewsScore":0.237,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.756},{"placeId":"ChIJtfMizea7AhURHix3ZiSHtXc","rating":4.3,"userRatingCount":2155,"distanceMeters":689,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.344,"reviewsScore":0.233,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.752},{"placeId":"ChIJ20_owd-7AhURq5A9JHQbSwI","rating":4.2,"userRatingCount":1870,"distanceMeters":576,"openNow":true,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.336,"reviewsScore":0.229,"distanceScore":0,"openBoostScore":0.1,"cuisineMatchScore":0.075},"totalScore":0.74},{"placeId":"ChIJ01avgGW5AhURK77L-yJpgrA","rating":4.5,"userRatingCount":748,"distanceMeters":553,"openNow":false,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.36,"reviewsScore":0.201,"distanceScore":0,"openBoostScore":0,"cuisineMatchScore":0.075},"totalScore":0.636},{"placeId":"ChIJJbKfNmi5AhURYTVwnBWgrZA","rating":3.9,"userRatingCount":1412,"distanceMeters":1056,"openNow":false,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.312,"reviewsScore":0.221,"distanceScore":0,"openBoostScore":0,"cuisineMatchScore":0.075},"totalScore":0.608},{"placeId":"ChIJrwmqkt-7AhURbv_akJRrDDY","rating":4.7,"userRatingCount":132,"distanceMeters":533,"openNow":false,"cuisineScore":null,"weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"components":{"ratingScore":0.376,"reviewsScore":0.149,"distanceScore":0,"openBoostScore":0,"cuisineMatchScore":0.075},"totalScore":0.6}],"msg":"[RANKING] Score breakdown for top 10 results"}
{"level":"info","time":"2026-01-31T14:57:25.544Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"post_rank_applied","profile":"BALANCED","weights":{"rating":0.4,"reviews":0.35,"distance":0,"openBoost":0.1,"cuisineMatch":0.15},"resultCount":6,"hadUserLocation":false,"mode":"LLM_SCORE","orderSource":"ranking","reordered":true,"msg":"[RANKING] Results ranked deterministically"}
{"level":"info","time":"2026-01-31T14:57:25.546Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","status":"RUNNING","progress":90,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:57:25.547Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"assistant_language_resolved","assistantLanguage":"he","source":"uiLanguage","detectedLanguage":"other","languageConfidence":1,"confidenceThreshold":0.7,"uiLanguage":"he","msg":"[ASSISTANT] Language resolved for assistant message"}
{"level":"info","time":"2026-01-31T14:57:25.547Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","assistantType":"SUMMARY","sessionIdPresent":true,"event":"assistant_deferred_start","msg":"[ASSISTANT] Deferred generation started (non-blocking)"}
{"level":"info","time":"2026-01-31T14:57:25.548Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","stage":"assistant_llm","event":"assistant_llm_start","type":"SUMMARY","questionLanguage":"he","queryLen":23,"schemaVersion":"v3_strict_validation","promptVersion":"v2_language_enforcement","msg":"[ASSISTANT] Calling LLM"}
{"level":"info","time":"2026-01-31T14:57:25.548Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"pagination_meta","fetchedCount":6,"returnedCount":6,"clientVisibleCount":12,"clientNextIncrement":5,"serverPagination":false,"msg":"[ROUTE2] Pagination metadata (client-side)"}
{"level":"info","time":"2026-01-31T14:57:25.548Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"final_response_order","count":6,"first10":[{"idx":0,"placeId":"ChIJja5NDWC5AhURJtQIcOHI2hM","name":"Aberto"},{"idx":1,"placeId":"ChIJtfMizea7AhURHix3ZiSHtXc","name":"Otman Brothers Restaurant"},{"idx":2,"placeId":"ChIJ20_owd-7AhURq5A9JHQbSwI","name":"Para"},{"idx":3,"placeId":"ChIJ01avgGW5AhURK77L-yJpgrA","name":"Beit tamar Gedera"},{"idx":4,"placeId":"ChIJJbKfNmi5AhURYTVwnBWgrZA","name":"Bleecker Bakery - Gedera Branch"},{"idx":5,"placeId":"ChIJrwmqkt-7AhURbv_akJRrDDY","name":"אצל שלמה"}],"orderSource":"ranking","reordered":true,"msg":"[ROUTE2] Final response order (ranked deterministically)"}
{"level":"info","time":"2026-01-31T14:57:25.548Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"order_weights_resolved","base":"balanced","weights":{"rating":25,"reviews":20,"price":15,"openNow":15,"distance":25},"reasonCodes":["BASE_BALANCED"],"ctx":{"method":"textsearch","hasUserLocation":false,"distanceIntent":false,"openNowRequested":false,"priceIntent":"any","qualityIntent":false,"occasion":null,"cuisineKey":"italian"},"normalizedSum":100,"msg":"[ORDER] Hybrid order weights resolved"}
{"level":"info","time":"2026-01-31T14:57:25.548Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"response_order_check","hasOrder":true,"orderProfile":"balanced","resultCount":6,"msg":"[ORDER] Response order metadata check before send"}
{"level":"info","time":"2026-01-31T14:57:25.603Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","hasResult":true,"msg":"[RedisJobStore] Result stored"}
{"level":"info","time":"2026-01-31T14:57:25.603Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","resultCount":6,"hasAssist":true,"event":"result_stored","msg":"[Observability] Search result stored successfully"}
{"level":"info","time":"2026-01-31T14:57:25.653Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","status":"DONE_SUCCESS","progress":100,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T14:57:25.653Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","status":"DONE_SUCCESS","progress":100,"event":"status_done","msg":"[Observability] Job reached terminal status"}
{"level":"info","time":"2026-01-31T14:57:26.099Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"cc1bbbdc-c86b-4d37-94e5-beea330b7261","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T14:57:26.102Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","event":"getResult_status","status":"DONE_SUCCESS","hasResult":true,"ageMs":18724,"updatedAgeMs":498,"progress":100,"isStale":false,"msg":"[HTTP] GET /result - status: DONE_SUCCESS, ageMs: 18724, updatedAgeMs: 498"}
{"level":"info","time":"2026-01-31T14:57:26.103Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","photoUrlsSanitized":true,"resultCount":6,"hasResult":true,"status":"DONE_SUCCESS","event":"getResult_returned","msg":"[Observability] GET /result returned successfully with results"}
{"level":"info","time":"2026-01-31T14:57:27.108Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"678cde2e-fa1d-47fe-941d-e5f08d3c5793","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1560,"success":true,"retryCount":0,"timestamp":"2026-01-31T14:57:27.108Z","model":"gpt-4o-mini","tokensIn":911,"tokensOut":69,"totalTokens":980,"schemaName":"response","schemaStrict":true,"schemaHash":"4330761d782c","schemaVersion":"v1","promptVersion":"v2_language_enforcement","promptLength":2961,"estimatedCostUsd":0.00017805,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T14:57:27.109Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"assistant_llm","promptVersion":"v2_language_enforcement","schemaHash":"553fdda035a7","requestId":"req-1769871427374-hhp981mt5","traceId":"678cde2e-fa1d-47fe-941d-e5f08d3c5793","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3000,"timeoutHit":false,"buildPromptMs":0.05,"networkMs":1561.42,"parseMs":0.12,"totalMs":1561.64,"promptChars":2961,"inputTokens":911,"outputTokens":69,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T14:57:27.110Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","stage":"assistant_llm","event":"assistant_llm_success","type":"SUMMARY","questionLanguage":"he","suggestedAction":"NONE","blocksSearch":false,"durationMs":1562,"usage":{"prompt_tokens":911,"completion_tokens":69,"total_tokens":980},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"info","time":"2026-01-31T14:57:27.111Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","assistantType":"SUMMARY","durationMs":1564,"event":"assistant_deferred_done","msg":"[ASSISTANT] Deferred generation completed"}
{"level":"info","time":"2026-01-31T14:57:27.111Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","channel":"assistant","requestId":"req-1769871427374-hhp981mt5","sessionHash":"2c3b20d765e7","payloadType":"assistant","event":"assistant_ws_publish","msg":"[ASSISTANT] Publishing to WebSocket"}
{"level":"info","time":"2026-01-31T14:57:27.112Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769871427374-hhp981mt5","channel":"assistant","payloadType":"assistant","event":"assistant_published","assistantType":"SUMMARY","blocksSearch":false,"suggestedAction":"NONE","msg":"[ASSISTANT] Published to WebSocket"}
{"level":"info","time":"2026-01-31T15:10:33.731Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871333714-eg8j2s","code":1000,"reason":"IDLE_TIMEOUT","wasClean":true,"msg":"websocket_disconnected"}
{"level":"info","time":"2026-01-31T15:10:34.129Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","traceId":"8a09c2a6-ad32-44f1-a6ce-7c9fdac7ca13","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"6c46ad3f5104","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T15:10:34.146Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769872234146-hx67vj","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T15:12:07.401Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769871385153-7yllhf","code":1000,"reason":"IDLE_TIMEOUT","wasClean":true,"msg":"websocket_disconnected"}
{"level":"info","time":"2026-01-31T15:12:08.125Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","traceId":"1faa5336-eacf-48af-a56e-399f7bce786b","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"656c72cf4bd8","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T15:12:08.134Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769872328134-ok6ftr","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T15:12:08.138Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769872328134-ok6ftr","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T15:12:08.139Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769872328134-ok6ftr","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T15:12:08.140Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769872328134-ok6ftr","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T15:12:08.140Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769872328134-ok6ftr","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T15:25:34.154Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769872234146-hx67vj","code":1000,"reason":"IDLE_TIMEOUT","wasClean":true,"msg":"websocket_disconnected"}
{"level":"info","time":"2026-01-31T15:25:35.131Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","traceId":"ed2c405d-d650-4e7f-b2ca-cb64e5afc5b3","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"3168a93050ae","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T15:25:35.150Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769873135149-2kfqrd","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T15:27:08.143Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769872328134-ok6ftr","code":1000,"reason":"IDLE_TIMEOUT","wasClean":true,"msg":"websocket_disconnected"}
{"level":"info","time":"2026-01-31T15:27:09.127Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","traceId":"46835eed-7d50-4881-8b82-d0baa924bea1","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"5eae91fd3048","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T15:27:09.138Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769873229138-3z1eeb","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T15:27:09.142Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769873229138-3z1eeb","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T15:27:09.142Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769873229138-3z1eeb","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T15:27:09.143Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769873229138-3z1eeb","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T15:27:09.143Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769873229138-3z1eeb","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T15:40:35.160Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769873135149-2kfqrd","code":1000,"reason":"IDLE_TIMEOUT","wasClean":true,"msg":"websocket_disconnected"}
{"level":"info","time":"2026-01-31T15:40:36.121Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","traceId":"32a4605d-451d-4a42-a164-8cec5445ceb5","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"84104b1a8711","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T15:40:36.127Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769874036127-em2b5n","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T15:42:09.149Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769873229138-3z1eeb","code":1000,"reason":"IDLE_TIMEOUT","wasClean":true,"msg":"websocket_disconnected"}
{"level":"info","time":"2026-01-31T15:42:10.120Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","traceId":"7c94fd27-b463-4b43-b662-291b85332a31","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"3228b144c11f","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T15:42:10.131Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769874130131-fw2jrt","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T15:42:10.134Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769874130131-fw2jrt","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T15:42:10.134Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769874130131-fw2jrt","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T15:42:10.135Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769874130131-fw2jrt","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T15:42:10.135Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769874130131-fw2jrt","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T15:55:36.145Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769874036127-em2b5n","code":1000,"reason":"IDLE_TIMEOUT","wasClean":true,"msg":"websocket_disconnected"}
{"level":"info","time":"2026-01-31T15:55:37.103Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","traceId":"d5e35cbc-7499-4602-a018-ea6dfb7566fb","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"e13125ec336c","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T15:55:37.110Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769874937110-7j9yu9","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T15:57:10.146Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769874130131-fw2jrt","code":1000,"reason":"IDLE_TIMEOUT","wasClean":true,"msg":"websocket_disconnected"}
{"level":"info","time":"2026-01-31T15:57:11.112Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","traceId":"144bca0c-09d0-4a99-a2b3-fc3e562ca13f","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"29602a3f320e","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T15:57:11.119Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769875031119-h39hxl","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T15:57:11.122Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769875031119-h39hxl","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T15:57:11.123Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769875031119-h39hxl","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T15:57:11.124Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769875031119-h39hxl","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T15:57:11.124Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769875031119-h39hxl","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T16:10:37.126Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769874937110-7j9yu9","code":1000,"reason":"IDLE_TIMEOUT","wasClean":true,"msg":"websocket_disconnected"}
{"level":"info","time":"2026-01-31T16:10:38.119Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","traceId":"9914b92d-95fc-40ce-bfd6-82b21d006c2e","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"cd3804360285","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T16:10:38.130Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769875838130-u4hfui","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T16:12:11.125Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769875031119-h39hxl","code":1000,"reason":"IDLE_TIMEOUT","wasClean":true,"msg":"websocket_disconnected"}
{"level":"info","time":"2026-01-31T16:12:12.116Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","traceId":"a08f27d9-e606-4b9f-b68e-d5a9f313ac44","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"e85b4258600c","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T16:12:12.124Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769875932124-1udbfb","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T16:12:12.127Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769875932124-1udbfb","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T16:12:12.127Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769875932124-1udbfb","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T16:12:12.128Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769875932124-1udbfb","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T16:12:12.128Z","pid":18124,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769875932124-1udbfb","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"warn","time":"2026-01-31T16:25:45.941Z","pid":9276,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"warn","time":"2026-01-31T16:25:46.001Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T16:25:46.753Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T16:25:46.755Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T16:25:46.758Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T16:25:46.766Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T16:25:46.748Z","pid":9276,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T16:25:46.753Z","pid":9276,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T16:25:46.756Z","pid":9276,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T16:25:46.760Z","pid":9276,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T16:25:46.878Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T16:25:46.882Z","pid":9276,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T16:25:46.885Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":116,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T16:25:46.887Z","pid":9276,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":124,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T16:25:46.888Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T16:25:46.907Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T16:25:46.922Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T16:25:46.924Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T16:25:46.930Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T16:25:46.931Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T16:25:46.933Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T16:25:46.935Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T16:25:46.890Z","pid":9276,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T16:25:46.907Z","pid":9276,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T16:25:46.919Z","pid":9276,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T16:25:46.922Z","pid":9276,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T16:25:46.930Z","pid":9276,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T16:25:46.932Z","pid":9276,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T16:25:46.933Z","pid":9276,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T16:25:46.935Z","pid":9276,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T16:25:46.945Z","pid":9276,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T16:25:47.208Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","traceId":"729f0c73-5ed5-4fa0-b96b-293cecd9f884","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"d6db72c733be","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T16:25:47.215Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","traceId":"a5226ac6-7fb6-43b5-ad2d-e3b98c5fc1d4","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"177cce944f72","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T16:25:47.236Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769876747236-aiu1kl","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T16:25:47.269Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769876747269-3ovqiz","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T16:25:47.291Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-01-31T16:25:47.297Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-01-31T16:25:47.298Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-01-31T16:25:47.299Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized with shared client"}
{"level":"info","time":"2026-01-31T16:25:47.307Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769876747269-3ovqiz","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T16:25:47.308Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769876747269-3ovqiz","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T16:25:47.308Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769876747269-3ovqiz","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T16:25:47.309Z","pid":10744,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769876747269-3ovqiz","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"warn","time":"2026-01-31T16:29:49.500Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T16:29:50.008Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"warn","time":"2026-01-31T16:29:49.510Z","pid":10372,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T16:29:50.016Z","pid":10372,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T16:29:50.017Z","pid":10372,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T16:29:50.018Z","pid":10372,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T16:29:50.009Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T16:29:50.040Z","pid":10372,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T16:29:50.011Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T16:29:50.014Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T16:29:50.093Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T16:29:50.098Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":82,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T16:29:50.101Z","pid":10372,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T16:29:50.105Z","pid":10372,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":63,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T16:29:50.101Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T16:29:50.122Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T16:29:50.131Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T16:29:50.132Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T16:29:50.134Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T16:29:50.135Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T16:29:50.136Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T16:29:50.137Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T16:29:50.109Z","pid":10372,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T16:29:50.125Z","pid":10372,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T16:29:50.131Z","pid":10372,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T16:29:50.132Z","pid":10372,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T16:29:50.134Z","pid":10372,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T16:29:50.135Z","pid":10372,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T16:29:50.136Z","pid":10372,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T16:29:50.137Z","pid":10372,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T16:29:50.143Z","pid":10372,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T16:29:50.404Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","traceId":"c1ad8282-d0bc-43ec-8d9b-96e97d7a510c","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"fbe523ca8255","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T16:29:50.419Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","traceId":"b2c4b9d8-45f0-4c43-bf16-212c2a3d77b9","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"245f4dbd0847","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T16:29:50.441Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769876990441-9aqwaf","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T16:29:50.461Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769876990461-ul9md5","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T16:29:50.469Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-01-31T16:29:50.474Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-01-31T16:29:50.474Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-01-31T16:29:50.475Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized with shared client"}
{"level":"info","time":"2026-01-31T16:29:50.479Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769876990461-ul9md5","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T16:29:50.479Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769876990461-ul9md5","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T16:29:50.480Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769876990461-ul9md5","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T16:29:50.480Z","pid":19156,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769876990461-ul9md5","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"warn","time":"2026-01-31T16:30:37.034Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T16:30:38.157Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T16:30:38.160Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T16:30:38.163Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T16:30:38.167Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T16:30:38.300Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T16:30:38.307Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":136,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T16:30:38.310Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T16:30:38.327Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T16:30:38.342Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T16:30:38.343Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T16:30:38.347Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T16:30:38.348Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T16:30:38.350Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T16:30:38.352Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T16:30:38.634Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","traceId":"f13e4262-5598-45e7-8dc8-880d861cf526","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"becc490dea06","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T16:30:38.654Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","traceId":"313b7f5f-dd2d-4e3c-9925-8f08d7439c33","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"7ba4d1165162","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"warn","time":"2026-01-31T16:30:37.715Z","pid":8920,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T16:30:38.676Z","pid":8920,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T16:30:38.679Z","pid":8920,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T16:30:38.687Z","pid":8920,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T16:30:38.705Z","pid":8920,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T16:30:38.840Z","pid":8920,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T16:30:38.845Z","pid":8920,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":136,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T16:30:38.859Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877038858-n81rt2","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T16:30:38.884Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877038884-t0fqp5","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T16:30:39.004Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-01-31T16:30:39.007Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-01-31T16:30:39.008Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-01-31T16:30:39.008Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized with shared client"}
{"level":"info","time":"2026-01-31T16:30:39.016Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877038858-n81rt2","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T16:30:39.018Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877038858-n81rt2","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T16:30:39.019Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877038858-n81rt2","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T16:30:39.019Z","pid":21536,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877038858-n81rt2","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T16:30:38.848Z","pid":8920,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T16:30:39.057Z","pid":8920,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T16:30:39.069Z","pid":8920,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T16:30:39.071Z","pid":8920,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T16:30:39.075Z","pid":8920,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T16:30:39.076Z","pid":8920,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T16:30:39.078Z","pid":8920,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T16:30:39.080Z","pid":8920,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T16:30:39.102Z","pid":8920,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"warn","time":"2026-01-31T16:30:59.049Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T16:30:59.486Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T16:30:59.489Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T16:30:59.490Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T16:30:59.493Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T16:30:59.554Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T16:30:59.559Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":64,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T16:30:59.561Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T16:30:59.573Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T16:30:59.580Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T16:30:59.581Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T16:30:59.583Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T16:30:59.584Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T16:30:59.585Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T16:30:59.586Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"info","time":"2026-01-31T16:30:59.683Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","traceId":"abcbea13-1051-468a-99a4-b45d892659eb","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"065a73f710a6","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T16:30:59.712Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","traceId":"27edc0f7-668a-4af1-aa83-1daadf44b26a","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"8b0519e1cbd2","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T16:30:59.721Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877059721-dyfkyj","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T16:30:59.738Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877059738-9m74ry","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T16:30:59.747Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-01-31T16:30:59.750Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-01-31T16:30:59.751Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-01-31T16:30:59.751Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized with shared client"}
{"level":"info","time":"2026-01-31T16:30:59.757Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877059738-9m74ry","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T16:30:59.758Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877059738-9m74ry","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T16:30:59.759Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877059738-9m74ry","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T16:30:59.760Z","pid":15300,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877059738-9m74ry","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"warn","time":"2026-01-31T16:30:59.395Z","pid":16564,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T16:30:59.751Z","pid":16564,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T16:30:59.754Z","pid":16564,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T16:30:59.757Z","pid":16564,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T16:30:59.760Z","pid":16564,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T16:30:59.822Z","pid":16564,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T16:30:59.826Z","pid":16564,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":64,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T16:30:59.829Z","pid":16564,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T16:30:59.843Z","pid":16564,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T16:30:59.851Z","pid":16564,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T16:30:59.853Z","pid":16564,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T16:30:59.857Z","pid":16564,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T16:30:59.858Z","pid":16564,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T16:30:59.859Z","pid":16564,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T16:30:59.861Z","pid":16564,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T16:30:59.869Z","pid":16564,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"warn","time":"2026-01-31T16:32:20.692Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T16:32:22.348Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T16:32:22.352Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T16:32:22.354Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T16:32:22.360Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T16:32:22.770Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T16:32:22.774Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":412,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T16:32:22.778Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T16:32:22.797Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T16:32:22.831Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T16:32:22.834Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T16:32:22.839Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T16:32:22.840Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T16:32:22.841Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T16:32:22.844Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"warn","time":"2026-01-31T16:32:20.737Z","pid":10268,"hostname":"il-dev-win-lt-shahar-pot","rateLimitStore":"memory","msg":"[RateLimit] Using in-memory rate limiting (not distributed, dev only)"}
{"level":"info","time":"2026-01-31T16:32:23.191Z","pid":10268,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":300,"cleanupIntervalMs":60000,"msg":"InMemoryRequestStore initialized"}
{"level":"info","time":"2026-01-31T16:32:23.194Z","pid":10268,"hostname":"il-dev-win-lt-shahar-pot","googleApiKey":{"exists":true,"len":39,"last4":"fpMo"},"searchProvider":"google","msg":"[BOOT] API key status"}
{"level":"info","time":"2026-01-31T16:32:23.198Z","pid":10268,"hostname":"il-dev-win-lt-shahar-pot","msg":"[Config] ASSISTANT_MODE = ENABLED (always on, LLM-first)"}
{"level":"info","time":"2026-01-31T16:32:23.223Z","pid":10268,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_start","redisUrl":"localhost:6379","env":"config_local","failClosed":false,"connectTimeout":2000,"startupTimeout":8000,"msg":"[RedisService] Starting Redis connection"}
{"level":"info","time":"2026-01-31T16:32:23.442Z","pid":10268,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_ready","msg":"[RedisService] Redis client ready"}
{"level":"info","time":"2026-01-31T16:32:23.456Z","pid":10268,"hostname":"il-dev-win-lt-shahar-pot","event":"redis_connect_ok","redisUrl":"localhost:6379","durationMs":231,"msg":"[RedisService] ✓ Redis connected successfully"}
{"level":"info","time":"2026-01-31T16:32:23.461Z","pid":10268,"hostname":"il-dev-win-lt-shahar-pot","event":"CACHE_STARTUP","cacheEnabled":true,"hasRedis":true,"reason":"redis_available","msg":"[GoogleMapsCache] ✓ Cache ENABLED with shared Redis client"}
{"level":"info","time":"2026-01-31T16:32:23.792Z","pid":10268,"hostname":"il-dev-win-lt-shahar-pot","env":"development","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","credentialsEnabled":true,"msg":"CORS: Initialized"}
{"level":"info","time":"2026-01-31T16:32:23.809Z","pid":10268,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","originsCount":3,"originsSummary":"http://localhost:4200, https://www.going2eat.food, https://app.going2eat.food","env":"config_local","redisEnabled":true,"hasStateStore":true,"msg":"WebSocketManager: Configuration resolved"}
{"level":"info","time":"2026-01-31T16:32:23.817Z","pid":10268,"hostname":"il-dev-win-lt-shahar-pot","redisUrl":"local","msg":"WebSocketManager: Using shared Redis client"}
{"level":"info","time":"2026-01-31T16:32:23.821Z","pid":10268,"hostname":"il-dev-win-lt-shahar-pot","path":"/ws","msg":"WebSocketManager: Initialized"}
{"level":"info","time":"2026-01-31T16:32:23.822Z","pid":10268,"hostname":"il-dev-win-lt-shahar-pot","event":"load_more_handler_registered","msg":"[LOAD_MORE_REGISTRY] Handler registered"}
{"level":"info","time":"2026-01-31T16:32:23.835Z","pid":10268,"hostname":"il-dev-win-lt-shahar-pot","msg":"[BOOT] Load more handler registered"}
{"level":"info","time":"2026-01-31T16:32:23.838Z","pid":10268,"hostname":"il-dev-win-lt-shahar-pot","msg":"Server listening on http://localhost:3000"}
{"level":"fatal","time":"2026-01-31T16:32:23.890Z","pid":10268,"hostname":"il-dev-win-lt-shahar-pot","error":"listen EADDRINUSE: address already in use :::3000","stack":"Error: listen EADDRINUSE: address already in use :::3000\n    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)\n    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)\n    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n    at listenInCluster (node:net:1865:12)\n    at Server.listen (node:net:1953:7)\n    at Function.listen (C:\\dev\\piza\\angular-piza\\server\\node_modules\\express\\lib\\application.js:605:24)\n    at <anonymous> (c:\\dev\\piza\\angular-piza\\server\\src\\server.ts:130:20)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","msg":"[FATAL] Uncaught Exception - server may be in unstable state"}
{"level":"info","time":"2026-01-31T16:32:24.327Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","traceId":"eee9ab8e-8013-45eb-ab56-3d66e84b4ba1","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"39f602d0c3a4","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T16:32:24.540Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877144540-x401uc","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T16:32:25.139Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","traceId":"93a5e860-a2d1-428e-8779-e1ed4f90538b","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"ed7292e35fc2","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T16:32:25.555Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877145554-kdy8t5","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T16:32:25.571Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","msg":"[JobStore] Creating singleton initialization promise"}
{"level":"info","time":"2026-01-31T16:32:25.575Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","redisUrl":"redis://localhost:6379","ttlSeconds":86400,"enableRedisJobStore":true,"msg":"[JobStore] Initializing Redis store"}
{"level":"info","time":"2026-01-31T16:32:25.576Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","ttlSeconds":86400,"msg":"[RedisJobStore] Initialized with shared Redis client"}
{"level":"info","time":"2026-01-31T16:32:25.576Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","store":"redis","msg":"[JobStore] ✓ Redis store initialized with shared client"}
{"level":"info","time":"2026-01-31T16:32:25.586Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877145554-kdy8t5","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T16:32:25.588Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877145554-kdy8t5","channel":"search","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T16:32:25.589Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877145554-kdy8t5","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T16:32:25.590Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877145554-kdy8t5","channel":"assistant","requestIdHash":"3e3770c41e1d","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T16:32:35.234Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"1e269e03-8ed8-4f1f-b615-057a0317aa2b","ip":"::1","photoRefHash":"a7124787a5ea","contentType":"image/jpeg","sizeBytes":30622,"durationMs":816,"slow":true,"msg":"[PhotoProxy] Photo served"}
{"level":"info","time":"2026-01-31T16:32:35.548Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"a24facb1-d711-48e3-867d-5bc2052ba379","ip":"::1","photoRefHash":"c69d89db8869","contentType":"image/jpeg","sizeBytes":42706,"durationMs":808,"slow":true,"msg":"[PhotoProxy] Photo served"}
{"level":"info","time":"2026-01-31T16:32:36.218Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877145554-kdy8t5","code":1001,"reason":"none","wasClean":true,"msg":"websocket_disconnected"}
{"level":"info","time":"2026-01-31T16:32:36.773Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","traceId":"9af4cec2-2252-436a-b13e-95b7eaf27d99","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","hasUserId":false,"ticketHash":"b70a8e86a739","ttl":60,"msg":"[WSTicket] Ticket generated"}
{"level":"info","time":"2026-01-31T16:32:36.808Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877156807-10nxk9","ip":"::1","originHost":"localhost","sessionHash":"2c3b20d765e7","hasUserId":false,"event":"ws_conn_ctx_set","msg":"WebSocket connection context established"}
{"level":"info","time":"2026-01-31T16:32:40.629Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","query":"nv fsfds","status":"PENDING","hasOwner":true,"hasIdempotencyKey":true,"msg":"[RedisJobStore] Job created"}
{"level":"info","time":"2026-01-31T16:32:40.630Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","sessionHash":"2c3b20d765e7","hasUserId":false,"operation":"createJob","decision":"ACCEPTED","hasIdempotencyKey":true,"event":"job_created","msg":"[Observability] Job created with JWT session binding and idempotency key"}
{"level":"info","time":"2026-01-31T16:32:40.636Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","status":"RUNNING","progress":10,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T16:32:40.637Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","status":"RUNNING","progress":10,"event":"status_running","msg":"[Observability] Job status set to RUNNING"}
{"level":"info","time":"2026-01-31T16:32:40.639Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769877160621-7bsng9n1d","event":"backlog_created","msg":"WebSocket backlog created for late subscribers"}
{"level":"info","time":"2026-01-31T16:32:40.642Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","pipelineVersion":"route2","event":"pipeline_selected","queryLen":8,"queryHash":"41b79208fc53","msg":"[ROUTE2] Pipeline selected"}
{"level":"info","time":"2026-01-31T16:32:40.643Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","pipelineVersion":"route2","event":"device_region_resolved","userRegionCode":"IL","userRegionSource":"config","msg":"[ROUTE2] Device region resolved"}
{"level":"info","time":"2026-01-31T16:32:40.645Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","traceId":"84991e81-8091-4c5c-a91a-b75060d25e65","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_started","queryLen":8,"queryHash":"41b79208fc53","msg":"[ROUTE2] gate2 started"}
{"level":"info","time":"2026-01-31T16:32:40.674Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877156807-10nxk9","channel":"search","requestIdHash":"fb5d32895751","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T16:32:40.675Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877156807-10nxk9","channel":"search","requestIdHash":"fb5d32895751","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T16:32:40.676Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769877160621-7bsng9n1d","count":1,"event":"backlog_drained","msg":"WebSocket backlog drained to late subscriber"}
{"level":"info","time":"2026-01-31T16:32:40.677Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877156807-10nxk9","channel":"assistant","requestIdHash":"fb5d32895751","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T16:32:40.678Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877156807-10nxk9","channel":"assistant","requestIdHash":"fb5d32895751","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"warn","time":"2026-01-31T16:32:44.187Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"84991e81-8091-4c5c-a91a-b75060d25e65","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":3537,"success":false,"retryCount":0,"errorCode":"Error","errorReason":"Request was aborted.","timestamp":"2026-01-31T16:32:44.187Z","msg":"Provider call failed: openai.completeJSON"}
{"level":"warn","time":"2026-01-31T16:32:44.193Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"gate2","promptVersion":"gate2_v4","requestId":"req-1769877160621-7bsng9n1d","traceId":"84991e81-8091-4c5c-a91a-b75060d25e65","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3500,"timeoutHit":true,"buildPromptMs":0.48,"networkMs":3542.06,"parseMs":0,"totalMs":3543.59,"promptChars":569,"inputTokens":null,"outputTokens":null,"retriesCount":0,"success":false,"errorType":"abort_timeout","errorReason":"Request aborted or timeout","statusCode":null,"msg":"llm_gate_timing"}
{"level":"warn","time":"2026-01-31T16:32:44.197Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","attempt":1,"maxAttempts":3,"traceId":"84991e81-8091-4c5c-a91a-b75060d25e65","errorType":"abort_timeout","msg":"[LLM] Timeout, will retry with backoff"}
{"level":"warn","time":"2026-01-31T16:32:44.199Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","attempt":1,"maxAttempts":3,"traceId":"84991e81-8091-4c5c-a91a-b75060d25e65","msg":"[LLM] Retriable transport error"}
{"level":"info","time":"2026-01-31T16:32:44.500Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"c3688b4c-4a5a-4e5b-bfd9-0957b2f2ef91","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T16:32:44.503Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":3878,"updatedAgeMs":3869,"progress":10,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 3878, updatedAgeMs: 3869"}
{"level":"info","time":"2026-01-31T16:32:45.558Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"84991e81-8091-4c5c-a91a-b75060d25e65","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1081,"success":true,"retryCount":1,"timestamp":"2026-01-31T16:32:45.557Z","model":"gpt-4o-mini","tokensIn":216,"tokensOut":12,"totalTokens":228,"schemaName":"response","schemaStrict":true,"schemaHash":"ecbf2c0a0457","schemaVersion":"v1","promptVersion":"gate2_v4","promptHash":"417e5c5eced45df60519ffa2d62a71e758d5dd81618a8f8dd394670184d7c480","promptLength":561,"estimatedCostUsd":0.000039599999999999994,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T16:32:45.561Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"gate2","promptVersion":"gate2_v4","schemaHash":"b155cfcde635","requestId":"req-1769877160621-7bsng9n1d","traceId":"84991e81-8091-4c5c-a91a-b75060d25e65","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":2,"model":"gpt-4o-mini","timeoutMs":3500,"timeoutHit":false,"buildPromptMs":0.48,"networkMs":1083.82,"parseMs":1.46,"totalMs":4912.15,"promptChars":569,"inputTokens":216,"outputTokens":12,"retriesCount":1,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T16:32:45.563Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","traceId":"84991e81-8091-4c5c-a91a-b75060d25e65","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_completed","durationMs":4918,"route":"STOP","foodSignal":"NO","confidence":1,"tokenUsage":{"input":216,"output":12,"total":228,"model":"gpt-4o-mini"},"msg":"[ROUTE2] gate2 completed"}
{"level":"info","time":"2026-01-31T16:32:45.577Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","status":"RUNNING","progress":25,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T16:32:45.580Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","pipelineVersion":"route2","event":"pipeline_stopped","reason":"not_food_related","foodSignal":"NO","msg":"[ROUTE2] Pipeline stopped - not food related"}
{"level":"info","time":"2026-01-31T16:32:45.582Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","event":"assistant_language_resolved","assistantLanguage":"en","source":"fallback","detectedLanguage":"other","confidenceThreshold":0.7,"msg":"[ASSISTANT] Language resolved for assistant message"}
{"level":"info","time":"2026-01-31T16:32:45.583Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","assistantType":"GATE_FAIL","sessionIdPresent":true,"event":"assistant_called","msg":"[ASSISTANT] Hook invoked"}
{"level":"info","time":"2026-01-31T16:32:45.585Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","stage":"assistant_llm","event":"assistant_llm_start","type":"GATE_FAIL","reason":"NO_FOOD","questionLanguage":"en","queryLen":8,"schemaVersion":"v3_strict_validation","promptVersion":"v2_language_enforcement","msg":"[ASSISTANT] Calling LLM"}
{"level":"info","time":"2026-01-31T16:32:46.065Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"37263529-eba1-474a-b52d-1e5723b264be","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T16:32:46.068Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":5443,"updatedAgeMs":502,"progress":25,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 5443, updatedAgeMs: 502"}
{"level":"info","time":"2026-01-31T16:32:47.506Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"c07bfed0-a89e-4f05-b8bd-8df63c6f26b2","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T16:32:47.508Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","event":"getResult_status","status":"RUNNING","hasResult":false,"ageMs":6883,"updatedAgeMs":1942,"progress":25,"isStale":false,"msg":"[HTTP] GET /result - status: RUNNING, ageMs: 6883, updatedAgeMs: 1942"}
{"level":"info","time":"2026-01-31T16:32:48.335Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"84991e81-8091-4c5c-a91a-b75060d25e65","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":2748,"success":true,"retryCount":0,"timestamp":"2026-01-31T16:32:48.335Z","model":"gpt-4o-mini","tokensIn":467,"tokensOut":59,"totalTokens":526,"schemaName":"response","schemaStrict":true,"schemaHash":"4330761d782c","schemaVersion":"v1","promptVersion":"v2_language_enforcement","promptLength":1380,"estimatedCostUsd":0.00010544999999999999,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T16:32:48.337Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"assistant_llm","promptVersion":"v2_language_enforcement","schemaHash":"553fdda035a7","requestId":"req-1769877160621-7bsng9n1d","traceId":"84991e81-8091-4c5c-a91a-b75060d25e65","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3000,"timeoutHit":false,"buildPromptMs":0.25,"networkMs":2749.43,"parseMs":1.23,"totalMs":2751.05,"promptChars":1380,"inputTokens":467,"outputTokens":59,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T16:32:48.339Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","stage":"assistant_llm","event":"assistant_llm_success","type":"GATE_FAIL","questionLanguage":"en","suggestedAction":"ASK_FOOD","blocksSearch":true,"durationMs":2754,"usage":{"prompt_tokens":467,"completion_tokens":59,"total_tokens":526},"model":"gpt-4o-mini","msg":"[ASSISTANT] LLM generated and validated message"}
{"level":"info","time":"2026-01-31T16:32:48.340Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","channel":"assistant","requestId":"req-1769877160621-7bsng9n1d","sessionHash":"2c3b20d765e7","payloadType":"assistant","event":"assistant_ws_publish","msg":"[ASSISTANT] Publishing to WebSocket"}
{"level":"info","time":"2026-01-31T16:32:48.341Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","channel":"assistant","payloadType":"assistant","event":"assistant_published","assistantType":"GATE_FAIL","blocksSearch":true,"suggestedAction":"ASK_FOOD","msg":"[ASSISTANT] Published to WebSocket"}
{"level":"info","time":"2026-01-31T16:32:48.347Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","hasResult":true,"msg":"[RedisJobStore] Result stored"}
{"level":"info","time":"2026-01-31T16:32:48.348Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","resultCount":0,"hasAssist":true,"event":"result_stored","msg":"[Observability] Search result stored successfully"}
{"level":"info","time":"2026-01-31T16:32:48.351Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","status":"DONE_STOPPED","progress":100,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T16:32:48.352Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877160621-7bsng9n1d","status":"DONE_STOPPED","progress":100,"event":"status_done","msg":"[Observability] Job reached terminal status"}
{"level":"info","time":"2026-01-31T16:33:03.127Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","query":"מסעדות   איטלקיות בגדרה","status":"PENDING","hasOwner":true,"hasIdempotencyKey":true,"msg":"[RedisJobStore] Job created"}
{"level":"info","time":"2026-01-31T16:33:03.128Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","sessionHash":"2c3b20d765e7","hasUserId":false,"operation":"createJob","decision":"ACCEPTED","hasIdempotencyKey":true,"event":"job_created","msg":"[Observability] Job created with JWT session binding and idempotency key"}
{"level":"info","time":"2026-01-31T16:33:03.132Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","status":"RUNNING","progress":10,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T16:33:03.133Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","status":"RUNNING","progress":10,"event":"status_running","msg":"[Observability] Job status set to RUNNING"}
{"level":"info","time":"2026-01-31T16:33:03.133Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769877183121-tbsxol9b1","event":"backlog_created","msg":"WebSocket backlog created for late subscribers"}
{"level":"info","time":"2026-01-31T16:33:03.133Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","pipelineVersion":"route2","event":"pipeline_selected","queryLen":23,"queryHash":"5555eae2a438","msg":"[ROUTE2] Pipeline selected"}
{"level":"info","time":"2026-01-31T16:33:03.133Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","pipelineVersion":"route2","event":"device_region_resolved","userRegionCode":"IL","userRegionSource":"config","msg":"[ROUTE2] Device region resolved"}
{"level":"info","time":"2026-01-31T16:33:03.133Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","traceId":"a29406e3-45b8-48a2-9f46-54f843af6b57","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_started","queryLen":23,"queryHash":"5555eae2a438","msg":"[ROUTE2] gate2 started"}
{"level":"info","time":"2026-01-31T16:33:03.140Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877156807-10nxk9","channel":"search","requestIdHash":"ec8baee4ffcc","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T16:33:03.140Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877156807-10nxk9","channel":"search","requestIdHash":"ec8baee4ffcc","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T16:33:03.141Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","channel":"search","requestId":"req-1769877183121-tbsxol9b1","count":1,"event":"backlog_drained","msg":"WebSocket backlog drained to late subscriber"}
{"level":"info","time":"2026-01-31T16:33:03.141Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877156807-10nxk9","channel":"assistant","requestIdHash":"ec8baee4ffcc","sessionHash":"2c3b20d765e7","event":"ws_subscribe_attempt","msg":"WebSocket subscribe attempt"}
{"level":"info","time":"2026-01-31T16:33:03.142Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","clientId":"ws-1769877156807-10nxk9","channel":"assistant","requestIdHash":"ec8baee4ffcc","sessionHash":"2c3b20d765e7","pending":false,"subscriberCount":1,"event":"ws_subscribe_ack","msg":"Subscribe accepted - registration complete"}
{"level":"info","time":"2026-01-31T16:33:04.497Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"a29406e3-45b8-48a2-9f46-54f843af6b57","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":1363,"success":true,"retryCount":0,"timestamp":"2026-01-31T16:33:04.497Z","model":"gpt-4o-mini","tokensIn":223,"tokensOut":12,"totalTokens":235,"schemaName":"response","schemaStrict":true,"schemaHash":"ecbf2c0a0457","schemaVersion":"v1","promptVersion":"gate2_v4","promptHash":"417e5c5eced45df60519ffa2d62a71e758d5dd81618a8f8dd394670184d7c480","promptLength":561,"estimatedCostUsd":0.00004065,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T16:33:04.498Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","traceId":"a29406e3-45b8-48a2-9f46-54f843af6b57","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"gate2","event":"stage_completed","durationMs":1364,"route":"CONTINUE","foodSignal":"YES","confidence":0.95,"tokenUsage":{"input":223,"output":12,"total":235,"model":"gpt-4o-mini"},"msg":"[ROUTE2] gate2 completed"}
{"level":"info","time":"2026-01-31T16:33:04.501Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","status":"RUNNING","progress":25,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T16:33:04.501Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","traceId":"a29406e3-45b8-48a2-9f46-54f843af6b57","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"intent","event":"stage_started","queryLen":23,"queryHash":"5555eae2a438","msg":"[ROUTE2] intent started"}
{"level":"info","time":"2026-01-31T16:33:06.798Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","type":"provider_call","traceId":"a29406e3-45b8-48a2-9f46-54f843af6b57","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","provider":"openai","operation":"completeJSON","latencyMs":2296,"success":true,"retryCount":0,"timestamp":"2026-01-31T16:33:06.798Z","model":"gpt-4o-mini","tokensIn":1601,"tokensOut":81,"totalTokens":1682,"schemaName":"response","schemaStrict":true,"schemaHash":"f731e75551db","schemaVersion":"v1","promptVersion":"intent_v4","promptHash":"7d0cb4f0f10cec33408d81bef29a9ab039df93163813d0fb2660eb8dda9adb95","estimatedCostUsd":0.00028875,"costUnknown":false,"msg":"Provider call: openai.completeJSON"}
{"level":"info","time":"2026-01-31T16:33:06.800Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","msg":"llm_gate_timing","stage":"intent","promptVersion":"intent_v4","schemaHash":"f58b8106b963","requestId":"req-1769877183121-tbsxol9b1","traceId":"a29406e3-45b8-48a2-9f46-54f843af6b57","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","attempt":1,"model":"gpt-4o-mini","timeoutMs":3500,"timeoutHit":false,"buildPromptMs":0.04,"networkMs":2296.59,"parseMs":1.2,"totalMs":2297.86,"promptChars":4880,"inputTokens":1601,"outputTokens":81,"retriesCount":0,"success":true,"slow":true,"msg":"llm_gate_timing"}
{"level":"info","time":"2026-01-31T16:33:06.800Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","traceId":"a29406e3-45b8-48a2-9f46-54f843af6b57","sessionId":"sess_0a6a9323-dfaa-4864-836a-fbffe02d7ec4","pipelineVersion":"route2","stage":"intent","event":"stage_completed","durationMs":2299,"route":"TEXTSEARCH","confidence":1,"reason":"explicit_city_mentioned","msg":"[ROUTE2] intent completed"}
{"level":"info","time":"2026-01-31T16:33:06.819Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","status":"RUNNING","progress":40,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T16:33:06.821Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","hasResult":true,"msg":"[RedisJobStore] Result stored"}
{"level":"info","time":"2026-01-31T16:33:06.821Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","resultCount":0,"hasAssist":true,"event":"result_stored","msg":"[Observability] Search result stored successfully"}
{"level":"info","time":"2026-01-31T16:33:06.822Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","status":"DONE_SUCCESS","progress":100,"msg":"[RedisJobStore] Status updated"}
{"level":"info","time":"2026-01-31T16:33:06.822Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","status":"DONE_SUCCESS","progress":100,"event":"status_done","msg":"[Observability] Job reached terminal status"}
{"level":"info","time":"2026-01-31T16:33:06.834Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","sessionHash":"2c3b20d765e7","operation":"getResult","decision":"AUTHORIZED","traceId":"345d8b1f-60b1-4293-be81-dacacb9f57b6","msg":"[P0 Security] Access granted"}
{"level":"info","time":"2026-01-31T16:33:06.835Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","event":"getResult_status","status":"DONE_SUCCESS","hasResult":true,"ageMs":3711,"updatedAgeMs":14,"progress":100,"isStale":false,"msg":"[HTTP] GET /result - status: DONE_SUCCESS, ageMs: 3711, updatedAgeMs: 14"}
{"level":"info","time":"2026-01-31T16:33:06.835Z","pid":18436,"hostname":"il-dev-win-lt-shahar-pot","requestId":"req-1769877183121-tbsxol9b1","photoUrlsSanitized":true,"resultCount":0,"hasResult":true,"status":"DONE_SUCCESS","event":"getResult_returned","msg":"[Observability] GET /result returned successfully with results"}
